Kinetic.Node.prototype.closest=function(t){for(var e=this.parent;void 0!==e;){if(e.nodeType===t)return e;e=e.parent}return!1},Kinetic.Stage.prototype.createCopy=function(){var t,e=[],n=this.getChildren();for(t=0;t<n.length;t++)e.push(n[t].clone());return e},Kinetic.Stage.prototype.getScaledWidth=function(){return Math.ceil(this.getWidth()/this.getScale().x)},Kinetic.Stage.prototype.getScaledHeight=function(){return Math.ceil(this.getHeight()/this.getScale().y)},Kinetic.Stage.prototype.getSaveWidth=function(){return this.im.saveWidth},Kinetic.Stage.prototype.getSaveHeight=function(){return this.im.saveHeight},Kinetic.Stage.prototype.getTotalDimensions=function(){var t=(this.getSaveHeight()/2-this.im.center.y)*this.getScale().y,e=t+this.getHeight()-this.getSaveHeight()*this.getScale().y,n=(this.getSaveWidth()/2-this.im.center.x)*this.getScale().x,g=n+this.getWidth()-this.getSaveWidth()*this.getScale().x;return{min:{x:n,y:t},max:{x:g,y:e},width:this.getScaledWidth(),height:this.getScaledHeight(),visibleWidth:Math.max(this.getSaveWidth(),2*this.getScaledWidth()-this.getSaveWidth()),visibleHeight:Math.max(this.getSaveHeight(),2*this.getScaledHeight()-this.getSaveHeight())}},Kinetic.Stage.prototype.loadCopy=function(t){var e;for(this.removeChildren(),e=0;e<t.length;e++)this.add(t[e]);this.draw()},Kinetic.Stage.prototype.elementType="stage",Kinetic.Image.prototype.getImageData=function(){var t=new Kinetic.Canvas(this.attrs.image.width,this.attrs.image.height),e=t.getContext();e.drawImage(this.attrs.image,0,0);try{var n=e.getImageData(0,0,t.getWidth(),t.getHeight());return n}catch(g){Kinetic.Util.warn("Unable to get imageData.")}},Kinetic.Layer.prototype._cacheddraw=(new Kinetic.Layer).draw,Kinetic.Layer.prototype.draw=function(){if("undefined"==typeof im||"undefined"==typeof im.trigger)return this._cacheddraw();var t=this._cacheddraw();return t},Kinetic.Layer.prototype.elementType="layer",Kinetic.Group.prototype.elementType="group",Kinetic.Text.prototype.rasterize=function(t){var e=this.parent,n=this;this.toImage({callback:function(g){var i=new Kinetic.Image({image:g,x:n.getPosition().x,y:n.getPosition().y});n.remove(),e.add(i).draw(),t.callback(i)}})};var control_sets=[],components=[],filters=[],ImageEditor=function(t){"use strict";if(void 0===t)return this;t.pixelRatio=1;var e=this,n=function(t){return Math.round(t)};e.saveData=t.saveData||{},e.saveUrl=t.saveUrl,e.width=t.width,e.height=t.height,e.strictSize="undefined"!=typeof t.strictSize?!!t.strictSize:t.saveWidth>0,e.saveWidth=t.saveWidth||(e.strictSize?0:n(e.width/2)),e.saveHeight=t.saveHeight||(e.strictSize?0:n(e.height/2)),e.stage=new Kinetic.Stage(t),e.namespaces={},e.controlSets={},e.components={},e.settings=t,e.filters={},e.fileId=e.settings.fID,e.scale=1,e.crosshair=new Image,e.uniqid=e.stage.getContainer().id,e.editorContext=$(e.stage.getContainer()).parent(),e.domContext=e.editorContext.parent(),e.controlContext=e.domContext.children("div.controls"),e.controlSetNamespaces=[],e.showLoader=$.fn.dialog.showLoader,e.hideLoader=$.fn.dialog.hideLoader,e.stage.im=e,e.stage.elementType="stage",e.crosshair.src=CCM_IMAGE_PATH+"/image_editor/crosshair.png",e.center={x:Math.round(e.width/2),y:Math.round(e.height/2)},e.centerOffset={x:e.center.x,y:e.center.y};var g=function(t){return $(t,e.domContext)},i=function(){if(t.debug===!0&&"undefined"!=typeof console){var e=arguments;1==e.length&&(e=e[0])}},a=function(){if(t.debug===!0&&"undefined"!=typeof console){var e=arguments;1==e.length&&(e=e[0])}},I=function(){if("undefined"!=typeof console){var t=arguments;1==t.length&&(t=t[0])}};e.stage._setDraggable=e.stage.setDraggable,e.stage.setDraggable=function(t){return a("setting draggable to "+t),e.stage._setDraggable(t)};var l=function(){var t=this;t.history=[],t.pointer=-1,t.save=function(){e.fire("beforehistorysave"),t.history=t.history.slice(0,t.pointer+1),t.history.push(e.stage.createCopy()),t.movePointer(1),e.fire("historysave")},t.movePointer=function(e){return t.pointer+=e,t.pointer<0&&(t.pointer=0),t.pointer>=t.history.length&&(t.pointer=t.history.length-1),t.pointer},t.render=function(){e.fire("beforehistoryrender"),e.stage.loadCopy(t.history[t.pointer]),e.fire("historyrender")},t.undo=function(){e.fire("beforehistoryundo"),t.movePointer(-1),t.render(),e.fire("historyundo")},t.redo=function(){e.fire("beforehistoryredo"),t.movePointer(1),t.render(),e.fire("historyredo")}};e.history=new l,e.bindEvent=e.bind=e.on=function(t,n,g){var i=g||e.stage.getContainer();i instanceof jQuery&&(i=i[0]),ConcreteEvent.sub(t,n,i)},e.fireEvent=e.fire=e.trigger=function(t,n,g){var i=g||e.stage.getContainer();i instanceof jQuery&&(i=i[0]),ConcreteEvent.pub(t,n,i)},e.addElement=function(t,n){var g=new Kinetic.Layer;t.elementType=n,g.elementType=n,g.add(t),e.stage.add(g),g.moveDown(),e.stage.draw()},e.on("backgroundBuilt",function(){void 0!==e.activeElement&&void 0!==e.activeElement.doppelganger&&(e.foreground.add(e.activeElement.doppelganger),e.activeElement.doppelganger.setPosition(e.activeElement.getPosition()))}),e.setActiveElement=function(t){return t.defer?e.setActiveElement(t.defer):void(e.activeElement!=t&&(void 0!==e.activeElement&&void 0!==e.activeElement.doppelganger&&e.activeElement.doppelganger.remove(),t===e.stage||"Stage"==t.nodeType?(e.trigger("ChangeActiveAction",e.controlSetNamespaces.length?e.controlSetNamespaces[0]:void 0),$("div.control-sets",e.controlContext).find("h4.active").removeClass("active")):void 0!==t.doppelganger&&(e.foreground.add(t.doppelganger),e.foreground.draw()),e.trigger("beforeChangeActiveElement",e.activeElement),e.alterCore("activeElement",t),e.trigger("changeActiveElement",t),e.stage.draw()))},e.bind("ClickedElement",function(t,n){e.setActiveElement(n)}),e.bind("stageChanged",function(t){(e.activeElement.getWidth()>e.stage.getScaledWidth()||e.activeElement.getHeight()>e.stage.getScaledHeight())&&e.setActiveElement(e.stage)});var C=g(e.stage.getContainer()).parent().children(".bottomBar");C.attr("unselectable","on");var c={};c.zoomIn=g("<div class='bottombarbutton plus'><i class='fa fa-plus'></i></div>"),c.zoomOut=g("<div class='bottombarbutton'><i class='fa fa-minus'></i></div>"),c.zoomIn.appendTo(C),c.zoomOut.appendTo(C),c.zoomIn.click(function(t){e.fire("zoomInClick",t)}),c.zoomOut.click(function(t){e.fire("zoomOutClick",t)});var d=g("<div></div>").addClass("scale").text("100%");e.on("scaleChange",function(t){d.text(Math.round(1e4*e.scale)/100+"%")}),d.click(function(){e.scale=1,e.stage.setScale(e.scale);var t=e.stage.getDragBoundFunc()({x:e.stage.getX(),y:e.stage.getY()});e.stage.setX(t.x),e.stage.setY(t.y),e.fire("scaleChange"),e.buildBackground(),e.stage.draw()}),d.appendTo(C);var s=5/6;e.on("zoomInClick",function(t){var n=(-e.stage.getX()+e.stage.getWidth()/2)/e.scale,g=(-e.stage.getY()+e.stage.getHeight()/2)/e.scale;e.scale/=s,e.scale=Math.round(1e3*e.scale)/1e3,e.alterCore("scale",e.scale);var i=(-e.stage.getX()+e.stage.getWidth()/2)/e.scale,a=(-e.stage.getY()+e.stage.getHeight()/2)/e.scale;e.stage.setX(e.stage.getX()-(n-i)*e.scale),e.stage.setY(e.stage.getY()-(g-a)*e.scale),e.stage.setScale(e.scale);var I=e.stage.getDragBoundFunc()({x:e.stage.getX(),y:e.stage.getY()});e.stage.setX(I.x),e.stage.setY(I.y),e.fire("scaleChange"),e.buildBackground(),e.stage.draw()}),e.on("zoomOutClick",function(t){var n=(-e.stage.getX()+e.stage.getWidth()/2)/e.scale,g=(-e.stage.getY()+e.stage.getHeight()/2)/e.scale;e.scale*=s,e.scale=Math.round(1e3*e.scale)/1e3,e.alterCore("scale",e.scale);var i=(-e.stage.getX()+e.stage.getWidth()/2)/e.scale,a=(-e.stage.getY()+e.stage.getHeight()/2)/e.scale;e.stage.setX(e.stage.getX()-(n-i)*e.scale),e.stage.setY(e.stage.getY()-(g-a)*e.scale),e.stage.setScale(e.scale);var I=e.stage.getDragBoundFunc()({x:e.stage.getX(),y:e.stage.getY()});e.stage.setX(I.x),e.stage.setY(I.y),e.fire("scaleChange"),e.buildBackground(),e.stage.draw()});var o={};if(o.width=g("<span/>").addClass("saveWidth"),o.height=g("<span/>").addClass("saveHeight"),o.crop=g('<div><i class="icon-resize-full"/></div>').addClass("bottombarbutton").addClass("crop"),o.both=o.height.add(o.width).width(32).attr("contenteditable",!0),o.area=g("<span/>").css({"float":"right"}),e.on("adjustedsavers",function(){o.width.text(e.saveWidth),o.height.text(e.saveHeight)}),o.crop.click(function(){e.adjustSavers()}),e.strictSize?o.both.attr("disabled","true"):o.both.keyup(function(t){e.fire("editedSize",t)}),e.bind("editedSize",function(t){e.saveWidth=parseInt(o.width.text()),e.saveHeight=parseInt(o.height.text()),isNaN(e.saveWidth)&&(e.saveWidth=0),isNaN(e.saveHeight)&&(e.saveHeight=0),e.buildBackground()}),e.bind("saveSizeChange",function(){o.width.text(e.saveWidth),o.height.text(e.saveHeight)}),e.setCursor=function(t){$(e.stage.getContainer()).css("cursor",t)},e.save=function(){e.fire("ChangeActiveAction"),e.fire("ImageEditorWillSave"),$.fn.dialog.showLoader(),e.stage.toDataURL({callback:function(n){var g=$("<img />").addClass("fake_canvas").appendTo(e.editorContext.children(".Editor"));g.attr("src",n),g.css({position:"absolute",top:0,left:0,backgroundColor:"white"});var i=e.stage.getPosition(),a=e.scale,I=e.stage.getWidth(),l=e.stage.getHeight();e.stage.setPosition(-e.saveArea.getX(),-e.saveArea.getY()),e.stage.setScale(1),e.background.hide(),e.foreground.hide(),e.stage.setHeight(e.saveHeight+100),e.stage.setWidth(e.saveWidth+100),e.stage.draw();var C=t.mime;"image/jpeg"!==C&&"image/png"!==C&&(C="image/png"),e.stage.toDataURL({mimeType:C,quality:t.jpegCompression,width:e.saveWidth,height:e.saveHeight,callback:function(t){e.stage.setPosition(i),e.background.show(),e.foreground.show(),e.stage.setScale(a),e.stage.setHeight(l),e.stage.setWidth(I),e.stage.draw(),g.remove(),$.post(e.saveUrl,_.extend(e.saveData,{fID:e.fileId,imgData:t}),function(n){$.fn.dialog.hideLoader();var g=JSON.parse(n);1===g.error?(alert(g.message),$("button.save[disabled]").attr("disabled",!1)):0===g.error&&(e.fire("ImageEditorDidSave",_.extend(e.saveData,{fID:e.fileId,imgData:t})),Concrete.event.fire("ImageEditorDidSave",_.extend(e.saveData,{fID:e.fileId,imgData:t})))})}})}})},e.actualPosition=function(t,n,g,i,a){var I=n-i,l=t-g,C=e.activeElement.getRotation()+Math.atan2(I,l),c=Math.sqrt(Math.pow(l,2)+Math.pow(I,2));return[g+c*Math.cos(C),i+c*Math.sin(C)]},e.getActualRect=function(t,n,g){var i=[],a=g.getRotation();return i.push(e.actualPosition(g.getX(),g.getY(),t,n,a)),i.push(e.actualPosition(g.getX()+g.getWidth()*g.getScaleX(),g.getY(),t,n,a)),i.push(e.actualPosition(g.getX()+g.getWidth()*g.getScaleX(),g.getY()+g.getHeight()*g.getScaleY(),t,n,a)),i.push(e.actualPosition(g.getX(),g.getY()+g.getHeight()*g.getScaleY(),t,n,a)),i},e.adjustSavers=function(t){if("Stage"!==e.activeElement.nodeType){e.foreground.autoCrop=!1,e.background.autoCrop=!1;var n,n,g,i={min:{x:!1,y:!1},max:{x:!1,y:!1}},a=e.activeElement,I=a.parent,l=e.getActualRect(0,0,a);for(n=l.length-1;n>=0;n--){var C=l[n],c=C[0]+I.getX(),d=C[1]+I.getY();(c>i.max.x||i.max.x===!1)&&(i.max.x=c),(c<i.min.x||i.min.x===!1)&&(i.min.x=c),(d>i.max.y||i.max.y===!1)&&(i.max.y=d),(d<i.min.y||i.min.y===!1)&&(i.min.y=d)}g={width:i.max.x-i.min.x,height:i.max.y-i.min.y},e.strictSize||(e.alterCore("saveWidth",Math.round(g.width)),e.alterCore("saveHeight",Math.round(g.height)),e.buildBackground());var s=[e.center.x-e.activeElement.getWidth()*e.activeElement.getScaleX()/2,e.center.y-e.activeElement.getHeight()*e.activeElement.getScaleY()/2],o=e.actualPosition(s[0],s[1],e.center.x,e.center.y,e.activeElement.getRotation());e.activeElement.parent.setPosition(o.map(Math.round)),t!==!1&&e.fire("adjustedsavers"),e.stage.draw()}},e.bind("imageLoad",function(){setTimeout(e.adjustSavers,0)}),e.extend=function(t,e){this[t]=e},e.alterCore=function(t,n){var g,i=e;e.namespace&&(i.namespace,i=e.realIm),e[t]=n;for(g in e.controlSets)e.controlSets[g].im.extend(t,n);for(g in e.filters)e.filters[g].im.extend(t,n);for(g in e.components)e.components[g].im.extend(t,n)},e.clone=function(t){var n,g=new ImageEditor;g.realIm=e;for(n in e)g[n]=e[n];return g.namespace=t,g},e.addControlSet=function(t,n,g){jQuery&&g instanceof jQuery&&(g=g[0]),g.controlSet=function(e,n){e.disable=function(){e.enabled=!1,$(g).parent().parent().addClass("disabled")},e.enable=function(){e.enabled=!0,$(g).parent().parent().removeClass("disabled")},this.im=e,this.$=$,a("Loading ControlSet",e);try{new Function("im","$",n).call(this,e,$)}catch(i){var l=i.stack.replace(/[\S\s]+at HTMLDivElement.eval.+?<anonymous>:(\d+:\d+)[\S\s]+/,"$1").split(":");if(l[1]&&!isNaN(parseInt(l[1]))){var C=n.split("\n"),c="Parse error at line #"+l[0]+" char #"+l[1]+" within "+t;c+="\n"+C[parseInt(l[0])-1],c+="\n"+new Array(parseInt(l[1])).join(" ")+"^",I(c)}else I('"'+i.message+'" in "'+e.namespace+'"')}return this};var i=e.clone(t),l=g.controlSet.call(g,i,n);return e.controlSets[t]=l,l},e.addFilter=function(t,n){var g=function(e,n){this.namespace=e.namespace,this.im=e;try{new Function("im","$",n).call(this,e,$)}catch(g){I(g),window.lastError=g;var i=g.stack.replace(/[\S\s]+at HTMLDivElement.eval.+?<anonymous>:(\d+:\d+)[\S\s]+/,"$1").split(":");if(2!=i.length)I(g.message),I(g.stack);else{var a=n.split("\n"),l="Parse error at line #"+i[0]+" char #"+i[1]+" within "+t;l+="\n"+a[parseInt(i[0])-1],l+="\n"+new Array(parseInt(i[1])||0).join(" ")+"^",I(l)}}return this},i=e.clone(t),a=new g(i,n);return e.filters[t]=a,a},e.addComponent=function(t,n,g){jQuery&&g instanceof jQuery&&(g=g[0]),g.component=function(e,n){e.disable=function(){$(this).parent().parent().addClass("disabled")},e.enable=function(){$(this).parent().parent().removeClass("disabled")},this.im=e,a("Loading component",e);try{new Function("im","$",n).call(this,e,$)}catch(g){var i=g.stack.replace(/[\S\s]+at HTMLDivElement.eval.+?<anonymous>:(\d+:\d+)[\S\s]+/,"$1").split(":");if(i[1]&&!isNaN(parseInt(i[1]))){var l=n.split("\n"),C="Parse error at line #"+i[0]+" char #"+i[1]+" within "+t;C+="\n"+l[parseInt(i[0])-1],C+="\n"+new Array(parseInt(i[1])).join(" ")+"^",I(C)}else I('"'+g.message+'" in "'+e.namespace+'"')}return this};var i=e.clone(t),l=g.component.call(g,i,n);return e.components[t]=l,l},e.background=new Kinetic.Layer,e.foreground=new Kinetic.Layer,e.stage.add(e.background),e.stage.add(e.foreground),e.bgimage=new Image,e.saveArea=new Kinetic.Rect,e.background.add(e.saveArea),e.bind("load",function(){e.saveArea.setFillPatternImage(e.bgimage),e.saveArea.setFillPatternOffset([-(e.saveWidth/2),-(e.saveHeight/2)]),e.saveArea.setFillPatternScale(1/e.scale),e.saveArea.setFillPatternX(0),e.saveArea.setFillPatternY(0),e.saveArea.setFillPatternRepeat("repeat"),e.background.on("click",function(){e.setActiveElement(e.stage)})},e.bgimage),e.bgimage.src=CCM_REL+"/concrete/images/testbg.png",e.buildBackground=function(){var t=e.stage.getTotalDimensions();e.saveArea.setFillPatternOffset([-(e.saveWidth/2)*e.scale,-(e.saveHeight/2)*e.scale]),e.saveArea.setX(Math.round(e.center.x-e.saveWidth/2)),e.saveArea.setY(Math.round(e.center.y-e.saveHeight/2)),e.saveArea.setFillPatternScale(1/e.scale),e.saveArea.setWidth(e.saveWidth),e.saveArea.setHeight(e.saveHeight),e.coverLayer||(e.coverLayer=new Kinetic.Rect,e.coverLayer.setStroke("rgba(150,150,150,.5)"),e.coverLayer.setFill("transparent"),e.coverLayer.setListening(!1),e.coverLayer.setStrokeWidth(Math.max(t.width,t.height,500)),e.foreground.add(e.coverLayer));var n=2*Math.max(t.width,t.height);e.coverLayer.setPosition(e.saveArea.getX()-n/2,e.saveArea.getY()-n/2),e.coverLayer.setSize(e.saveArea.getWidth()+n,e.saveArea.getHeight()+n),e.coverLayer.setStrokeWidth(n),e.fire("backgroundBuilt"),e.saveArea.draw(),e.coverLayer.draw()},e.buildBackground(),e.on("stageChanged",e.buildBackground),e.stage.setDragBoundFunc(function(t){var n=e.stage.getTotalDimensions(),g=Math.max(n.max.x,n.min.x)+100,i=Math.min(n.max.x,n.min.x)-100,a=Math.max(n.max.y,n.min.y)+100,I=Math.min(n.max.y,n.min.y)-100;return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.x>g&&(t.x=g),t.x<i&&(t.x=i),t.y>a&&(t.y=a),t.y<I&&(t.y=I),t.x=Math.floor(t.x),t.y=Math.floor(t.y),t}),e.setActiveElement(e.stage),e.stage.setDraggable(!0),e.autoCrop=!0,e.on("imageLoad",function(){var t=50,n=e.stage.getWidth()-2*t,g=e.stage.getHeight()-2*t;if(!(e.saveWidth<n&&e.saveHeight<g)){var i=Math.max(e.saveWidth/n,e.saveHeight/g);e.scale=1/i,e.scale=Math.round(100*e.scale)/100,e.alterCore("scale",e.scale),e.stage.setScale(e.scale),e.stage.setX((e.stage.getWidth()-e.stage.getWidth()*e.stage.getScale().x)/2),e.stage.setY((e.stage.getHeight()-e.stage.getHeight()*e.stage.getScale().y)/2);var a=e.stage.getDragBoundFunc()({x:e.stage.getX(),y:e.stage.getY()});e.stage.setX(a.x),e.stage.setY(a.y),e.fire("scaleChange"),e.fire("stageChanged"),e.buildBackground()}}),e.fit=function(t,n){if(n===!1)return{width:e.saveWidth,height:e.saveHeight};var g=t.height,i=t.width;return i>e.saveWidth&&(g/=i/e.saveWidth,i=e.saveWidth),g>e.saveHeight&&(i/=g/e.saveHeight,g=e.saveHeight),{width:i,height:g}},t.src){e.showLoader(ccmi18n_imageeditor.loadingImage);var m=new Image,A=!1;e.bind("ControlSetsLoaded",function(){A=!0}),e.bind("load",function(){function t(){_.defer(function(){e.stage.draw(),e.setActiveElement(g),e.fire("changeActiveAction",e.controlSetNamespaces[0])})}e.strictSize?0!=e.saveWidth&&0!=e.saveHeight||(0==e.saveWidth?0==e.saveHeight?(e.saveWidth=m.width,e.saveHeight=m.height,e.fire("saveSizeChange"),e.buildBackground()):(e.saveWidth=Math.floor(m.width/m.height*e.saveHeight),e.fire("saveSizeChange"),e.buildBackground()):0==e.saveHeight&&(e.saveHeight=Math.floor(m.height/m.width*e.saveWidth),e.fire("saveSizeChange"),e.buildBackground())):(e.saveWidth=m.width,e.saveHeight=m.height,e.fire("saveSizeChange"),e.buildBackground());var n={x:Math.floor(e.center.x-m.width/2),y:Math.floor(e.center.y-m.height/2)},g=new Kinetic.Image({image:m,x:0,y:0});g.setPosition(n),e.addElement(g,"image"),_.defer(function(){e.fire("imageload")}),A?t():e.bind("ControlSetsLoaded",t)},m),m.src=t.src}else e.fire("imageload");return e.bind("imageload",function(){var n,g=t.controlsets||{},a=(t.filters||{},0);i("Loading ControlSets"),e.showLoader(ccmi18n_imageeditor.loadingControlSets),e.fire("LoadingControlSets");for(n in g){var I="ControlSet_"+n;e.controlSetNamespaces.push(I),$.ajax(g[n].src,{dataType:"text",cache:!1,namespace:n,myns:I,beforeSend:function(){a++},success:function(t){a--;var n=e.addControlSet(this.myns,t,g[this.namespace].element);i(n),e.fire("controlSetLoad",n),0==a&&e.trigger("ControlSetsLoaded")},error:function(t,n,g){a--,0==a&&e.trigger("ControlSetsLoaded")}})}}),e.bind("ControlSetsLoaded",function(){e.fire("LoadingComponents"),e.showLoader(ccmi18n_imageeditor.loadingComponents);var n,g=t.components||{},a=0;i("Loading Components");for(n in g){var I="Component_"+n;$.ajax(g[n].src,{dataType:"text",cache:!1,namespace:n,myns:I,beforeSend:function(){a++},success:function(t){a--;var n=e.addComponent(this.myns,t,g[this.namespace].element);i(n),e.fire("ComponentLoad",n),0==a&&e.trigger("ComponentsLoaded")},error:function(t,n,g){a--,0==a&&e.trigger("ComponentsLoaded")}})}0==a&&e.trigger("ComponentsLoaded")}),e.bind("ComponentsLoaded",function(){i("Loading Filters"),e.showLoader(ccmi18n_imageeditor.loadingFilters);var n,g,a=t.filters||{},I=0;e.fire("LoadingFilters");for(n in a)a.hasOwnProperty(n)&&!function(t){var n=_.clone(a[t]),i="Filter_"+t,l=n.name;g||(g=i),I++,$.ajax(a[t].src,{dataType:"text",cache:!1,namespace:t,myns:i,name:l,success:function(t){var g=e.addFilter(this.myns,t);g.name=this.name,g.settings=n,e.fire("filterLoad",g),I--,0===I&&e.trigger("FiltersLoaded")},error:function(t,n,g){I--,0===I&&e.trigger("FiltersLoaded")}})}(n)}),e.bind("ChangeActiveAction",function(t,n){if(n!==e.activeControlSet){for(var i in e.controlSets)g(e.controlSets[i]),i!==n&&g(e.controlSets[i]).slideUp();if(e.activeControlSet=n,e.alterCore("activeControlSet",n),!n)return void $("div.control-sets",e.controlContext).find("h4.active").removeClass("active");var a=$(e.controlSets[n]),I=a.show().height();0!=a.length&&a.hide().height(I).slideDown(function(){$(this).height("")})}}),e.bind("ChangeActiveComponent",function(t,n){if(n!==e.activeComponent){for(var i in e.components)i!==n&&g(e.components[i]).slideUp();if(e.activeComponent=n,e.alterCore("activeComponent",n),n){var a=$(e.components[n]),I=a.show().height();0!=a.length&&a.hide().height(I).slideDown(function(){$(this).height("")})}}}),e.bind("ChangeNavTab",function(t,n){e.trigger("ChangeActiveAction",n),e.trigger("ChangeActiveComponent",n);var i=g("div.editorcontrols");switch(n){case"add":i.children("div.control-sets").hide(),i.children("div.components").show();break;case"edit":i.children("div.components").hide(),i.children("div.control-sets").show()}}),e.bind("FiltersLoaded",function(){e.hideLoader()}),e.slideOut=$("<div/>").addClass("slideOut").css({width:0,"float":"right",height:"100%","overflow-x":"hidden",right:e.controlContext.width()-1,position:"absolute",background:"white","box-shadow":"black -20px 0 20px -25px"}),e.slideOutContents=$("<div/>").appendTo(e.slideOut).width(300),e.showSlideOut=function(t,n){e.hideSlideOut(function(){e.slideOut.empty(),e.slideOutContents=t.width(300),e.slideOut.append(e.slideOutContents),e.slideOut.addClass("active").addClass("sliding"),e.slideOut.stop(1).slideOut(300,function(){e.slideOut.removeClass("sliding"),"function"==typeof n&&n()})})},e.hideSlideOut=function(t){e.slideOut.addClass("sliding"),e.slideOut.slideIn(300,function(){e.slideOut.css("border-right","0"),e.slideOut.removeClass("active").removeClass("sliding"),"function"==typeof t&&t()})},e.controlContext.after(e.slideOut),e.setActiveElement(e.stage),window.c5_image_editor=e,window.im=e,e};$.fn.ImageEditor=function(t){void 0===t&&(t={}),t.imageload=$.fn.dialog.hideLoader;var e=$(this);if(t.container=e[0],0==e.height())return void setTimeout(function(){e.ImageEditor(t)},50);e.closest(".ui-dialog").find(".ui-resizable-handle").hide(),e.height("-=30"),$("div.editorcontrols").height(e.height()-90),e.width("-=330").parent().width("-=330").children("div.bottomBar").width("-=330"),void 0===t.width&&(t.width=e.width()),void 0===t.height&&(t.height=e.height()),$.fn.dialog.showLoader();var n=new ImageEditor(t),g=n.domContext;return $("div.control-sets > div.controlset",g).each(function(){var t=$(this),e=t.data("namespace");t.find("h4").click(function(){t.hasClass("active")||n.fire("ChangeActiveAction","ControlSet_"+e)}),n.bind("ChangeActiveAction",function(n,i){if(i==="ControlSet_"+e){g.find("div.controlset.active").removeClass("active").children(".control").slideUp(250),t.addClass("active");var a=t.children(".control").height("auto");a.slideDown(250)}})}),$("div.controls > div.controlscontainer",g).children("div.save").children("button.save").click(function(){$(this).attr("disabled",!0),n.save()}).end().children("button.cancel").click(function(){confirm(ccmi18n_imageeditor.areYouSure)&&$.fn.dialog.closeTop()}),n.on("ChangeActiveAction",function(t,e){e||$("h4.active",g).removeClass("active")}),n.on("ChangeActiveComponent",function(t,e){e||$("div.controlset.active",g).removeClass("active")}),n.bind("imageload",$.fn.dialog.hideLoader),n},$.fn.slideOut=function(t,e){var n=$(this),g=n.width(),i=255;return n.css("overflow-y","auto"),g==i?(n.animate({width:i},0,e),this):(n.width(g).animate({width:i},t||300,e||function(){}),this)},$.fn.slideIn=function(t,e){var n=$(this);return n.css("overflow-y","hidden"),0===n.width()?(n.animate({width:0},0,e),this):(n.animate({width:0},t||300,e||function(){}),this)},ImageEditor.prototype=ImageEditor.fn={filter:{grayscale:Kinetic.Filters.Grayscale,sepia:function(t){var e,n=t.data;for(e=0;e<n.length;e+=4)n[e]=.393*n[e]+.769*n[e+1]+.189*n[e+2],n[e+1]=.349*n[e]+.686*n[e+1]+.168*n[e+2],n[e+2]=.272*n[e]+.534*n[e+1]+.131*n[e+2]},brightness:function(t,e){for(var n=e.level,g=t.data,i=0;i<g.length;i+=4)g[i]+=n,g[i+1]+=n,g[i+2]+=n},invert:function(t,e){for(var n=t.data,g=0;g<n.length;g+=4)n[g]=255-n[g],n[g+1]=255-n[g+1],n[g+2]=255-n[g+2]},restore:function(t,e){for(var n=(e.level,t.data),g=e.imageData.data,i=0;i<n.length;i+=4)n[i]=g[i],n[i+1]=g[i+1],n[i+2]=g[i+2]}}},function(t){function e(g){if(n[g])return n[g].exports;var i=n[g]={i:g,l:!1,exports:{}};return t[g].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(module,exports){eval("/////////////////////////////\n//      Kinetic.Node       //\n/////////////////////////////\nKinetic.Node.prototype.closest = function(type) {\n  var active = this.parent;\n  while (active !== undefined) {\n    if (active.nodeType === type) return active;\n    active = active.parent;\n  }\n  return false;\n};\n\n\n/////////////////////////////\n//      Kinetic.Stage      //\n/////////////////////////////\nKinetic.Stage.prototype.createCopy = function () {\n  var copy = [], children = this.getChildren(), i;\n  for (i = 0; i < children.length; i++) {\n    copy.push(children[i].clone());\n  }\n  return copy;\n};\nKinetic.Stage.prototype.getScaledWidth = function() {\n  return Math.ceil(this.getWidth() / this.getScale().x);\n};\nKinetic.Stage.prototype.getScaledHeight = function() {\n  return Math.ceil(this.getHeight() / this.getScale().y);\n};\nKinetic.Stage.prototype.getSaveWidth = function() {\n  return this.im.saveWidth;\n};\nKinetic.Stage.prototype.getSaveHeight = function() {\n  return this.im.saveHeight;\n};\nKinetic.Stage.prototype.getTotalDimensions = function() {\n  var minY = (this.getSaveHeight() / 2 - this.im.center.y) * this.getScale().y;\n  var maxY = minY + this.getHeight() - (this.getSaveHeight() * this.getScale().y);\n\n  var minX = (this.getSaveWidth() / 2 - this.im.center.x) * this.getScale().x;\n  var maxX = minX + this.getWidth() - (this.getSaveWidth() * this.getScale().x);\n\n  return {\n    min: {\n      x: minX,\n      y: minY\n    },\n    max: {\n      x: maxX,\n      y: maxY\n    },\n    width:this.getScaledWidth(),\n    height:this.getScaledHeight(),\n    visibleWidth:Math.max(this.getSaveWidth(),this.getScaledWidth() * 2 - this.getSaveWidth()),\n    visibleHeight:Math.max(this.getSaveHeight(),this.getScaledHeight() * 2 - this.getSaveHeight())\n  };\n};\nKinetic.Stage.prototype.loadCopy = function (copy) {\n  var this$1 = this;\n\n  var i;\n  this.removeChildren();\n  for (i = 0; i < copy.length; i++) {\n    this$1.add(copy[i]);\n  }\n  this.draw();\n};\nKinetic.Stage.prototype.elementType = 'stage';\n\n/////////////////////////////\n//      Kinetic.Image      //\n/////////////////////////////\nKinetic.Image.prototype.getImageData = function() {\n  var canvas = new Kinetic.Canvas(this.attrs.image.width, this.attrs.image.height);\n  var context = canvas.getContext();\n  context.drawImage(this.attrs.image, 0, 0);\n  try {\n      var imageData = context.getImageData(0, 0, canvas.getWidth(), canvas.getHeight());\n      return imageData;\n  } catch(e) {\n      Kinetic.Util.warn('Unable to get imageData.');\n  }\n};\n\n/////////////////////////////\n//      Kinetic.Layer      //\n/////////////////////////////\nKinetic.Layer.prototype._cacheddraw = (new Kinetic.Layer).draw;\nKinetic.Layer.prototype.draw = function() {\n  if (typeof im === 'undefined' || typeof im.trigger === 'undefined') {\n    return this._cacheddraw();\n  }\n  //im.trigger('beforeredraw',this);\n  var draw = this._cacheddraw();\n  //im.trigger('afterredraw',this);\n  return draw;\n};\nKinetic.Layer.prototype.elementType = 'layer';\n\n\n/////////////////////////////\n//      Kinetic.Group      //\n/////////////////////////////\nKinetic.Group.prototype.elementType = 'group';\n\n/////////////////////////////\n//       Kinetic.Text      //\n/////////////////////////////\nKinetic.Text.prototype.rasterize = function(e) {\n  var layer = this.parent;\n  var me = this;\n  this.toImage({\n    callback:function(img){\n      var rasterizedImage = new Kinetic.Image({image:img,x:me.getPosition().x,y:me.getPosition().y});\n      me.remove();\n      layer.add(rasterizedImage).draw();\n      e.callback(rasterizedImage);\n    }\n  });\n};\n\nvar control_sets = [], components = [], filters = [];\nvar ImageEditor = function (settings) {\n    \"use strict\";\n    if (settings === undefined) return this;\n    settings.pixelRatio = 1;\n    var im = this, x, round = function (float) {\n        return Math.round(float)\n    };\n    im.saveData = settings.saveData || {};\n    im.saveUrl = settings.saveUrl;\n    im.width = settings.width;\n    im.height = settings.height;\n    im.strictSize = typeof settings.strictSize !== 'undefined' ? !!settings.strictSize : settings.saveWidth > 0;\n    im.saveWidth = settings.saveWidth || (im.strictSize ? 0 : round(im.width / 2));\n    im.saveHeight = settings.saveHeight || (im.strictSize ? 0 : round(im.height / 2));\n    im.stage = new Kinetic.Stage(settings);\n    im.namespaces = {};\n    im.controlSets = {};\n    im.components = {};\n    im.settings = settings;\n    im.filters = {};\n    im.fileId = im.settings.fID;\n    im.scale = 1;\n    im.crosshair = new Image();\n    im.uniqid = im.stage.getContainer().id;\n    im.editorContext = $(im.stage.getContainer()).parent();\n    im.domContext = im.editorContext.parent();\n    im.controlContext = im.domContext.children('div.controls');\n    im.controlSetNamespaces = [];\n    debugger;\n\n    im.showLoader = $.fn.dialog.showLoader;\n    im.hideLoader = $.fn.dialog.hideLoader;\n    im.stage.im = im;\n    im.stage.elementType = 'stage';\n    im.crosshair.src = CCM_IMAGE_PATH + '/image_editor/crosshair.png';\n\n    im.center = {\n        x: Math.round(im.width / 2),\n        y: Math.round(im.height / 2)\n    };\n\n    im.centerOffset = {\n        x: im.center.x,\n        y: im.center.y\n    };\n\n    var getElem = function (selector) {\n            return $(selector, im.domContext);\n        },\n        log = function () {\n            if (settings.debug === true && typeof console !== 'undefined') {\n                var args = arguments;\n                if (args.length == 1) args = args[0];\n                console.log(args);\n            }\n        },\n        warn = function () {\n            if (settings.debug === true && typeof console !== 'undefined') {\n                var args = arguments;\n                if (args.length == 1) args = args[0];\n                console.warn(args);\n            }\n        },\n        error = function () {\n            if (typeof console !== 'undefined') {\n                var args = arguments;\n                if (args.length == 1) args = args[0];\n                console.error(\"Image Editor Error: \" + args);\n            }\n        };\n\n    im.stage._setDraggable = im.stage.setDraggable;\n    im.stage.setDraggable = function (v) {\n        warn('setting draggable to ' + v);\n        return im.stage._setDraggable(v);\n    };\n\nvar History = function () {\n  var h = this;\n  h.history = [];\n  h.pointer = -1;\n  h.save = function () {\n    im.fire('beforehistorysave');\n    h.history = h.history.slice(0, h.pointer + 1);\n    h.history.push(im.stage.createCopy());\n    h.movePointer(1);\n    im.fire('historysave');\n  };\n  h.movePointer = function (diff) {\n    h.pointer += diff;\n    (h.pointer < 0 && (h.pointer = 0));\n    (h.pointer >= h.history.length && (h.pointer = h.history.length - 1));\n    return h.pointer;\n  };\n  h.render = function () {\n    im.fire('beforehistoryrender');\n    im.stage.loadCopy(h.history[h.pointer]);\n    im.fire('historyrender');\n  };\n  h.undo = function () {\n    im.fire('beforehistoryundo');\n    h.movePointer(-1);\n    h.render();\n    im.fire('historyundo');\n  };\n  h.redo = function () {\n    im.fire('beforehistoryredo');\n    h.movePointer(1);\n    h.render();\n    im.fire('historyredo');\n  };\n};\nim.history = new History();\n\n// Handle event binding.\nim.bindEvent = im.bind = im.on = function (type, handler, elem) {\n  var element = elem || im.stage.getContainer();\n  if (element instanceof jQuery) element = element[0];\n  ConcreteEvent.sub(type,handler,element);\n};\n\n// Handle event firing\nim.fireEvent = im.fire = im.trigger = function (type, data, elem) {\n  var element = elem || im.stage.getContainer();\n  if (element instanceof jQuery) element = element[0];\n  ConcreteEvent.pub(type,data,element);\n};\n\nim.addElement = function(object, type) {\n  var layer = new Kinetic.Layer();\n  object.elementType = type;\n  layer.elementType = type;\n\n  layer.add(object);\n  im.stage.add(layer);\n  layer.moveDown();\n  im.stage.draw();\n};\n\nim.on('backgroundBuilt',function(){\n  if (im.activeElement !== undefined && im.activeElement.doppelganger !== undefined) {\n    im.foreground.add(im.activeElement.doppelganger);\n    im.activeElement.doppelganger.setPosition(im.activeElement.getPosition());\n  }\n});\n\nim.setActiveElement = function(element) {\n  if (element.defer) {\n    return im.setActiveElement(element.defer);\n  }\n  if (im.activeElement == element) return;\n  if (im.activeElement !== undefined && im.activeElement.doppelganger !== undefined) {\n    im.activeElement.doppelganger.remove();\n  }\n  if (element === im.stage || element.nodeType == 'Stage') {\n    im.trigger('ChangeActiveAction', im.controlSetNamespaces.length ? im.controlSetNamespaces[0] : undefined);\n    $('div.control-sets',im.controlContext).find('h4.active').removeClass('active');\n  } else if (element.doppelganger !== undefined) {\n    im.foreground.add(element.doppelganger);\n    im.foreground.draw();\n  }\n  im.trigger('beforeChangeActiveElement',im.activeElement);\n  im.alterCore('activeElement',element);\n  im.trigger('changeActiveElement',element);\n  im.stage.draw();\n};\nim.bind('ClickedElement',function(e, data) {\n  im.setActiveElement(data);\n});\n\nim.bind('stageChanged',function(e){\n  if (im.activeElement.getWidth() > im.stage.getScaledWidth() || im.activeElement .getHeight() > im.stage.getScaledHeight()) {\n    im.setActiveElement(im.stage);\n  }\n});\n\n// Zoom\nvar controlBar = getElem(im.stage.getContainer()).parent().children('.bottomBar');\n\ncontrolBar.attr('unselectable', 'on');\n\nvar zoom = {};\n\nzoom.zoomIn = getElem(\"<div class='bottombarbutton plus'><i class='fa fa-plus'></i></div>\");\nzoom.zoomOut = getElem(\"<div class='bottombarbutton'><i class='fa fa-minus'></i></div>\");\n\nzoom.zoomIn.appendTo(controlBar);\nzoom.zoomOut.appendTo(controlBar);\n\nzoom.zoomIn.click(function(e){im.fire('zoomInClick',e)});\nzoom.zoomOut.click(function(e){im.fire('zoomOutClick',e)});\n\nvar scale = getElem('<div></div>').addClass('scale').text('100%');\nim.on('scaleChange',function(e){\n  scale.text(Math.round(im.scale * 10000)/100 + \"%\");\n});\nscale.click(function(){\n  im.scale = 1;\n  im.stage.setScale(im.scale);\n  var pos = (im.stage.getDragBoundFunc())({x:im.stage.getX(),y:im.stage.getY()});\n  im.stage.setX(pos.x);\n  im.stage.setY(pos.y);\n  im.fire('scaleChange');\n  im.buildBackground();\n  im.stage.draw();\n});\nscale.appendTo(controlBar);\n\nvar minScale = 0, maxScale = 3000, stepScale = 5/6;\n\nim.on('zoomInClick',function(e){\n  var centerx = (-im.stage.getX() + (im.stage.getWidth() / 2)) / im.scale,\n      centery = (-im.stage.getY() + (im.stage.getHeight() / 2)) / im.scale;\n\n  im.scale /= stepScale;\n  im.scale = Math.round(im.scale * 1000) / 1000;\n  im.alterCore('scale',im.scale);\n\n  var ncenterx = (-im.stage.getX() + (im.stage.getWidth() / 2)) / im.scale,\n      ncentery = (-im.stage.getY() + (im.stage.getHeight() / 2)) / im.scale;\n\n  im.stage.setX(im.stage.getX() - (centerx - ncenterx) * im.scale);\n  im.stage.setY(im.stage.getY() - (centery - ncentery) * im.scale);\n\n  im.stage.setScale(im.scale);\n\n  var pos = (im.stage.getDragBoundFunc())({x:im.stage.getX(),y:im.stage.getY()});\n  im.stage.setX(pos.x);\n  im.stage.setY(pos.y);\n\n  im.fire('scaleChange');\n  im.buildBackground();\n  im.stage.draw();\n});\nim.on('zoomOutClick',function(e){\n  var centerx = (-im.stage.getX() + (im.stage.getWidth() / 2)) / im.scale,\n      centery = (-im.stage.getY() + (im.stage.getHeight() / 2)) / im.scale;\n\n  im.scale *= stepScale;\n  im.scale = Math.round(im.scale * 1000) / 1000;\n  im.alterCore('scale',im.scale);\n\n  var ncenterx = (-im.stage.getX() + (im.stage.getWidth() / 2)) / im.scale,\n      ncentery = (-im.stage.getY() + (im.stage.getHeight() / 2)) / im.scale;\n\n  im.stage.setX(im.stage.getX() - (centerx - ncenterx) * im.scale);\n  im.stage.setY(im.stage.getY() - (centery - ncentery) * im.scale);\n\n  im.stage.setScale(im.scale);\n\n  var pos = (im.stage.getDragBoundFunc())({x:im.stage.getX(),y:im.stage.getY()});\n  im.stage.setX(pos.x);\n  im.stage.setY(pos.y);\n\n  im.fire('scaleChange');\n  im.buildBackground();\n  im.stage.draw();\n});\n\n// Save\nvar saveSize = {};\n\nsaveSize.width = getElem('<span/>').addClass('saveWidth');\nsaveSize.height = getElem('<span/>').addClass('saveHeight');\nsaveSize.crop = getElem('<div><i class=\"icon-resize-full\"/></div>').addClass('bottombarbutton').addClass('crop');\nsaveSize.both = saveSize.height.add(saveSize.width).width(32).attr('contenteditable',!!1);\n\nsaveSize.area = getElem('<span/>').css({float:'right'});\n/*saveSize.crop.appendTo(saveSize.area);\nsaveSize.width.appendTo($('<div>w </div>').addClass('saveWidth').appendTo(saveSize.area));\nsaveSize.height.appendTo($('<div>h </div>').addClass('saveHeight').appendTo(saveSize.area));\nsaveSize.area.appendTo(controlBar);\n*/\n\nim.on('adjustedsavers',function(){\n  saveSize.width.text(im.saveWidth);\n  saveSize.height.text(im.saveHeight);\n});\n\nsaveSize.crop.click(function(){\n  im.adjustSavers();\n});\n\nif (im.strictSize) {\n  saveSize.both.attr('disabled','true');\n} else {\n  saveSize.both.keyup(function(e){\n    im.fire('editedSize',e);\n  });\n}\n\nim.bind('editedSize',function(e){\n  im.saveWidth = parseInt(saveSize.width.text());\n  im.saveHeight = parseInt(saveSize.height.text());\n\n  if (isNaN(im.saveWidth)) im.saveWidth = 0;\n  if (isNaN(im.saveHeight)) im.saveHeight = 0;\n\n  //im.trigger('saveSizeChange');\n  im.buildBackground();\n});\n\nim.bind('saveSizeChange',function(){\n  saveSize.width.text(im.saveWidth);\n  saveSize.height.text(im.saveHeight);\n});\n\nim.setCursor = function(cursor) {\n  $(im.stage.getContainer()).css('cursor',cursor);\n};\n\nim.save = function saveImage() {\n    im.fire('ChangeActiveAction');\n    im.fire('ImageEditorWillSave');\n\n    $.fn.dialog.showLoader();\n\n    im.stage.toDataURL({\n        callback: function (data) {\n            var fake_canvas = $('<img />').addClass('fake_canvas').appendTo(im.editorContext.children('.Editor'));\n            fake_canvas.attr('src', data);\n\n            fake_canvas.css({\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                backgroundColor: 'white'\n            });\n\n            var oldStagePosition = im.stage.getPosition(),\n                oldScale = im.scale,\n                oldWidth = im.stage.getWidth(),\n                oldHeight = im.stage.getHeight();\n\n            im.stage.setPosition(-im.saveArea.getX(), -im.saveArea.getY());\n            im.stage.setScale(1);\n            im.background.hide();\n            im.foreground.hide();\n            im.stage.setHeight(im.saveHeight + 100);\n            im.stage.setWidth(im.saveWidth + 100);\n            im.stage.draw();\n\n            var mime = settings.mime;\n            if (mime !== 'image/jpeg' && mime !== 'image/png') {\n                // default to png\n                mime = 'image/png';\n            }\n\n            im.stage.toDataURL({\n                mimeType: mime,\n                quality: settings.jpegCompression,\n                width: im.saveWidth,\n                height: im.saveHeight,\n                callback: function saveImageDataUrlCallback(url) {\n                    im.stage.setPosition(oldStagePosition);\n                    im.background.show();\n                    im.foreground.show();\n                    im.stage.setScale(oldScale);\n                    im.stage.setHeight(oldHeight);\n                    im.stage.setWidth(oldWidth);\n                    im.stage.draw();\n\n                    fake_canvas.remove();\n\n                    $.post(im.saveUrl, _.extend(im.saveData, {\n                        fID: im.fileId,\n                        imgData: url\n                    }), function (res) {\n                        $.fn.dialog.hideLoader();\n                        var result = JSON.parse(res);\n                        if (result.error === 1) {\n                            alert(result.message);\n                            $('button.save[disabled]').attr('disabled', false);\n                        } else if (result.error === 0) {\n                            im.fire('ImageEditorDidSave', _.extend(im.saveData, {\n                                fID: im.fileId,\n                                imgData: url\n                            }));\n                            Concrete.event.fire('ImageEditorDidSave', _.extend(im.saveData, {\n                                fID: im.fileId,\n                                imgData: url\n                            }));\n                        }\n                    });\n                }\n            });\n        }\n    });\n};\n\nim.actualPosition = function actualPosition(x, y, cx, cy, rad) {\n    var ay = y - cy,\n        ax = x - cx,\n        degChange = im.activeElement.getRotation() + Math.atan2(ay, ax),\n        r = Math.sqrt(Math.pow(ax, 2) + Math.pow(ay, 2));\n    return [cx + (r * Math.cos(degChange)), cy + (r * Math.sin(degChange))];\n};\n\nim.getActualRect = function actualRect(cx, cy, elem) {\n    var rect = [], rad = elem.getRotation();\n    rect.push(im.actualPosition(elem.getX(), elem.getY(), cx, cy, rad));\n    rect.push(im.actualPosition(elem.getX() + elem.getWidth() * elem.getScaleX(), elem.getY(), cx, cy, rad));\n    rect.push(im.actualPosition(elem.getX() + elem.getWidth() * elem.getScaleX(), elem.getY() + elem.getHeight() * elem.getScaleY(), cx, cy, rad));\n    rect.push(im.actualPosition(elem.getX(), elem.getY() + elem.getHeight() * elem.getScaleY(), cx, cy, rad));\n    return rect;\n};\n\nim.adjustSavers = function AdjustingSavers(fire) {\n    if (im.activeElement.nodeType === 'Stage') return;\n    im.foreground.autoCrop = false;\n    im.background.autoCrop = false;\n    var i, e, u, score = {min: {x: false, y: false}, max: {x: false, y: false}};\n    /*\n     for (var i = im.stage.children.length - 1; i >= 0; i--) {\n     var layer = im.stage.children[i];\n     if (layer.autoCrop === false) continue;\n     for (var e = layer.children.length - 1; e >= 0; e--) {\n     var child = layer.children[e],\n     rect = im.getActualRect(0, 0, child);\n     console.log(child);\n\n     for (var u = rect.length - 1; u >= 0; u--) {\n     var point = rect[u], x = point[0] + layer.getX(), y = point[1] + layer.getY();\n     if (x > score.max.x || score.max.x === false) score.max.x = x;\n     if (x < score.min.x || score.min.x === false) score.min.x = x;\n     if (y > score.max.y || score.max.y === false) score.max.y = y;\n     if (y < score.min.y || score.min.y === false) score.min.y = y;\n     }\n     }\n     }\n     */\n    var child = im.activeElement,\n        layer = child.parent,\n        rect = im.getActualRect(0, 0, child),\n        u, size;\n\n    for (u = rect.length - 1; u >= 0; u--) {\n        var point = rect[u], x = point[0] + layer.getX(), y = point[1] + layer.getY();\n        if (x > score.max.x || score.max.x === false) score.max.x = x;\n        if (x < score.min.x || score.min.x === false) score.min.x = x;\n        if (y > score.max.y || score.max.y === false) score.max.y = y;\n        if (y < score.min.y || score.min.y === false) score.min.y = y;\n    }\n\n    size = {width: score.max.x - score.min.x, height: score.max.y - score.min.y};\n    if (!im.strictSize) {\n        im.alterCore('saveWidth', Math.round(size.width));\n        im.alterCore('saveHeight', Math.round(size.height));\n        im.buildBackground();\n    }\n\n    var ap = [im.center.x - (im.activeElement.getWidth() * im.activeElement.getScaleX()) / 2,\n            im.center.y - (im.activeElement.getHeight() * im.activeElement.getScaleY()) / 2],\n        adj = im.actualPosition(ap[0], ap[1], im.center.x, im.center.y, im.activeElement.getRotation());\n\n    im.activeElement.parent.setPosition(adj.map(Math.round));\n\n    if (fire !== false) im.fire('adjustedsavers');\n    im.stage.draw();\n};\n\nim.bind('imageLoad', function () {\n    setTimeout(im.adjustSavers, 0);\n});\n\nim.extend = function(property,value) {\n  this[property] = value;\n};\n\nim.alterCore = function(property,value) {\n  var nim = im, ns = 'core', i;\n  if (im.namespace) {\n    var ns = nim.namespace;\n    nim = im.realIm;\n  }\n  im[property] = value;\n  for (i in im.controlSets){\n    im.controlSets[i].im.extend(property,value);\n  }\n  for (i in im.filters){\n    im.filters[i].im.extend(property,value);\n  }\n  for (i in im.components){\n    im.components[i].im.extend(property,value);\n  }\n};\n\nim.clone = function(namespace) {\n  var newim = new ImageEditor(),i;\n  newim.realIm = im;\n  for (i in im) {\n    newim[i] = im[i];\n  }\n  newim.namespace = namespace;\n  return newim;\n};\n\nim.addControlSet = function(ns,js,elem) {\n  if (jQuery && elem instanceof jQuery) elem = elem[0];\n  elem.controlSet = function(im,js) {\n    im.disable = function() {\n      im.enabled = false;\n      $(elem).parent().parent().addClass('disabled');\n    };\n    im.enable = function() {\n      im.enabled = true;\n      $(elem).parent().parent().removeClass('disabled');\n    };\n    this.im = im;\n    this.$ = $;\n    warn('Loading ControlSet',im);\n    try {\n      (new Function('im','$',js)).call(this, im, $);\n    } catch(e) {\n      console.log(e.stack);\n      var pos = e.stack.replace(/[\\S\\s]+at HTMLDivElement.eval.+?<anonymous>:(\\d+:\\d+)[\\S\\s]+/,'$1').split(':');\n      if (pos[1] && !isNaN(parseInt(pos[1]))) {\n        var jsstack = js.split(\"\\n\");\n        var msg = \"Parse error at line #\"+pos[0]+\" char #\"+pos[1]+\" within \"+ns;\n        msg += \"\\n\"+jsstack[parseInt(pos[0])-1];\n        msg += \"\\n\"+(new Array(parseInt(pos[1])).join(\" \"))+\"^\";\n        error(msg);\n      } else {\n        error(\"\\\"\" + e.message + \"\\\" in \\\"\" + im.namespace + \"\\\"\");\n      }\n    }\n    return this;\n  };\n  var newim = im.clone(ns);\n  var nso = elem.controlSet.call(elem,newim,js);\n  im.controlSets[ns] = nso;\n  return nso;\n};\n\nim.addFilter = function(ns,js) {\n  var filter = function(im,js) {\n    this.namespace = im.namespace;\n    this.im = im;\n    try {\n      (new Function('im','$',js)).call(this, im, $);\n    } catch(e) {\n      error(e);\n      window.lastError = e;\n      var pos = e.stack.replace(/[\\S\\s]+at HTMLDivElement.eval.+?<anonymous>:(\\d+:\\d+)[\\S\\s]+/,'$1').split(':');\n      if (pos.length != 2) {\n        error(e.message);\n        error(e.stack);\n      } else {\n        var jsstack = js.split(\"\\n\");\n        var msg = \"Parse error at line #\"+pos[0]+\" char #\"+pos[1]+\" within \"+ns;\n        msg += \"\\n\"+jsstack[parseInt(pos[0])-1];\n        msg += \"\\n\"+(new Array(parseInt(pos[1]) || 0).join(\" \"))+\"^\";\n        error(msg);\n      }\n    }\n    return this;\n  };\n  var newim = im.clone(ns);\n  var nso = new filter(newim,js);\n  im.filters[ns] = nso;\n  return nso;\n};\n\nim.addComponent = function(ns,js,elem) {\n  if (jQuery && elem instanceof jQuery) elem = elem[0];\n  elem.component = function(im,js) {\n    im.disable = function() {\n      $(this).parent().parent().addClass('disabled');\n    };\n    im.enable = function() {\n      $(this).parent().parent().removeClass('disabled');\n    };\n    this.im = im;\n    warn('Loading component',im);\n    try {\n      (new Function('im','$',js)).call(this, im, $);\n    } catch(e) {\n      var pos = e.stack.replace(/[\\S\\s]+at HTMLDivElement.eval.+?<anonymous>:(\\d+:\\d+)[\\S\\s]+/,'$1').split(':');\n      if (pos[1] && !isNaN(parseInt(pos[1]))) {\n        var jsstack = js.split(\"\\n\");\n        var msg = \"Parse error at line #\"+pos[0]+\" char #\"+pos[1]+\" within \"+ns;\n        msg += \"\\n\"+jsstack[parseInt(pos[0])-1];\n        msg += \"\\n\"+(new Array(parseInt(pos[1])).join(\" \"))+\"^\";\n        error(msg);\n      } else {\n        error(\"\\\"\" + e.message + \"\\\" in \\\"\" + im.namespace + \"\\\"\");\n      }\n    }\n    return this;\n  };\n  var newim = im.clone(ns);\n  var nso = elem.component.call(elem,newim,js);\n  im.components[ns] = nso;\n  return nso;\n};\n\n// Set up background\nim.background = new Kinetic.Layer();\nim.foreground = new Kinetic.Layer();\nim.stage.add(im.background);\nim.stage.add(im.foreground);\nim.bgimage = new Image();\nim.saveArea = new Kinetic.Rect();\nim.background.add(im.saveArea);\nim.bind('load', function(){\n  im.saveArea.setFillPatternImage(im.bgimage);\n\n  im.saveArea.setFillPatternOffset([-(im.saveWidth/2),-(im.saveHeight/2)]);\n  im.saveArea.setFillPatternScale(1/im.scale);\n  im.saveArea.setFillPatternX(0);\n  im.saveArea.setFillPatternY(0);\n  im.saveArea.setFillPatternRepeat('repeat');\n\n  im.background.on('click',function(){\n    im.setActiveElement(im.stage);\n  });\n}, im.bgimage);\nim.bgimage.src = CCM_REL + '/concrete/images/testbg.png';\nim.buildBackground = function() {\n  var dimensions = im.stage.getTotalDimensions();\n\n  im.saveArea.setFillPatternOffset([-(im.saveWidth/2) * im.scale,-(im.saveHeight/2) * im.scale]);\n  im.saveArea.setX(Math.round(im.center.x - (im.saveWidth / 2)));\n  im.saveArea.setY(Math.round(im.center.y - (im.saveHeight / 2)));\n  im.saveArea.setFillPatternScale(1/im.scale);\n  im.saveArea.setWidth(im.saveWidth);\n  im.saveArea.setHeight(im.saveHeight);\n\n  if (!im.coverLayer) {\n    im.coverLayer = new Kinetic.Rect;\n    im.coverLayer.setStroke('rgba(150,150,150,.5)');\n    im.coverLayer.setFill('transparent');\n    im.coverLayer.setListening(false);\n    im.coverLayer.setStrokeWidth(Math.max(dimensions.width,dimensions.height,500));\n    im.foreground.add(im.coverLayer);\n  }\n  var width = Math.max(dimensions.width,dimensions.height)*2;\n  im.coverLayer.setPosition(im.saveArea.getX() - width / 2, im.saveArea.getY() - width / 2);\n  im.coverLayer.setSize(im.saveArea.getWidth() + width, im.saveArea.getHeight() + width);\n  im.coverLayer.setStrokeWidth(width);\n  im.fire('backgroundBuilt');\n  //im.foreground.moveToTop();\n  im.saveArea.draw();\n  im.coverLayer.draw();\n    debugger;\n};\n\nim.buildBackground();\nim.on('stageChanged',im.buildBackground);\n\nim.stage.setDragBoundFunc(function (ret) {\n    var dim = im.stage.getTotalDimensions();\n\n    var maxx = Math.max(dim.max.x, dim.min.x) + 100,\n        minx = Math.min(dim.max.x, dim.min.x) - 100,\n        maxy = Math.max(dim.max.y, dim.min.y) + 100,\n        miny = Math.min(dim.max.y, dim.min.y) - 100;\n\n    ret.x = Math.floor(ret.x);\n    ret.y = Math.floor(ret.y);\n\n    if (ret.x > maxx) ret.x = maxx;\n    if (ret.x < minx) ret.x = minx;\n    if (ret.y > maxy) ret.y = maxy;\n    if (ret.y < miny) ret.y = miny;\n\n    ret.x = Math.floor(ret.x);\n    ret.y = Math.floor(ret.y);\n\n    return ret;\n});\nim.setActiveElement(im.stage);\nim.stage.setDraggable(true);\nim.autoCrop = true;\nim.on('imageLoad', function () {\n    var padding = 50;\n\n    var w = im.stage.getWidth() - (padding * 2), h = im.stage.getHeight() - (padding * 2);\n    if (im.saveWidth < w && im.saveHeight < h) return;\n    var perc = Math.max(im.saveWidth / w, im.saveHeight / h);\n\n    im.scale = 1 / perc;\n    im.scale = Math.round(im.scale * 100) / 100;\n    im.alterCore('scale', im.scale);\n\n    im.stage.setScale(im.scale);\n    im.stage.setX((im.stage.getWidth() - (im.stage.getWidth() * im.stage.getScale().x)) / 2);\n    im.stage.setY((im.stage.getHeight() - (im.stage.getHeight() * im.stage.getScale().y)) / 2);\n\n    var pos = (im.stage.getDragBoundFunc())({x: im.stage.getX(), y: im.stage.getY()});\n    im.stage.setX(pos.x);\n    im.stage.setY(pos.y);\n\n    im.fire('scaleChange');\n    im.fire('stageChanged');\n    im.buildBackground();\n});\n\nim.fit = function (wh, scale) {\n    if (scale === false) {\n        return {\n            width: im.saveWidth,\n            height: im.saveHeight\n        };\n    }\n    var height = wh.height,\n        width = wh.width;\n\n    if (width > im.saveWidth) {\n        height /= width / im.saveWidth;\n        width = im.saveWidth;\n    }\n    if (height > im.saveHeight) {\n        width /= height / im.saveHeight;\n        height = im.saveHeight;\n    }\n    return {width: width, height: height};\n};\n\nif (settings.src) {\n    im.showLoader(ccmi18n_imageeditor.loadingImage);\n    var img = new Image(), controlSetsLoaded = false;\n    im.bind('ControlSetsLoaded', function () {\n        controlSetsLoaded = true;\n    });\n\n    im.bind('load', function imageLoaded() {\n        if (!im.strictSize) {\n            im.saveWidth = img.width;\n            im.saveHeight = img.height;\n            im.fire('saveSizeChange');\n            im.buildBackground();\n        } else if (im.saveWidth == 0 || im.saveHeight == 0) {\n            if (im.saveWidth == 0) {\n                if (im.saveHeight == 0) {\n                    im.saveWidth = img.width;\n                    im.saveHeight = img.height;\n\n                    im.fire('saveSizeChange');\n                    im.buildBackground();\n                } else {\n                    im.saveWidth = Math.floor(img.width / img.height * im.saveHeight);\n\n                    im.fire('saveSizeChange');\n                    im.buildBackground();\n                }\n            } else if (im.saveHeight == 0) {\n                im.saveHeight = Math.floor(img.height / img.width * im.saveWidth);\n\n                im.fire('saveSizeChange');\n                im.buildBackground();\n            }\n        }\n        debugger;\n        var center = {\n            x: Math.floor(im.center.x - (img.width / 2)),\n            y: Math.floor(im.center.y - (img.height / 2))\n        };\n        var image = new Kinetic.Image({\n            image: img,\n            x: 0,\n            y: 0\n        });\n        image.setPosition(center);\n        im.addElement(image, 'image');\n        _.defer(function () {\n            im.fire('imageload');\n        });\n        function activate() {\n            _.defer(function activateImageElement() {\n                im.stage.draw();\n                im.setActiveElement(image);\n                im.fire('changeActiveAction', im.controlSetNamespaces[0]);\n            });\n        }\n\n        if (controlSetsLoaded) {\n            activate();\n        } else {\n            im.bind('ControlSetsLoaded', activate);\n        }\n    }, img);\n\n    img.src = settings.src;\n} else {\n    im.fire('imageload');\n}\n\nim.bind('imageload', function () {\n    var cs = settings.controlsets || {}, filters = settings.filters || {}, namespace, firstcs;\n    var running = 0;\n    log('Loading ControlSets');\n    im.showLoader(ccmi18n_imageeditor.loadingControlSets);\n    im.fire('LoadingControlSets');\n    for (namespace in cs) {\n        var myns = \"ControlSet_\" + namespace;\n        im.controlSetNamespaces.push(myns);\n        $.ajax(cs[namespace]['src'], {\n            dataType: 'text',\n            cache: false,\n            namespace: namespace,\n            myns: myns,\n            beforeSend: function () {\n                running++;\n            },\n            success: function (js) {\n                running--;\n                var nso = im.addControlSet(this.myns, js, cs[this.namespace]['element']);\n                log(nso);\n                im.fire('controlSetLoad', nso);\n                if (0 == running) {\n                    im.trigger('ControlSetsLoaded');\n                }\n            },\n            error: function (xhr, errDesc, exception) {\n                running--;\n                if (0 == running) {\n                    im.trigger('ControlSetsLoaded');\n                }\n            }\n        });\n    }\n});\nim.bind('ControlSetsLoaded', function () {\n    im.fire('LoadingComponents');\n    im.showLoader(ccmi18n_imageeditor.loadingComponents);\n    var components = settings.components || {}, namespace, running = 0;\n    log('Loading Components');\n\n    for (namespace in components) {\n        var myns = \"Component_\" + namespace;\n        $.ajax(components[namespace]['src'], {\n            dataType: 'text',\n            cache: false,\n            namespace: namespace,\n            myns: myns,\n            beforeSend: function () {\n                running++;\n            },\n            success: function (js) {\n                running--;\n                var nso = im.addComponent(this.myns, js, components[this.namespace]['element']);\n                log(nso);\n                im.fire('ComponentLoad', nso);\n                if (0 == running) {\n                    im.trigger('ComponentsLoaded');\n                }\n            },\n            error: function (xhr, errDesc, exception) {\n                running--;\n                if (0 == running) {\n                    im.trigger('ComponentsLoaded');\n                }\n            }\n        });\n    }\n    if (0 == running) {\n        im.trigger('ComponentsLoaded');\n    }\n});\n\nim.bind('ComponentsLoaded', function () { // do this when the control sets finish loading.\n    log('Loading Filters');\n    im.showLoader(ccmi18n_imageeditor.loadingFilters);\n    var filters = settings.filters || {}, namespace, firstf, active = 0;\n    im.fire('LoadingFilters');\n    for (namespace in filters) {\n        if (filters.hasOwnProperty(namespace)) {\n            (function(namespace) {\n                var settings = _.clone(filters[namespace]),\n                    myns = \"Filter_\" + namespace,\n                    name = settings.name;\n\n                if (!firstf) {\n                    firstf = myns;\n                }\n\n                active++;\n                $.ajax(filters[namespace].src, {\n                    dataType: 'text',\n                    cache: false,\n                    namespace: namespace,\n                    myns: myns,\n                    name: name,\n                    success: function (js) {\n                        var nso = im.addFilter(this.myns, js);\n                        nso.name = this.name;\n                        nso.settings = settings;\n                        im.fire('filterLoad', nso);\n                        active--;\n                        if (0 === active) {\n                            im.trigger('FiltersLoaded');\n                        }\n                    },\n                    error: function (xhr, errDesc, exception) {\n                        active--;\n                        if (0 === active) {\n                            im.trigger('FiltersLoaded');\n                        }\n                    }\n                });\n            }(namespace));\n        }\n    }\n});\nim.bind('ChangeActiveAction', function (e, ns) {\n    if (ns === im.activeControlSet) return;\n    for (var ons in im.controlSets) {\n        getElem(im.controlSets[ons]);\n        if (ons !== ns) getElem(im.controlSets[ons]).slideUp();\n    }\n    im.activeControlSet = ns;\n    im.alterCore('activeControlSet', ns);\n    if (!ns) {\n        $('div.control-sets', im.controlContext).find('h4.active').removeClass('active');\n        return;\n    }\n    var cs = $(im.controlSets[ns]),\n        height = cs.show().height();\n    if (cs.length == 0) return;\n    cs.hide().height(height).slideDown(function () {\n        $(this).height('')\n    });\n});\n\nim.bind('ChangeActiveComponent', function (e, ns) {\n    if (ns === im.activeComponent) return;\n    for (var ons in im.components) {\n        if (ons !== ns) getElem(im.components[ons]).slideUp();\n    }\n    im.activeComponent = ns;\n    im.alterCore('activeComponent', ns);\n    if (!ns) return;\n    var cs = $(im.components[ns]),\n        height = cs.show().height();\n    if (cs.length == 0) return;\n    cs.hide().height(height).slideDown(function () {\n        $(this).height('')\n    });\n});\n\nim.bind('ChangeNavTab', function (e, data) {\n    im.trigger('ChangeActiveAction', data);\n    im.trigger('ChangeActiveComponent', data);\n    var parent = getElem('div.editorcontrols');\n    switch (data) {\n        case 'add':\n            parent.children('div.control-sets').hide();\n            parent.children('div.components').show();\n            break;\n        case 'edit':\n            parent.children('div.components').hide();\n            parent.children('div.control-sets').show();\n            break;\n    }\n});\n\n\nim.bind('FiltersLoaded', function () {\n    im.hideLoader();\n});\n\nim.slideOut = $(\"<div/>\").addClass('slideOut').css({\n  width:0,\n  float:'right',\n  height:'100%',\n  'overflow-x':'hidden',\n  right:im.controlContext.width()-1,\n  position:'absolute',\n  background:'white',\n  'box-shadow':'black -20px 0 20px -25px'\n});\n\nim.slideOutContents = $('<div/>').appendTo(im.slideOut).width(300);\nim.showSlideOut = function(contents,callback) {\n  im.hideSlideOut(function(){\n    im.slideOut.empty();\n    im.slideOutContents = contents.width(300);\n    im.slideOut.append(im.slideOutContents)\n    im.slideOut.addClass('active').addClass('sliding');\n    im.slideOut.stop(1).slideOut(300, function(){\n      im.slideOut.removeClass('sliding');\n      ((typeof callback === 'function') && callback());\n    });\n  });\n};\nim.hideSlideOut = function(callback) {\n  im.slideOut.addClass('sliding');\n  im.slideOut.slideIn(300,function(){\n    im.slideOut.css('border-right','0');\n    im.slideOut.removeClass('active').removeClass('sliding');\n    ((typeof callback === 'function') && callback());\n  });\n};\nim.controlContext.after(im.slideOut);\n\n    // End the ImageEditor object.\n\n    im.setActiveElement(im.stage);\n\n    window.c5_image_editor = im; // Safe keeping\n    window.im = im;\n    return im;\n};\n\n$.fn.ImageEditor = function (settings) {\n    (settings === undefined && (settings = {}));\n    settings.imageload = $.fn.dialog.hideLoader;\n    var self = $(this);\n    settings.container = self[0];\n    if (self.height() == 0) {\n        setTimeout(function () {\n            self.ImageEditor(settings);\n        }, 50);\n        return;\n    }\n    self.closest('.ui-dialog').find('.ui-resizable-handle').hide();\n    self.height(\"-=30\");\n    $('div.editorcontrols').height(self.height() - 90);\n    self.width(\"-=330\").parent().width(\"-=330\").children('div.bottomBar').width(\"-=330\");\n    (settings.width === undefined && (settings.width = self.width()));\n    (settings.height === undefined && (settings.height = self.height()));\n    $.fn.dialog.showLoader();\n    var im = new ImageEditor(settings);\n\n    var context = im.domContext;\n    $('div.control-sets > div.controlset', context).each(function () {\n        var container = $(this),\n            type = container.data('namespace');\n\n        container.find('h4').click(function () {\n            if (!container.hasClass('active')) {\n                im.fire('ChangeActiveAction', 'ControlSet_' + type);\n            }\n        });\n\n        im.bind('ChangeActiveAction', function(e, data) {\n            if (data === 'ControlSet_' + type) {\n                context.find('div.controlset.active').removeClass('active').children('.control').slideUp(250);\n                container.addClass('active');\n\n                var control = container.children('.control').height('auto');\n                control.slideDown(250);\n            }\n        });\n    });\n\n    $('div.controls > div.controlscontainer', context).children('div.save').children('button.save').click(function () {\n        $(this).attr('disabled', true);\n        im.save();\n    }).end().children('button.cancel').click(function () {\n        if (confirm(ccmi18n_imageeditor.areYouSure))\n            $.fn.dialog.closeTop();\n    });\n\n    im.on('ChangeActiveAction', function (e, data) {\n        if (!data) {\n            $('h4.active', context).removeClass('active');\n        }\n    });\n\n    im.on('ChangeActiveComponent', function (e, data) {\n        if (!data) {\n            $('div.controlset.active', context).removeClass('active');\n        }\n    });\n\n    im.bind('imageload', $.fn.dialog.hideLoader);\n    return im;\n};\n$.fn.slideOut = function (time, callback) {\n    var me = $(this),\n        startWidth = me.width(),\n        totalWidth = 255;\n    me.css('overflow-y', 'auto');\n    if (startWidth == totalWidth) {\n        me.animate({width: totalWidth}, 0, callback);\n        return this;\n    }\n    me.width(startWidth).animate({width: totalWidth}, time || 300, callback || function () {\n    });\n    return this;\n};\n$.fn.slideIn = function (time, callback) {\n    var me = $(this);\n    me.css('overflow-y', 'hidden');\n    if (me.width() === 0) {\n        me.animate({width: 0}, 0, callback);\n        return this;\n    }\n\n    me.animate({width: 0}, time || 300, callback || function () {\n    });\n    return this;\n};\n\nImageEditor.prototype = ImageEditor.fn = {\n  filter: {\n    grayscale: Kinetic.Filters.Grayscale,\n    sepia: function (imageData) {\n      var i;\n      var data = imageData.data;\n      for (i = 0; i < data.length; i += 4) {\n        data[i]     = (data[i] * 0.393 + data[i + 1] * 0.769 + data[i + 2] * 0.189);\n        data[i + 1] = (data[i] * 0.349 + data[i + 1] * 0.686 + data[i + 2] * 0.168);\n        data[i + 2] = (data[i] * 0.272 + data[i + 1] * 0.534 + data[i + 2] * 0.131);\n      }\n    },\n    brightness: function (imageData,ob) {\n      var adjustment = ob.level;\n      var d = imageData.data;\n      for (var i=0; i<d.length; i+=4) {\n        d[i] += adjustment;\n        d[i+1] += adjustment;\n        d[i+2] += adjustment;\n      }\n    },\n    invert: function (imageData,ob) {\n      var d = imageData.data;\n      for (var i=0; i<d.length; i+=4) {\n        d[i] = 255 - d[i];\n        d[i+1] = 255 - d[i+1];\n        d[i+2] = 255 - d[i+2];\n      }\n    },\n    restore: function (imageData,ob) {\n      var adjustment = ob.level;\n        var d = imageData.data;\n        var g = ob.imageData.data;\n      for (var i=0; i<d.length; i+=4) {\n        d[i] = g[i];\n        d[i+1] = g[i+1];\n        d[i+2] = g[i+2];\n      }\n    }\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9jb25jcmV0ZS9qcy9idWlsZC9jb3JlL2ltYWdlLWVkaXRvci9pbWFnZS1lZGl0b3IuanM/NjRjYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gICAgICBLaW5ldGljLk5vZGUgICAgICAgLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5LaW5ldGljLk5vZGUucHJvdG90eXBlLmNsb3Nlc3QgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciBhY3RpdmUgPSB0aGlzLnBhcmVudDtcbiAgd2hpbGUgKGFjdGl2ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKGFjdGl2ZS5ub2RlVHlwZSA9PT0gdHlwZSkgcmV0dXJuIGFjdGl2ZTtcbiAgICBhY3RpdmUgPSBhY3RpdmUucGFyZW50O1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vICAgICAgS2luZXRpYy5TdGFnZSAgICAgIC8vXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuS2luZXRpYy5TdGFnZS5wcm90b3R5cGUuY3JlYXRlQ29weSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvcHkgPSBbXSwgY2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuKCksIGk7XG4gIGZvciAoaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgIGNvcHkucHVzaChjaGlsZHJlbltpXS5jbG9uZSgpKTtcbiAgfVxuICByZXR1cm4gY29weTtcbn07XG5LaW5ldGljLlN0YWdlLnByb3RvdHlwZS5nZXRTY2FsZWRXaWR0aCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gTWF0aC5jZWlsKHRoaXMuZ2V0V2lkdGgoKSAvIHRoaXMuZ2V0U2NhbGUoKS54KTtcbn07XG5LaW5ldGljLlN0YWdlLnByb3RvdHlwZS5nZXRTY2FsZWRIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIE1hdGguY2VpbCh0aGlzLmdldEhlaWdodCgpIC8gdGhpcy5nZXRTY2FsZSgpLnkpO1xufTtcbktpbmV0aWMuU3RhZ2UucHJvdG90eXBlLmdldFNhdmVXaWR0aCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5pbS5zYXZlV2lkdGg7XG59O1xuS2luZXRpYy5TdGFnZS5wcm90b3R5cGUuZ2V0U2F2ZUhlaWdodCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5pbS5zYXZlSGVpZ2h0O1xufTtcbktpbmV0aWMuU3RhZ2UucHJvdG90eXBlLmdldFRvdGFsRGltZW5zaW9ucyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbWluWSA9ICh0aGlzLmdldFNhdmVIZWlnaHQoKSAvIDIgLSB0aGlzLmltLmNlbnRlci55KSAqIHRoaXMuZ2V0U2NhbGUoKS55O1xuICB2YXIgbWF4WSA9IG1pblkgKyB0aGlzLmdldEhlaWdodCgpIC0gKHRoaXMuZ2V0U2F2ZUhlaWdodCgpICogdGhpcy5nZXRTY2FsZSgpLnkpO1xuXG4gIHZhciBtaW5YID0gKHRoaXMuZ2V0U2F2ZVdpZHRoKCkgLyAyIC0gdGhpcy5pbS5jZW50ZXIueCkgKiB0aGlzLmdldFNjYWxlKCkueDtcbiAgdmFyIG1heFggPSBtaW5YICsgdGhpcy5nZXRXaWR0aCgpIC0gKHRoaXMuZ2V0U2F2ZVdpZHRoKCkgKiB0aGlzLmdldFNjYWxlKCkueCk7XG5cbiAgcmV0dXJuIHtcbiAgICBtaW46IHtcbiAgICAgIHg6IG1pblgsXG4gICAgICB5OiBtaW5ZXG4gICAgfSxcbiAgICBtYXg6IHtcbiAgICAgIHg6IG1heFgsXG4gICAgICB5OiBtYXhZXG4gICAgfSxcbiAgICB3aWR0aDp0aGlzLmdldFNjYWxlZFdpZHRoKCksXG4gICAgaGVpZ2h0OnRoaXMuZ2V0U2NhbGVkSGVpZ2h0KCksXG4gICAgdmlzaWJsZVdpZHRoOk1hdGgubWF4KHRoaXMuZ2V0U2F2ZVdpZHRoKCksdGhpcy5nZXRTY2FsZWRXaWR0aCgpICogMiAtIHRoaXMuZ2V0U2F2ZVdpZHRoKCkpLFxuICAgIHZpc2libGVIZWlnaHQ6TWF0aC5tYXgodGhpcy5nZXRTYXZlSGVpZ2h0KCksdGhpcy5nZXRTY2FsZWRIZWlnaHQoKSAqIDIgLSB0aGlzLmdldFNhdmVIZWlnaHQoKSlcbiAgfTtcbn07XG5LaW5ldGljLlN0YWdlLnByb3RvdHlwZS5sb2FkQ29weSA9IGZ1bmN0aW9uIChjb3B5KSB7XG4gIHZhciBpO1xuICB0aGlzLnJlbW92ZUNoaWxkcmVuKCk7XG4gIGZvciAoaSA9IDA7IGkgPCBjb3B5Lmxlbmd0aDsgaSsrKSB7XG4gICAgdGhpcy5hZGQoY29weVtpXSk7XG4gIH1cbiAgdGhpcy5kcmF3KCk7XG59O1xuS2luZXRpYy5TdGFnZS5wcm90b3R5cGUuZWxlbWVudFR5cGUgPSAnc3RhZ2UnO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gICAgICBLaW5ldGljLkltYWdlICAgICAgLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5LaW5ldGljLkltYWdlLnByb3RvdHlwZS5nZXRJbWFnZURhdGEgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGNhbnZhcyA9IG5ldyBLaW5ldGljLkNhbnZhcyh0aGlzLmF0dHJzLmltYWdlLndpZHRoLCB0aGlzLmF0dHJzLmltYWdlLmhlaWdodCk7XG4gIHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoKTtcbiAgY29udGV4dC5kcmF3SW1hZ2UodGhpcy5hdHRycy5pbWFnZSwgMCwgMCk7XG4gIHRyeSB7XG4gICAgICB2YXIgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLmdldFdpZHRoKCksIGNhbnZhcy5nZXRIZWlnaHQoKSk7XG4gICAgICByZXR1cm4gaW1hZ2VEYXRhO1xuICB9IGNhdGNoKGUpIHtcbiAgICAgIEtpbmV0aWMuVXRpbC53YXJuKCdVbmFibGUgdG8gZ2V0IGltYWdlRGF0YS4nKTtcbiAgfVxufTtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vICAgICAgS2luZXRpYy5MYXllciAgICAgIC8vXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuS2luZXRpYy5MYXllci5wcm90b3R5cGUuX2NhY2hlZGRyYXcgPSAobmV3IEtpbmV0aWMuTGF5ZXIpLmRyYXc7XG5LaW5ldGljLkxheWVyLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0eXBlb2YgaW0gPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBpbS50cmlnZ2VyID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiB0aGlzLl9jYWNoZWRkcmF3KCk7XG4gIH1cbiAgLy9pbS50cmlnZ2VyKCdiZWZvcmVyZWRyYXcnLHRoaXMpO1xuICB2YXIgZHJhdyA9IHRoaXMuX2NhY2hlZGRyYXcoKTtcbiAgLy9pbS50cmlnZ2VyKCdhZnRlcnJlZHJhdycsdGhpcyk7XG4gIHJldHVybiBkcmF3O1xufTtcbktpbmV0aWMuTGF5ZXIucHJvdG90eXBlLmVsZW1lbnRUeXBlID0gJ2xheWVyJztcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gICAgICBLaW5ldGljLkdyb3VwICAgICAgLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5LaW5ldGljLkdyb3VwLnByb3RvdHlwZS5lbGVtZW50VHlwZSA9ICdncm91cCc7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyAgICAgICBLaW5ldGljLlRleHQgICAgICAvL1xuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbktpbmV0aWMuVGV4dC5wcm90b3R5cGUucmFzdGVyaXplID0gZnVuY3Rpb24oZSkge1xuICB2YXIgbGF5ZXIgPSB0aGlzLnBhcmVudDtcbiAgdmFyIG1lID0gdGhpcztcbiAgdGhpcy50b0ltYWdlKHtcbiAgICBjYWxsYmFjazpmdW5jdGlvbihpbWcpe1xuICAgICAgdmFyIHJhc3Rlcml6ZWRJbWFnZSA9IG5ldyBLaW5ldGljLkltYWdlKHtpbWFnZTppbWcseDptZS5nZXRQb3NpdGlvbigpLngseTptZS5nZXRQb3NpdGlvbigpLnl9KTtcbiAgICAgIG1lLnJlbW92ZSgpO1xuICAgICAgbGF5ZXIuYWRkKHJhc3Rlcml6ZWRJbWFnZSkuZHJhdygpO1xuICAgICAgZS5jYWxsYmFjayhyYXN0ZXJpemVkSW1hZ2UpO1xuICAgIH1cbiAgfSk7XG59O1xuXG52YXIgY29udHJvbF9zZXRzID0gW10sIGNvbXBvbmVudHMgPSBbXSwgZmlsdGVycyA9IFtdO1xudmFyIEltYWdlRWRpdG9yID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgaWYgKHNldHRpbmdzID09PSB1bmRlZmluZWQpIHJldHVybiB0aGlzO1xuICAgIHNldHRpbmdzLnBpeGVsUmF0aW8gPSAxO1xuICAgIHZhciBpbSA9IHRoaXMsIHgsIHJvdW5kID0gZnVuY3Rpb24gKGZsb2F0KSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGZsb2F0KVxuICAgIH07XG4gICAgaW0uc2F2ZURhdGEgPSBzZXR0aW5ncy5zYXZlRGF0YSB8fCB7fTtcbiAgICBpbS5zYXZlVXJsID0gc2V0dGluZ3Muc2F2ZVVybDtcbiAgICBpbS53aWR0aCA9IHNldHRpbmdzLndpZHRoO1xuICAgIGltLmhlaWdodCA9IHNldHRpbmdzLmhlaWdodDtcbiAgICBpbS5zdHJpY3RTaXplID0gdHlwZW9mIHNldHRpbmdzLnN0cmljdFNpemUgIT09ICd1bmRlZmluZWQnID8gISFzZXR0aW5ncy5zdHJpY3RTaXplIDogc2V0dGluZ3Muc2F2ZVdpZHRoID4gMDtcbiAgICBpbS5zYXZlV2lkdGggPSBzZXR0aW5ncy5zYXZlV2lkdGggfHwgKGltLnN0cmljdFNpemUgPyAwIDogcm91bmQoaW0ud2lkdGggLyAyKSk7XG4gICAgaW0uc2F2ZUhlaWdodCA9IHNldHRpbmdzLnNhdmVIZWlnaHQgfHwgKGltLnN0cmljdFNpemUgPyAwIDogcm91bmQoaW0uaGVpZ2h0IC8gMikpO1xuICAgIGltLnN0YWdlID0gbmV3IEtpbmV0aWMuU3RhZ2Uoc2V0dGluZ3MpO1xuICAgIGltLm5hbWVzcGFjZXMgPSB7fTtcbiAgICBpbS5jb250cm9sU2V0cyA9IHt9O1xuICAgIGltLmNvbXBvbmVudHMgPSB7fTtcbiAgICBpbS5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIGltLmZpbHRlcnMgPSB7fTtcbiAgICBpbS5maWxlSWQgPSBpbS5zZXR0aW5ncy5mSUQ7XG4gICAgaW0uc2NhbGUgPSAxO1xuICAgIGltLmNyb3NzaGFpciA9IG5ldyBJbWFnZSgpO1xuICAgIGltLnVuaXFpZCA9IGltLnN0YWdlLmdldENvbnRhaW5lcigpLmlkO1xuICAgIGltLmVkaXRvckNvbnRleHQgPSAkKGltLnN0YWdlLmdldENvbnRhaW5lcigpKS5wYXJlbnQoKTtcbiAgICBpbS5kb21Db250ZXh0ID0gaW0uZWRpdG9yQ29udGV4dC5wYXJlbnQoKTtcbiAgICBpbS5jb250cm9sQ29udGV4dCA9IGltLmRvbUNvbnRleHQuY2hpbGRyZW4oJ2Rpdi5jb250cm9scycpO1xuICAgIGltLmNvbnRyb2xTZXROYW1lc3BhY2VzID0gW107XG4gICAgZGVidWdnZXI7XG5cbiAgICBpbS5zaG93TG9hZGVyID0gJC5mbi5kaWFsb2cuc2hvd0xvYWRlcjtcbiAgICBpbS5oaWRlTG9hZGVyID0gJC5mbi5kaWFsb2cuaGlkZUxvYWRlcjtcbiAgICBpbS5zdGFnZS5pbSA9IGltO1xuICAgIGltLnN0YWdlLmVsZW1lbnRUeXBlID0gJ3N0YWdlJztcbiAgICBpbS5jcm9zc2hhaXIuc3JjID0gQ0NNX0lNQUdFX1BBVEggKyAnL2ltYWdlX2VkaXRvci9jcm9zc2hhaXIucG5nJztcblxuICAgIGltLmNlbnRlciA9IHtcbiAgICAgICAgeDogTWF0aC5yb3VuZChpbS53aWR0aCAvIDIpLFxuICAgICAgICB5OiBNYXRoLnJvdW5kKGltLmhlaWdodCAvIDIpXG4gICAgfTtcblxuICAgIGltLmNlbnRlck9mZnNldCA9IHtcbiAgICAgICAgeDogaW0uY2VudGVyLngsXG4gICAgICAgIHk6IGltLmNlbnRlci55XG4gICAgfTtcblxuICAgIHZhciBnZXRFbGVtID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gJChzZWxlY3RvciwgaW0uZG9tQ29udGV4dCk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5kZWJ1ZyA9PT0gdHJ1ZSAmJiB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPT0gMSkgYXJncyA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHdhcm4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MuZGVidWcgPT09IHRydWUgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDEpIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihhcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDEpIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbWFnZSBFZGl0b3IgRXJyb3I6IFwiICsgYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICBpbS5zdGFnZS5fc2V0RHJhZ2dhYmxlID0gaW0uc3RhZ2Uuc2V0RHJhZ2dhYmxlO1xuICAgIGltLnN0YWdlLnNldERyYWdnYWJsZSA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHdhcm4oJ3NldHRpbmcgZHJhZ2dhYmxlIHRvICcgKyB2KTtcbiAgICAgICAgcmV0dXJuIGltLnN0YWdlLl9zZXREcmFnZ2FibGUodik7XG4gICAgfTtcblxudmFyIEhpc3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBoID0gdGhpcztcbiAgaC5oaXN0b3J5ID0gW107XG4gIGgucG9pbnRlciA9IC0xO1xuICBoLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaW0uZmlyZSgnYmVmb3JlaGlzdG9yeXNhdmUnKTtcbiAgICBoLmhpc3RvcnkgPSBoLmhpc3Rvcnkuc2xpY2UoMCwgaC5wb2ludGVyICsgMSk7XG4gICAgaC5oaXN0b3J5LnB1c2goaW0uc3RhZ2UuY3JlYXRlQ29weSgpKTtcbiAgICBoLm1vdmVQb2ludGVyKDEpO1xuICAgIGltLmZpcmUoJ2hpc3RvcnlzYXZlJyk7XG4gIH07XG4gIGgubW92ZVBvaW50ZXIgPSBmdW5jdGlvbiAoZGlmZikge1xuICAgIGgucG9pbnRlciArPSBkaWZmO1xuICAgIChoLnBvaW50ZXIgPCAwICYmIChoLnBvaW50ZXIgPSAwKSk7XG4gICAgKGgucG9pbnRlciA+PSBoLmhpc3RvcnkubGVuZ3RoICYmIChoLnBvaW50ZXIgPSBoLmhpc3RvcnkubGVuZ3RoIC0gMSkpO1xuICAgIHJldHVybiBoLnBvaW50ZXI7XG4gIH07XG4gIGgucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGltLmZpcmUoJ2JlZm9yZWhpc3RvcnlyZW5kZXInKTtcbiAgICBpbS5zdGFnZS5sb2FkQ29weShoLmhpc3RvcnlbaC5wb2ludGVyXSk7XG4gICAgaW0uZmlyZSgnaGlzdG9yeXJlbmRlcicpO1xuICB9O1xuICBoLnVuZG8gPSBmdW5jdGlvbiAoKSB7XG4gICAgaW0uZmlyZSgnYmVmb3JlaGlzdG9yeXVuZG8nKTtcbiAgICBoLm1vdmVQb2ludGVyKC0xKTtcbiAgICBoLnJlbmRlcigpO1xuICAgIGltLmZpcmUoJ2hpc3Rvcnl1bmRvJyk7XG4gIH07XG4gIGgucmVkbyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpbS5maXJlKCdiZWZvcmVoaXN0b3J5cmVkbycpO1xuICAgIGgubW92ZVBvaW50ZXIoMSk7XG4gICAgaC5yZW5kZXIoKTtcbiAgICBpbS5maXJlKCdoaXN0b3J5cmVkbycpO1xuICB9O1xufTtcbmltLmhpc3RvcnkgPSBuZXcgSGlzdG9yeSgpO1xuXG4vLyBIYW5kbGUgZXZlbnQgYmluZGluZy5cbmltLmJpbmRFdmVudCA9IGltLmJpbmQgPSBpbS5vbiA9IGZ1bmN0aW9uICh0eXBlLCBoYW5kbGVyLCBlbGVtKSB7XG4gIHZhciBlbGVtZW50ID0gZWxlbSB8fCBpbS5zdGFnZS5nZXRDb250YWluZXIoKTtcbiAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBqUXVlcnkpIGVsZW1lbnQgPSBlbGVtZW50WzBdO1xuICBDb25jcmV0ZUV2ZW50LnN1Yih0eXBlLGhhbmRsZXIsZWxlbWVudCk7XG59O1xuXG4vLyBIYW5kbGUgZXZlbnQgZmlyaW5nXG5pbS5maXJlRXZlbnQgPSBpbS5maXJlID0gaW0udHJpZ2dlciA9IGZ1bmN0aW9uICh0eXBlLCBkYXRhLCBlbGVtKSB7XG4gIHZhciBlbGVtZW50ID0gZWxlbSB8fCBpbS5zdGFnZS5nZXRDb250YWluZXIoKTtcbiAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBqUXVlcnkpIGVsZW1lbnQgPSBlbGVtZW50WzBdO1xuICBDb25jcmV0ZUV2ZW50LnB1Yih0eXBlLGRhdGEsZWxlbWVudCk7XG59O1xuXG5pbS5hZGRFbGVtZW50ID0gZnVuY3Rpb24ob2JqZWN0LCB0eXBlKSB7XG4gIHZhciBsYXllciA9IG5ldyBLaW5ldGljLkxheWVyKCk7XG4gIG9iamVjdC5lbGVtZW50VHlwZSA9IHR5cGU7XG4gIGxheWVyLmVsZW1lbnRUeXBlID0gdHlwZTtcblxuICBsYXllci5hZGQob2JqZWN0KTtcbiAgaW0uc3RhZ2UuYWRkKGxheWVyKTtcbiAgbGF5ZXIubW92ZURvd24oKTtcbiAgaW0uc3RhZ2UuZHJhdygpO1xufTtcblxuaW0ub24oJ2JhY2tncm91bmRCdWlsdCcsZnVuY3Rpb24oKXtcbiAgaWYgKGltLmFjdGl2ZUVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBpbS5hY3RpdmVFbGVtZW50LmRvcHBlbGdhbmdlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaW0uZm9yZWdyb3VuZC5hZGQoaW0uYWN0aXZlRWxlbWVudC5kb3BwZWxnYW5nZXIpO1xuICAgIGltLmFjdGl2ZUVsZW1lbnQuZG9wcGVsZ2FuZ2VyLnNldFBvc2l0aW9uKGltLmFjdGl2ZUVsZW1lbnQuZ2V0UG9zaXRpb24oKSk7XG4gIH1cbn0pO1xuXG5pbS5zZXRBY3RpdmVFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICBpZiAoZWxlbWVudC5kZWZlcikge1xuICAgIHJldHVybiBpbS5zZXRBY3RpdmVFbGVtZW50KGVsZW1lbnQuZGVmZXIpO1xuICB9XG4gIGlmIChpbS5hY3RpdmVFbGVtZW50ID09IGVsZW1lbnQpIHJldHVybjtcbiAgaWYgKGltLmFjdGl2ZUVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBpbS5hY3RpdmVFbGVtZW50LmRvcHBlbGdhbmdlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaW0uYWN0aXZlRWxlbWVudC5kb3BwZWxnYW5nZXIucmVtb3ZlKCk7XG4gIH1cbiAgaWYgKGVsZW1lbnQgPT09IGltLnN0YWdlIHx8IGVsZW1lbnQubm9kZVR5cGUgPT0gJ1N0YWdlJykge1xuICAgIGltLnRyaWdnZXIoJ0NoYW5nZUFjdGl2ZUFjdGlvbicsIGltLmNvbnRyb2xTZXROYW1lc3BhY2VzLmxlbmd0aCA/IGltLmNvbnRyb2xTZXROYW1lc3BhY2VzWzBdIDogdW5kZWZpbmVkKTtcbiAgICAkKCdkaXYuY29udHJvbC1zZXRzJyxpbS5jb250cm9sQ29udGV4dCkuZmluZCgnaDQuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICB9IGVsc2UgaWYgKGVsZW1lbnQuZG9wcGVsZ2FuZ2VyICE9PSB1bmRlZmluZWQpIHtcbiAgICBpbS5mb3JlZ3JvdW5kLmFkZChlbGVtZW50LmRvcHBlbGdhbmdlcik7XG4gICAgaW0uZm9yZWdyb3VuZC5kcmF3KCk7XG4gIH1cbiAgaW0udHJpZ2dlcignYmVmb3JlQ2hhbmdlQWN0aXZlRWxlbWVudCcsaW0uYWN0aXZlRWxlbWVudCk7XG4gIGltLmFsdGVyQ29yZSgnYWN0aXZlRWxlbWVudCcsZWxlbWVudCk7XG4gIGltLnRyaWdnZXIoJ2NoYW5nZUFjdGl2ZUVsZW1lbnQnLGVsZW1lbnQpO1xuICBpbS5zdGFnZS5kcmF3KCk7XG59O1xuaW0uYmluZCgnQ2xpY2tlZEVsZW1lbnQnLGZ1bmN0aW9uKGUsIGRhdGEpIHtcbiAgaW0uc2V0QWN0aXZlRWxlbWVudChkYXRhKTtcbn0pO1xuXG5pbS5iaW5kKCdzdGFnZUNoYW5nZWQnLGZ1bmN0aW9uKGUpe1xuICBpZiAoaW0uYWN0aXZlRWxlbWVudC5nZXRXaWR0aCgpID4gaW0uc3RhZ2UuZ2V0U2NhbGVkV2lkdGgoKSB8fCBpbS5hY3RpdmVFbGVtZW50IC5nZXRIZWlnaHQoKSA+IGltLnN0YWdlLmdldFNjYWxlZEhlaWdodCgpKSB7XG4gICAgaW0uc2V0QWN0aXZlRWxlbWVudChpbS5zdGFnZSk7XG4gIH1cbn0pO1xuXG4vLyBab29tXG52YXIgY29udHJvbEJhciA9IGdldEVsZW0oaW0uc3RhZ2UuZ2V0Q29udGFpbmVyKCkpLnBhcmVudCgpLmNoaWxkcmVuKCcuYm90dG9tQmFyJyk7XG5cbmNvbnRyb2xCYXIuYXR0cigndW5zZWxlY3RhYmxlJywgJ29uJyk7XG5cbnZhciB6b29tID0ge307XG5cbnpvb20uem9vbUluID0gZ2V0RWxlbShcIjxkaXYgY2xhc3M9J2JvdHRvbWJhcmJ1dHRvbiBwbHVzJz48aSBjbGFzcz0nZmEgZmEtcGx1cyc+PC9pPjwvZGl2PlwiKTtcbnpvb20uem9vbU91dCA9IGdldEVsZW0oXCI8ZGl2IGNsYXNzPSdib3R0b21iYXJidXR0b24nPjxpIGNsYXNzPSdmYSBmYS1taW51cyc+PC9pPjwvZGl2PlwiKTtcblxuem9vbS56b29tSW4uYXBwZW5kVG8oY29udHJvbEJhcik7XG56b29tLnpvb21PdXQuYXBwZW5kVG8oY29udHJvbEJhcik7XG5cbnpvb20uem9vbUluLmNsaWNrKGZ1bmN0aW9uKGUpe2ltLmZpcmUoJ3pvb21JbkNsaWNrJyxlKX0pO1xuem9vbS56b29tT3V0LmNsaWNrKGZ1bmN0aW9uKGUpe2ltLmZpcmUoJ3pvb21PdXRDbGljaycsZSl9KTtcblxudmFyIHNjYWxlID0gZ2V0RWxlbSgnPGRpdj48L2Rpdj4nKS5hZGRDbGFzcygnc2NhbGUnKS50ZXh0KCcxMDAlJyk7XG5pbS5vbignc2NhbGVDaGFuZ2UnLGZ1bmN0aW9uKGUpe1xuICBzY2FsZS50ZXh0KE1hdGgucm91bmQoaW0uc2NhbGUgKiAxMDAwMCkvMTAwICsgXCIlXCIpO1xufSk7XG5zY2FsZS5jbGljayhmdW5jdGlvbigpe1xuICBpbS5zY2FsZSA9IDE7XG4gIGltLnN0YWdlLnNldFNjYWxlKGltLnNjYWxlKTtcbiAgdmFyIHBvcyA9IChpbS5zdGFnZS5nZXREcmFnQm91bmRGdW5jKCkpKHt4OmltLnN0YWdlLmdldFgoKSx5OmltLnN0YWdlLmdldFkoKX0pO1xuICBpbS5zdGFnZS5zZXRYKHBvcy54KTtcbiAgaW0uc3RhZ2Uuc2V0WShwb3MueSk7XG4gIGltLmZpcmUoJ3NjYWxlQ2hhbmdlJyk7XG4gIGltLmJ1aWxkQmFja2dyb3VuZCgpO1xuICBpbS5zdGFnZS5kcmF3KCk7XG59KTtcbnNjYWxlLmFwcGVuZFRvKGNvbnRyb2xCYXIpO1xuXG52YXIgbWluU2NhbGUgPSAwLCBtYXhTY2FsZSA9IDMwMDAsIHN0ZXBTY2FsZSA9IDUvNjtcblxuaW0ub24oJ3pvb21JbkNsaWNrJyxmdW5jdGlvbihlKXtcbiAgdmFyIGNlbnRlcnggPSAoLWltLnN0YWdlLmdldFgoKSArIChpbS5zdGFnZS5nZXRXaWR0aCgpIC8gMikpIC8gaW0uc2NhbGUsXG4gICAgICBjZW50ZXJ5ID0gKC1pbS5zdGFnZS5nZXRZKCkgKyAoaW0uc3RhZ2UuZ2V0SGVpZ2h0KCkgLyAyKSkgLyBpbS5zY2FsZTtcblxuICBpbS5zY2FsZSAvPSBzdGVwU2NhbGU7XG4gIGltLnNjYWxlID0gTWF0aC5yb3VuZChpbS5zY2FsZSAqIDEwMDApIC8gMTAwMDtcbiAgaW0uYWx0ZXJDb3JlKCdzY2FsZScsaW0uc2NhbGUpO1xuXG4gIHZhciBuY2VudGVyeCA9ICgtaW0uc3RhZ2UuZ2V0WCgpICsgKGltLnN0YWdlLmdldFdpZHRoKCkgLyAyKSkgLyBpbS5zY2FsZSxcbiAgICAgIG5jZW50ZXJ5ID0gKC1pbS5zdGFnZS5nZXRZKCkgKyAoaW0uc3RhZ2UuZ2V0SGVpZ2h0KCkgLyAyKSkgLyBpbS5zY2FsZTtcblxuICBpbS5zdGFnZS5zZXRYKGltLnN0YWdlLmdldFgoKSAtIChjZW50ZXJ4IC0gbmNlbnRlcngpICogaW0uc2NhbGUpO1xuICBpbS5zdGFnZS5zZXRZKGltLnN0YWdlLmdldFkoKSAtIChjZW50ZXJ5IC0gbmNlbnRlcnkpICogaW0uc2NhbGUpO1xuXG4gIGltLnN0YWdlLnNldFNjYWxlKGltLnNjYWxlKTtcblxuICB2YXIgcG9zID0gKGltLnN0YWdlLmdldERyYWdCb3VuZEZ1bmMoKSkoe3g6aW0uc3RhZ2UuZ2V0WCgpLHk6aW0uc3RhZ2UuZ2V0WSgpfSk7XG4gIGltLnN0YWdlLnNldFgocG9zLngpO1xuICBpbS5zdGFnZS5zZXRZKHBvcy55KTtcblxuICBpbS5maXJlKCdzY2FsZUNoYW5nZScpO1xuICBpbS5idWlsZEJhY2tncm91bmQoKTtcbiAgaW0uc3RhZ2UuZHJhdygpO1xufSk7XG5pbS5vbignem9vbU91dENsaWNrJyxmdW5jdGlvbihlKXtcbiAgdmFyIGNlbnRlcnggPSAoLWltLnN0YWdlLmdldFgoKSArIChpbS5zdGFnZS5nZXRXaWR0aCgpIC8gMikpIC8gaW0uc2NhbGUsXG4gICAgICBjZW50ZXJ5ID0gKC1pbS5zdGFnZS5nZXRZKCkgKyAoaW0uc3RhZ2UuZ2V0SGVpZ2h0KCkgLyAyKSkgLyBpbS5zY2FsZTtcblxuICBpbS5zY2FsZSAqPSBzdGVwU2NhbGU7XG4gIGltLnNjYWxlID0gTWF0aC5yb3VuZChpbS5zY2FsZSAqIDEwMDApIC8gMTAwMDtcbiAgaW0uYWx0ZXJDb3JlKCdzY2FsZScsaW0uc2NhbGUpO1xuXG4gIHZhciBuY2VudGVyeCA9ICgtaW0uc3RhZ2UuZ2V0WCgpICsgKGltLnN0YWdlLmdldFdpZHRoKCkgLyAyKSkgLyBpbS5zY2FsZSxcbiAgICAgIG5jZW50ZXJ5ID0gKC1pbS5zdGFnZS5nZXRZKCkgKyAoaW0uc3RhZ2UuZ2V0SGVpZ2h0KCkgLyAyKSkgLyBpbS5zY2FsZTtcblxuICBpbS5zdGFnZS5zZXRYKGltLnN0YWdlLmdldFgoKSAtIChjZW50ZXJ4IC0gbmNlbnRlcngpICogaW0uc2NhbGUpO1xuICBpbS5zdGFnZS5zZXRZKGltLnN0YWdlLmdldFkoKSAtIChjZW50ZXJ5IC0gbmNlbnRlcnkpICogaW0uc2NhbGUpO1xuXG4gIGltLnN0YWdlLnNldFNjYWxlKGltLnNjYWxlKTtcblxuICB2YXIgcG9zID0gKGltLnN0YWdlLmdldERyYWdCb3VuZEZ1bmMoKSkoe3g6aW0uc3RhZ2UuZ2V0WCgpLHk6aW0uc3RhZ2UuZ2V0WSgpfSk7XG4gIGltLnN0YWdlLnNldFgocG9zLngpO1xuICBpbS5zdGFnZS5zZXRZKHBvcy55KTtcblxuICBpbS5maXJlKCdzY2FsZUNoYW5nZScpO1xuICBpbS5idWlsZEJhY2tncm91bmQoKTtcbiAgaW0uc3RhZ2UuZHJhdygpO1xufSk7XG5cbi8vIFNhdmVcbnZhciBzYXZlU2l6ZSA9IHt9O1xuXG5zYXZlU2l6ZS53aWR0aCA9IGdldEVsZW0oJzxzcGFuLz4nKS5hZGRDbGFzcygnc2F2ZVdpZHRoJyk7XG5zYXZlU2l6ZS5oZWlnaHQgPSBnZXRFbGVtKCc8c3Bhbi8+JykuYWRkQ2xhc3MoJ3NhdmVIZWlnaHQnKTtcbnNhdmVTaXplLmNyb3AgPSBnZXRFbGVtKCc8ZGl2PjxpIGNsYXNzPVwiaWNvbi1yZXNpemUtZnVsbFwiLz48L2Rpdj4nKS5hZGRDbGFzcygnYm90dG9tYmFyYnV0dG9uJykuYWRkQ2xhc3MoJ2Nyb3AnKTtcbnNhdmVTaXplLmJvdGggPSBzYXZlU2l6ZS5oZWlnaHQuYWRkKHNhdmVTaXplLndpZHRoKS53aWR0aCgzMikuYXR0cignY29udGVudGVkaXRhYmxlJywhITEpO1xuXG5zYXZlU2l6ZS5hcmVhID0gZ2V0RWxlbSgnPHNwYW4vPicpLmNzcyh7ZmxvYXQ6J3JpZ2h0J30pO1xuLypzYXZlU2l6ZS5jcm9wLmFwcGVuZFRvKHNhdmVTaXplLmFyZWEpO1xuc2F2ZVNpemUud2lkdGguYXBwZW5kVG8oJCgnPGRpdj53IDwvZGl2PicpLmFkZENsYXNzKCdzYXZlV2lkdGgnKS5hcHBlbmRUbyhzYXZlU2l6ZS5hcmVhKSk7XG5zYXZlU2l6ZS5oZWlnaHQuYXBwZW5kVG8oJCgnPGRpdj5oIDwvZGl2PicpLmFkZENsYXNzKCdzYXZlSGVpZ2h0JykuYXBwZW5kVG8oc2F2ZVNpemUuYXJlYSkpO1xuc2F2ZVNpemUuYXJlYS5hcHBlbmRUbyhjb250cm9sQmFyKTtcbiovXG5cbmltLm9uKCdhZGp1c3RlZHNhdmVycycsZnVuY3Rpb24oKXtcbiAgc2F2ZVNpemUud2lkdGgudGV4dChpbS5zYXZlV2lkdGgpO1xuICBzYXZlU2l6ZS5oZWlnaHQudGV4dChpbS5zYXZlSGVpZ2h0KTtcbn0pO1xuXG5zYXZlU2l6ZS5jcm9wLmNsaWNrKGZ1bmN0aW9uKCl7XG4gIGltLmFkanVzdFNhdmVycygpO1xufSk7XG5cbmlmIChpbS5zdHJpY3RTaXplKSB7XG4gIHNhdmVTaXplLmJvdGguYXR0cignZGlzYWJsZWQnLCd0cnVlJyk7XG59IGVsc2Uge1xuICBzYXZlU2l6ZS5ib3RoLmtleXVwKGZ1bmN0aW9uKGUpe1xuICAgIGltLmZpcmUoJ2VkaXRlZFNpemUnLGUpO1xuICB9KTtcbn1cblxuaW0uYmluZCgnZWRpdGVkU2l6ZScsZnVuY3Rpb24oZSl7XG4gIGltLnNhdmVXaWR0aCA9IHBhcnNlSW50KHNhdmVTaXplLndpZHRoLnRleHQoKSk7XG4gIGltLnNhdmVIZWlnaHQgPSBwYXJzZUludChzYXZlU2l6ZS5oZWlnaHQudGV4dCgpKTtcblxuICBpZiAoaXNOYU4oaW0uc2F2ZVdpZHRoKSkgaW0uc2F2ZVdpZHRoID0gMDtcbiAgaWYgKGlzTmFOKGltLnNhdmVIZWlnaHQpKSBpbS5zYXZlSGVpZ2h0ID0gMDtcblxuICAvL2ltLnRyaWdnZXIoJ3NhdmVTaXplQ2hhbmdlJyk7XG4gIGltLmJ1aWxkQmFja2dyb3VuZCgpO1xufSk7XG5cbmltLmJpbmQoJ3NhdmVTaXplQ2hhbmdlJyxmdW5jdGlvbigpe1xuICBzYXZlU2l6ZS53aWR0aC50ZXh0KGltLnNhdmVXaWR0aCk7XG4gIHNhdmVTaXplLmhlaWdodC50ZXh0KGltLnNhdmVIZWlnaHQpO1xufSk7XG5cbmltLnNldEN1cnNvciA9IGZ1bmN0aW9uKGN1cnNvcikge1xuICAkKGltLnN0YWdlLmdldENvbnRhaW5lcigpKS5jc3MoJ2N1cnNvcicsY3Vyc29yKTtcbn07XG5cbmltLnNhdmUgPSBmdW5jdGlvbiBzYXZlSW1hZ2UoKSB7XG4gICAgaW0uZmlyZSgnQ2hhbmdlQWN0aXZlQWN0aW9uJyk7XG4gICAgaW0uZmlyZSgnSW1hZ2VFZGl0b3JXaWxsU2F2ZScpO1xuXG4gICAgJC5mbi5kaWFsb2cuc2hvd0xvYWRlcigpO1xuXG4gICAgaW0uc3RhZ2UudG9EYXRhVVJMKHtcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2YXIgZmFrZV9jYW52YXMgPSAkKCc8aW1nIC8+JykuYWRkQ2xhc3MoJ2Zha2VfY2FudmFzJykuYXBwZW5kVG8oaW0uZWRpdG9yQ29udGV4dC5jaGlsZHJlbignLkVkaXRvcicpKTtcbiAgICAgICAgICAgIGZha2VfY2FudmFzLmF0dHIoJ3NyYycsIGRhdGEpO1xuXG4gICAgICAgICAgICBmYWtlX2NhbnZhcy5jc3Moe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3doaXRlJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBvbGRTdGFnZVBvc2l0aW9uID0gaW0uc3RhZ2UuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICBvbGRTY2FsZSA9IGltLnNjYWxlLFxuICAgICAgICAgICAgICAgIG9sZFdpZHRoID0gaW0uc3RhZ2UuZ2V0V2lkdGgoKSxcbiAgICAgICAgICAgICAgICBvbGRIZWlnaHQgPSBpbS5zdGFnZS5nZXRIZWlnaHQoKTtcblxuICAgICAgICAgICAgaW0uc3RhZ2Uuc2V0UG9zaXRpb24oLWltLnNhdmVBcmVhLmdldFgoKSwgLWltLnNhdmVBcmVhLmdldFkoKSk7XG4gICAgICAgICAgICBpbS5zdGFnZS5zZXRTY2FsZSgxKTtcbiAgICAgICAgICAgIGltLmJhY2tncm91bmQuaGlkZSgpO1xuICAgICAgICAgICAgaW0uZm9yZWdyb3VuZC5oaWRlKCk7XG4gICAgICAgICAgICBpbS5zdGFnZS5zZXRIZWlnaHQoaW0uc2F2ZUhlaWdodCArIDEwMCk7XG4gICAgICAgICAgICBpbS5zdGFnZS5zZXRXaWR0aChpbS5zYXZlV2lkdGggKyAxMDApO1xuICAgICAgICAgICAgaW0uc3RhZ2UuZHJhdygpO1xuXG4gICAgICAgICAgICB2YXIgbWltZSA9IHNldHRpbmdzLm1pbWU7XG4gICAgICAgICAgICBpZiAobWltZSAhPT0gJ2ltYWdlL2pwZWcnICYmIG1pbWUgIT09ICdpbWFnZS9wbmcnKSB7XG4gICAgICAgICAgICAgICAgLy8gZGVmYXVsdCB0byBwbmdcbiAgICAgICAgICAgICAgICBtaW1lID0gJ2ltYWdlL3BuZyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGltLnN0YWdlLnRvRGF0YVVSTCh7XG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IG1pbWUsXG4gICAgICAgICAgICAgICAgcXVhbGl0eTogc2V0dGluZ3MuanBlZ0NvbXByZXNzaW9uLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBpbS5zYXZlV2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBpbS5zYXZlSGVpZ2h0LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiBzYXZlSW1hZ2VEYXRhVXJsQ2FsbGJhY2sodXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIGltLnN0YWdlLnNldFBvc2l0aW9uKG9sZFN0YWdlUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBpbS5iYWNrZ3JvdW5kLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgaW0uZm9yZWdyb3VuZC5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIGltLnN0YWdlLnNldFNjYWxlKG9sZFNjYWxlKTtcbiAgICAgICAgICAgICAgICAgICAgaW0uc3RhZ2Uuc2V0SGVpZ2h0KG9sZEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGltLnN0YWdlLnNldFdpZHRoKG9sZFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgaW0uc3RhZ2UuZHJhdygpO1xuXG4gICAgICAgICAgICAgICAgICAgIGZha2VfY2FudmFzLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICQucG9zdChpbS5zYXZlVXJsLCBfLmV4dGVuZChpbS5zYXZlRGF0YSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZklEOiBpbS5maWxlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWdEYXRhOiB1cmxcbiAgICAgICAgICAgICAgICAgICAgfSksIGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZm4uZGlhbG9nLmhpZGVMb2FkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBKU09OLnBhcnNlKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzdWx0Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2J1dHRvbi5zYXZlW2Rpc2FibGVkXScpLmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuZXJyb3IgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbS5maXJlKCdJbWFnZUVkaXRvckRpZFNhdmUnLCBfLmV4dGVuZChpbS5zYXZlRGF0YSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmSUQ6IGltLmZpbGVJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nRGF0YTogdXJsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmNyZXRlLmV2ZW50LmZpcmUoJ0ltYWdlRWRpdG9yRGlkU2F2ZScsIF8uZXh0ZW5kKGltLnNhdmVEYXRhLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZJRDogaW0uZmlsZUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdEYXRhOiB1cmxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5pbS5hY3R1YWxQb3NpdGlvbiA9IGZ1bmN0aW9uIGFjdHVhbFBvc2l0aW9uKHgsIHksIGN4LCBjeSwgcmFkKSB7XG4gICAgdmFyIGF5ID0geSAtIGN5LFxuICAgICAgICBheCA9IHggLSBjeCxcbiAgICAgICAgZGVnQ2hhbmdlID0gaW0uYWN0aXZlRWxlbWVudC5nZXRSb3RhdGlvbigpICsgTWF0aC5hdGFuMihheSwgYXgpLFxuICAgICAgICByID0gTWF0aC5zcXJ0KE1hdGgucG93KGF4LCAyKSArIE1hdGgucG93KGF5LCAyKSk7XG4gICAgcmV0dXJuIFtjeCArIChyICogTWF0aC5jb3MoZGVnQ2hhbmdlKSksIGN5ICsgKHIgKiBNYXRoLnNpbihkZWdDaGFuZ2UpKV07XG59O1xuXG5pbS5nZXRBY3R1YWxSZWN0ID0gZnVuY3Rpb24gYWN0dWFsUmVjdChjeCwgY3ksIGVsZW0pIHtcbiAgICB2YXIgcmVjdCA9IFtdLCByYWQgPSBlbGVtLmdldFJvdGF0aW9uKCk7XG4gICAgcmVjdC5wdXNoKGltLmFjdHVhbFBvc2l0aW9uKGVsZW0uZ2V0WCgpLCBlbGVtLmdldFkoKSwgY3gsIGN5LCByYWQpKTtcbiAgICByZWN0LnB1c2goaW0uYWN0dWFsUG9zaXRpb24oZWxlbS5nZXRYKCkgKyBlbGVtLmdldFdpZHRoKCkgKiBlbGVtLmdldFNjYWxlWCgpLCBlbGVtLmdldFkoKSwgY3gsIGN5LCByYWQpKTtcbiAgICByZWN0LnB1c2goaW0uYWN0dWFsUG9zaXRpb24oZWxlbS5nZXRYKCkgKyBlbGVtLmdldFdpZHRoKCkgKiBlbGVtLmdldFNjYWxlWCgpLCBlbGVtLmdldFkoKSArIGVsZW0uZ2V0SGVpZ2h0KCkgKiBlbGVtLmdldFNjYWxlWSgpLCBjeCwgY3ksIHJhZCkpO1xuICAgIHJlY3QucHVzaChpbS5hY3R1YWxQb3NpdGlvbihlbGVtLmdldFgoKSwgZWxlbS5nZXRZKCkgKyBlbGVtLmdldEhlaWdodCgpICogZWxlbS5nZXRTY2FsZVkoKSwgY3gsIGN5LCByYWQpKTtcbiAgICByZXR1cm4gcmVjdDtcbn07XG5cbmltLmFkanVzdFNhdmVycyA9IGZ1bmN0aW9uIEFkanVzdGluZ1NhdmVycyhmaXJlKSB7XG4gICAgaWYgKGltLmFjdGl2ZUVsZW1lbnQubm9kZVR5cGUgPT09ICdTdGFnZScpIHJldHVybjtcbiAgICBpbS5mb3JlZ3JvdW5kLmF1dG9Dcm9wID0gZmFsc2U7XG4gICAgaW0uYmFja2dyb3VuZC5hdXRvQ3JvcCA9IGZhbHNlO1xuICAgIHZhciBpLCBlLCB1LCBzY29yZSA9IHttaW46IHt4OiBmYWxzZSwgeTogZmFsc2V9LCBtYXg6IHt4OiBmYWxzZSwgeTogZmFsc2V9fTtcbiAgICAvKlxuICAgICBmb3IgKHZhciBpID0gaW0uc3RhZ2UuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgdmFyIGxheWVyID0gaW0uc3RhZ2UuY2hpbGRyZW5baV07XG4gICAgIGlmIChsYXllci5hdXRvQ3JvcCA9PT0gZmFsc2UpIGNvbnRpbnVlO1xuICAgICBmb3IgKHZhciBlID0gbGF5ZXIuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgZSA+PSAwOyBlLS0pIHtcbiAgICAgdmFyIGNoaWxkID0gbGF5ZXIuY2hpbGRyZW5bZV0sXG4gICAgIHJlY3QgPSBpbS5nZXRBY3R1YWxSZWN0KDAsIDAsIGNoaWxkKTtcbiAgICAgY29uc29sZS5sb2coY2hpbGQpO1xuXG4gICAgIGZvciAodmFyIHUgPSByZWN0Lmxlbmd0aCAtIDE7IHUgPj0gMDsgdS0tKSB7XG4gICAgIHZhciBwb2ludCA9IHJlY3RbdV0sIHggPSBwb2ludFswXSArIGxheWVyLmdldFgoKSwgeSA9IHBvaW50WzFdICsgbGF5ZXIuZ2V0WSgpO1xuICAgICBpZiAoeCA+IHNjb3JlLm1heC54IHx8IHNjb3JlLm1heC54ID09PSBmYWxzZSkgc2NvcmUubWF4LnggPSB4O1xuICAgICBpZiAoeCA8IHNjb3JlLm1pbi54IHx8IHNjb3JlLm1pbi54ID09PSBmYWxzZSkgc2NvcmUubWluLnggPSB4O1xuICAgICBpZiAoeSA+IHNjb3JlLm1heC55IHx8IHNjb3JlLm1heC55ID09PSBmYWxzZSkgc2NvcmUubWF4LnkgPSB5O1xuICAgICBpZiAoeSA8IHNjb3JlLm1pbi55IHx8IHNjb3JlLm1pbi55ID09PSBmYWxzZSkgc2NvcmUubWluLnkgPSB5O1xuICAgICB9XG4gICAgIH1cbiAgICAgfVxuICAgICAqL1xuICAgIHZhciBjaGlsZCA9IGltLmFjdGl2ZUVsZW1lbnQsXG4gICAgICAgIGxheWVyID0gY2hpbGQucGFyZW50LFxuICAgICAgICByZWN0ID0gaW0uZ2V0QWN0dWFsUmVjdCgwLCAwLCBjaGlsZCksXG4gICAgICAgIHUsIHNpemU7XG5cbiAgICBmb3IgKHUgPSByZWN0Lmxlbmd0aCAtIDE7IHUgPj0gMDsgdS0tKSB7XG4gICAgICAgIHZhciBwb2ludCA9IHJlY3RbdV0sIHggPSBwb2ludFswXSArIGxheWVyLmdldFgoKSwgeSA9IHBvaW50WzFdICsgbGF5ZXIuZ2V0WSgpO1xuICAgICAgICBpZiAoeCA+IHNjb3JlLm1heC54IHx8IHNjb3JlLm1heC54ID09PSBmYWxzZSkgc2NvcmUubWF4LnggPSB4O1xuICAgICAgICBpZiAoeCA8IHNjb3JlLm1pbi54IHx8IHNjb3JlLm1pbi54ID09PSBmYWxzZSkgc2NvcmUubWluLnggPSB4O1xuICAgICAgICBpZiAoeSA+IHNjb3JlLm1heC55IHx8IHNjb3JlLm1heC55ID09PSBmYWxzZSkgc2NvcmUubWF4LnkgPSB5O1xuICAgICAgICBpZiAoeSA8IHNjb3JlLm1pbi55IHx8IHNjb3JlLm1pbi55ID09PSBmYWxzZSkgc2NvcmUubWluLnkgPSB5O1xuICAgIH1cblxuICAgIHNpemUgPSB7d2lkdGg6IHNjb3JlLm1heC54IC0gc2NvcmUubWluLngsIGhlaWdodDogc2NvcmUubWF4LnkgLSBzY29yZS5taW4ueX07XG4gICAgaWYgKCFpbS5zdHJpY3RTaXplKSB7XG4gICAgICAgIGltLmFsdGVyQ29yZSgnc2F2ZVdpZHRoJywgTWF0aC5yb3VuZChzaXplLndpZHRoKSk7XG4gICAgICAgIGltLmFsdGVyQ29yZSgnc2F2ZUhlaWdodCcsIE1hdGgucm91bmQoc2l6ZS5oZWlnaHQpKTtcbiAgICAgICAgaW0uYnVpbGRCYWNrZ3JvdW5kKCk7XG4gICAgfVxuXG4gICAgdmFyIGFwID0gW2ltLmNlbnRlci54IC0gKGltLmFjdGl2ZUVsZW1lbnQuZ2V0V2lkdGgoKSAqIGltLmFjdGl2ZUVsZW1lbnQuZ2V0U2NhbGVYKCkpIC8gMixcbiAgICAgICAgICAgIGltLmNlbnRlci55IC0gKGltLmFjdGl2ZUVsZW1lbnQuZ2V0SGVpZ2h0KCkgKiBpbS5hY3RpdmVFbGVtZW50LmdldFNjYWxlWSgpKSAvIDJdLFxuICAgICAgICBhZGogPSBpbS5hY3R1YWxQb3NpdGlvbihhcFswXSwgYXBbMV0sIGltLmNlbnRlci54LCBpbS5jZW50ZXIueSwgaW0uYWN0aXZlRWxlbWVudC5nZXRSb3RhdGlvbigpKTtcblxuICAgIGltLmFjdGl2ZUVsZW1lbnQucGFyZW50LnNldFBvc2l0aW9uKGFkai5tYXAoTWF0aC5yb3VuZCkpO1xuXG4gICAgaWYgKGZpcmUgIT09IGZhbHNlKSBpbS5maXJlKCdhZGp1c3RlZHNhdmVycycpO1xuICAgIGltLnN0YWdlLmRyYXcoKTtcbn07XG5cbmltLmJpbmQoJ2ltYWdlTG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGltLmFkanVzdFNhdmVycywgMCk7XG59KTtcblxuaW0uZXh0ZW5kID0gZnVuY3Rpb24ocHJvcGVydHksdmFsdWUpIHtcbiAgdGhpc1twcm9wZXJ0eV0gPSB2YWx1ZTtcbn07XG5cbmltLmFsdGVyQ29yZSA9IGZ1bmN0aW9uKHByb3BlcnR5LHZhbHVlKSB7XG4gIHZhciBuaW0gPSBpbSwgbnMgPSAnY29yZScsIGk7XG4gIGlmIChpbS5uYW1lc3BhY2UpIHtcbiAgICB2YXIgbnMgPSBuaW0ubmFtZXNwYWNlO1xuICAgIG5pbSA9IGltLnJlYWxJbTtcbiAgfVxuICBpbVtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgZm9yIChpIGluIGltLmNvbnRyb2xTZXRzKXtcbiAgICBpbS5jb250cm9sU2V0c1tpXS5pbS5leHRlbmQocHJvcGVydHksdmFsdWUpO1xuICB9XG4gIGZvciAoaSBpbiBpbS5maWx0ZXJzKXtcbiAgICBpbS5maWx0ZXJzW2ldLmltLmV4dGVuZChwcm9wZXJ0eSx2YWx1ZSk7XG4gIH1cbiAgZm9yIChpIGluIGltLmNvbXBvbmVudHMpe1xuICAgIGltLmNvbXBvbmVudHNbaV0uaW0uZXh0ZW5kKHByb3BlcnR5LHZhbHVlKTtcbiAgfVxufTtcblxuaW0uY2xvbmUgPSBmdW5jdGlvbihuYW1lc3BhY2UpIHtcbiAgdmFyIG5ld2ltID0gbmV3IEltYWdlRWRpdG9yKCksaTtcbiAgbmV3aW0ucmVhbEltID0gaW07XG4gIGZvciAoaSBpbiBpbSkge1xuICAgIG5ld2ltW2ldID0gaW1baV07XG4gIH1cbiAgbmV3aW0ubmFtZXNwYWNlID0gbmFtZXNwYWNlO1xuICByZXR1cm4gbmV3aW07XG59O1xuXG5pbS5hZGRDb250cm9sU2V0ID0gZnVuY3Rpb24obnMsanMsZWxlbSkge1xuICBpZiAoalF1ZXJ5ICYmIGVsZW0gaW5zdGFuY2VvZiBqUXVlcnkpIGVsZW0gPSBlbGVtWzBdO1xuICBlbGVtLmNvbnRyb2xTZXQgPSBmdW5jdGlvbihpbSxqcykge1xuICAgIGltLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGltLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICQoZWxlbSkucGFyZW50KCkucGFyZW50KCkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgfTtcbiAgICBpbS5lbmFibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGltLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgJChlbGVtKS5wYXJlbnQoKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICB9O1xuICAgIHRoaXMuaW0gPSBpbTtcbiAgICB0aGlzLiQgPSAkO1xuICAgIHdhcm4oJ0xvYWRpbmcgQ29udHJvbFNldCcsaW0pO1xuICAgIHRyeSB7XG4gICAgICAobmV3IEZ1bmN0aW9uKCdpbScsJyQnLGpzKSkuY2FsbCh0aGlzLCBpbSwgJCk7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlLnN0YWNrKTtcbiAgICAgIHZhciBwb3MgPSBlLnN0YWNrLnJlcGxhY2UoL1tcXFNcXHNdK2F0IEhUTUxEaXZFbGVtZW50LmV2YWwuKz88YW5vbnltb3VzPjooXFxkKzpcXGQrKVtcXFNcXHNdKy8sJyQxJykuc3BsaXQoJzonKTtcbiAgICAgIGlmIChwb3NbMV0gJiYgIWlzTmFOKHBhcnNlSW50KHBvc1sxXSkpKSB7XG4gICAgICAgIHZhciBqc3N0YWNrID0ganMuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgIHZhciBtc2cgPSBcIlBhcnNlIGVycm9yIGF0IGxpbmUgI1wiK3Bvc1swXStcIiBjaGFyICNcIitwb3NbMV0rXCIgd2l0aGluIFwiK25zO1xuICAgICAgICBtc2cgKz0gXCJcXG5cIitqc3N0YWNrW3BhcnNlSW50KHBvc1swXSktMV07XG4gICAgICAgIG1zZyArPSBcIlxcblwiKyhuZXcgQXJyYXkocGFyc2VJbnQocG9zWzFdKSkuam9pbihcIiBcIikpK1wiXlwiO1xuICAgICAgICBlcnJvcihtc2cpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXJyb3IoXCJcXFwiXCIgKyBlLm1lc3NhZ2UgKyBcIlxcXCIgaW4gXFxcIlwiICsgaW0ubmFtZXNwYWNlICsgXCJcXFwiXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcbiAgdmFyIG5ld2ltID0gaW0uY2xvbmUobnMpO1xuICB2YXIgbnNvID0gZWxlbS5jb250cm9sU2V0LmNhbGwoZWxlbSxuZXdpbSxqcyk7XG4gIGltLmNvbnRyb2xTZXRzW25zXSA9IG5zbztcbiAgcmV0dXJuIG5zbztcbn07XG5cbmltLmFkZEZpbHRlciA9IGZ1bmN0aW9uKG5zLGpzKSB7XG4gIHZhciBmaWx0ZXIgPSBmdW5jdGlvbihpbSxqcykge1xuICAgIHRoaXMubmFtZXNwYWNlID0gaW0ubmFtZXNwYWNlO1xuICAgIHRoaXMuaW0gPSBpbTtcbiAgICB0cnkge1xuICAgICAgKG5ldyBGdW5jdGlvbignaW0nLCckJyxqcykpLmNhbGwodGhpcywgaW0sICQpO1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgZXJyb3IoZSk7XG4gICAgICB3aW5kb3cubGFzdEVycm9yID0gZTtcbiAgICAgIHZhciBwb3MgPSBlLnN0YWNrLnJlcGxhY2UoL1tcXFNcXHNdK2F0IEhUTUxEaXZFbGVtZW50LmV2YWwuKz88YW5vbnltb3VzPjooXFxkKzpcXGQrKVtcXFNcXHNdKy8sJyQxJykuc3BsaXQoJzonKTtcbiAgICAgIGlmIChwb3MubGVuZ3RoICE9IDIpIHtcbiAgICAgICAgZXJyb3IoZS5tZXNzYWdlKTtcbiAgICAgICAgZXJyb3IoZS5zdGFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIganNzdGFjayA9IGpzLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICB2YXIgbXNnID0gXCJQYXJzZSBlcnJvciBhdCBsaW5lICNcIitwb3NbMF0rXCIgY2hhciAjXCIrcG9zWzFdK1wiIHdpdGhpbiBcIitucztcbiAgICAgICAgbXNnICs9IFwiXFxuXCIranNzdGFja1twYXJzZUludChwb3NbMF0pLTFdO1xuICAgICAgICBtc2cgKz0gXCJcXG5cIisobmV3IEFycmF5KHBhcnNlSW50KHBvc1sxXSkgfHwgMCkuam9pbihcIiBcIikpK1wiXlwiO1xuICAgICAgICBlcnJvcihtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcbiAgdmFyIG5ld2ltID0gaW0uY2xvbmUobnMpO1xuICB2YXIgbnNvID0gbmV3IGZpbHRlcihuZXdpbSxqcyk7XG4gIGltLmZpbHRlcnNbbnNdID0gbnNvO1xuICByZXR1cm4gbnNvO1xufTtcblxuaW0uYWRkQ29tcG9uZW50ID0gZnVuY3Rpb24obnMsanMsZWxlbSkge1xuICBpZiAoalF1ZXJ5ICYmIGVsZW0gaW5zdGFuY2VvZiBqUXVlcnkpIGVsZW0gPSBlbGVtWzBdO1xuICBlbGVtLmNvbXBvbmVudCA9IGZ1bmN0aW9uKGltLGpzKSB7XG4gICAgaW0uZGlzYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICB9O1xuICAgIGltLmVuYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICB9O1xuICAgIHRoaXMuaW0gPSBpbTtcbiAgICB3YXJuKCdMb2FkaW5nIGNvbXBvbmVudCcsaW0pO1xuICAgIHRyeSB7XG4gICAgICAobmV3IEZ1bmN0aW9uKCdpbScsJyQnLGpzKSkuY2FsbCh0aGlzLCBpbSwgJCk7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICB2YXIgcG9zID0gZS5zdGFjay5yZXBsYWNlKC9bXFxTXFxzXSthdCBIVE1MRGl2RWxlbWVudC5ldmFsLis/PGFub255bW91cz46KFxcZCs6XFxkKylbXFxTXFxzXSsvLCckMScpLnNwbGl0KCc6Jyk7XG4gICAgICBpZiAocG9zWzFdICYmICFpc05hTihwYXJzZUludChwb3NbMV0pKSkge1xuICAgICAgICB2YXIganNzdGFjayA9IGpzLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICB2YXIgbXNnID0gXCJQYXJzZSBlcnJvciBhdCBsaW5lICNcIitwb3NbMF0rXCIgY2hhciAjXCIrcG9zWzFdK1wiIHdpdGhpbiBcIitucztcbiAgICAgICAgbXNnICs9IFwiXFxuXCIranNzdGFja1twYXJzZUludChwb3NbMF0pLTFdO1xuICAgICAgICBtc2cgKz0gXCJcXG5cIisobmV3IEFycmF5KHBhcnNlSW50KHBvc1sxXSkpLmpvaW4oXCIgXCIpKStcIl5cIjtcbiAgICAgICAgZXJyb3IobXNnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVycm9yKFwiXFxcIlwiICsgZS5tZXNzYWdlICsgXCJcXFwiIGluIFxcXCJcIiArIGltLm5hbWVzcGFjZSArIFwiXFxcIlwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG4gIHZhciBuZXdpbSA9IGltLmNsb25lKG5zKTtcbiAgdmFyIG5zbyA9IGVsZW0uY29tcG9uZW50LmNhbGwoZWxlbSxuZXdpbSxqcyk7XG4gIGltLmNvbXBvbmVudHNbbnNdID0gbnNvO1xuICByZXR1cm4gbnNvO1xufTtcblxuLy8gU2V0IHVwIGJhY2tncm91bmRcbmltLmJhY2tncm91bmQgPSBuZXcgS2luZXRpYy5MYXllcigpO1xuaW0uZm9yZWdyb3VuZCA9IG5ldyBLaW5ldGljLkxheWVyKCk7XG5pbS5zdGFnZS5hZGQoaW0uYmFja2dyb3VuZCk7XG5pbS5zdGFnZS5hZGQoaW0uZm9yZWdyb3VuZCk7XG5pbS5iZ2ltYWdlID0gbmV3IEltYWdlKCk7XG5pbS5zYXZlQXJlYSA9IG5ldyBLaW5ldGljLlJlY3QoKTtcbmltLmJhY2tncm91bmQuYWRkKGltLnNhdmVBcmVhKTtcbmltLmJpbmQoJ2xvYWQnLCBmdW5jdGlvbigpe1xuICBpbS5zYXZlQXJlYS5zZXRGaWxsUGF0dGVybkltYWdlKGltLmJnaW1hZ2UpO1xuXG4gIGltLnNhdmVBcmVhLnNldEZpbGxQYXR0ZXJuT2Zmc2V0KFstKGltLnNhdmVXaWR0aC8yKSwtKGltLnNhdmVIZWlnaHQvMildKTtcbiAgaW0uc2F2ZUFyZWEuc2V0RmlsbFBhdHRlcm5TY2FsZSgxL2ltLnNjYWxlKTtcbiAgaW0uc2F2ZUFyZWEuc2V0RmlsbFBhdHRlcm5YKDApO1xuICBpbS5zYXZlQXJlYS5zZXRGaWxsUGF0dGVyblkoMCk7XG4gIGltLnNhdmVBcmVhLnNldEZpbGxQYXR0ZXJuUmVwZWF0KCdyZXBlYXQnKTtcblxuICBpbS5iYWNrZ3JvdW5kLm9uKCdjbGljaycsZnVuY3Rpb24oKXtcbiAgICBpbS5zZXRBY3RpdmVFbGVtZW50KGltLnN0YWdlKTtcbiAgfSk7XG59LCBpbS5iZ2ltYWdlKTtcbmltLmJnaW1hZ2Uuc3JjID0gQ0NNX1JFTCArICcvY29uY3JldGUvaW1hZ2VzL3Rlc3RiZy5wbmcnO1xuaW0uYnVpbGRCYWNrZ3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gIHZhciBkaW1lbnNpb25zID0gaW0uc3RhZ2UuZ2V0VG90YWxEaW1lbnNpb25zKCk7XG5cbiAgaW0uc2F2ZUFyZWEuc2V0RmlsbFBhdHRlcm5PZmZzZXQoWy0oaW0uc2F2ZVdpZHRoLzIpICogaW0uc2NhbGUsLShpbS5zYXZlSGVpZ2h0LzIpICogaW0uc2NhbGVdKTtcbiAgaW0uc2F2ZUFyZWEuc2V0WChNYXRoLnJvdW5kKGltLmNlbnRlci54IC0gKGltLnNhdmVXaWR0aCAvIDIpKSk7XG4gIGltLnNhdmVBcmVhLnNldFkoTWF0aC5yb3VuZChpbS5jZW50ZXIueSAtIChpbS5zYXZlSGVpZ2h0IC8gMikpKTtcbiAgaW0uc2F2ZUFyZWEuc2V0RmlsbFBhdHRlcm5TY2FsZSgxL2ltLnNjYWxlKTtcbiAgaW0uc2F2ZUFyZWEuc2V0V2lkdGgoaW0uc2F2ZVdpZHRoKTtcbiAgaW0uc2F2ZUFyZWEuc2V0SGVpZ2h0KGltLnNhdmVIZWlnaHQpO1xuXG4gIGlmICghaW0uY292ZXJMYXllcikge1xuICAgIGltLmNvdmVyTGF5ZXIgPSBuZXcgS2luZXRpYy5SZWN0O1xuICAgIGltLmNvdmVyTGF5ZXIuc2V0U3Ryb2tlKCdyZ2JhKDE1MCwxNTAsMTUwLC41KScpO1xuICAgIGltLmNvdmVyTGF5ZXIuc2V0RmlsbCgndHJhbnNwYXJlbnQnKTtcbiAgICBpbS5jb3ZlckxheWVyLnNldExpc3RlbmluZyhmYWxzZSk7XG4gICAgaW0uY292ZXJMYXllci5zZXRTdHJva2VXaWR0aChNYXRoLm1heChkaW1lbnNpb25zLndpZHRoLGRpbWVuc2lvbnMuaGVpZ2h0LDUwMCkpO1xuICAgIGltLmZvcmVncm91bmQuYWRkKGltLmNvdmVyTGF5ZXIpO1xuICB9XG4gIHZhciB3aWR0aCA9IE1hdGgubWF4KGRpbWVuc2lvbnMud2lkdGgsZGltZW5zaW9ucy5oZWlnaHQpKjI7XG4gIGltLmNvdmVyTGF5ZXIuc2V0UG9zaXRpb24oaW0uc2F2ZUFyZWEuZ2V0WCgpIC0gd2lkdGggLyAyLCBpbS5zYXZlQXJlYS5nZXRZKCkgLSB3aWR0aCAvIDIpO1xuICBpbS5jb3ZlckxheWVyLnNldFNpemUoaW0uc2F2ZUFyZWEuZ2V0V2lkdGgoKSArIHdpZHRoLCBpbS5zYXZlQXJlYS5nZXRIZWlnaHQoKSArIHdpZHRoKTtcbiAgaW0uY292ZXJMYXllci5zZXRTdHJva2VXaWR0aCh3aWR0aCk7XG4gIGltLmZpcmUoJ2JhY2tncm91bmRCdWlsdCcpO1xuICAvL2ltLmZvcmVncm91bmQubW92ZVRvVG9wKCk7XG4gIGltLnNhdmVBcmVhLmRyYXcoKTtcbiAgaW0uY292ZXJMYXllci5kcmF3KCk7XG4gICAgZGVidWdnZXI7XG59O1xuXG5pbS5idWlsZEJhY2tncm91bmQoKTtcbmltLm9uKCdzdGFnZUNoYW5nZWQnLGltLmJ1aWxkQmFja2dyb3VuZCk7XG5cbmltLnN0YWdlLnNldERyYWdCb3VuZEZ1bmMoZnVuY3Rpb24gKHJldCkge1xuICAgIHZhciBkaW0gPSBpbS5zdGFnZS5nZXRUb3RhbERpbWVuc2lvbnMoKTtcblxuICAgIHZhciBtYXh4ID0gTWF0aC5tYXgoZGltLm1heC54LCBkaW0ubWluLngpICsgMTAwLFxuICAgICAgICBtaW54ID0gTWF0aC5taW4oZGltLm1heC54LCBkaW0ubWluLngpIC0gMTAwLFxuICAgICAgICBtYXh5ID0gTWF0aC5tYXgoZGltLm1heC55LCBkaW0ubWluLnkpICsgMTAwLFxuICAgICAgICBtaW55ID0gTWF0aC5taW4oZGltLm1heC55LCBkaW0ubWluLnkpIC0gMTAwO1xuXG4gICAgcmV0LnggPSBNYXRoLmZsb29yKHJldC54KTtcbiAgICByZXQueSA9IE1hdGguZmxvb3IocmV0LnkpO1xuXG4gICAgaWYgKHJldC54ID4gbWF4eCkgcmV0LnggPSBtYXh4O1xuICAgIGlmIChyZXQueCA8IG1pbngpIHJldC54ID0gbWlueDtcbiAgICBpZiAocmV0LnkgPiBtYXh5KSByZXQueSA9IG1heHk7XG4gICAgaWYgKHJldC55IDwgbWlueSkgcmV0LnkgPSBtaW55O1xuXG4gICAgcmV0LnggPSBNYXRoLmZsb29yKHJldC54KTtcbiAgICByZXQueSA9IE1hdGguZmxvb3IocmV0LnkpO1xuXG4gICAgcmV0dXJuIHJldDtcbn0pO1xuaW0uc2V0QWN0aXZlRWxlbWVudChpbS5zdGFnZSk7XG5pbS5zdGFnZS5zZXREcmFnZ2FibGUodHJ1ZSk7XG5pbS5hdXRvQ3JvcCA9IHRydWU7XG5pbS5vbignaW1hZ2VMb2FkJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYWRkaW5nID0gNTA7XG5cbiAgICB2YXIgdyA9IGltLnN0YWdlLmdldFdpZHRoKCkgLSAocGFkZGluZyAqIDIpLCBoID0gaW0uc3RhZ2UuZ2V0SGVpZ2h0KCkgLSAocGFkZGluZyAqIDIpO1xuICAgIGlmIChpbS5zYXZlV2lkdGggPCB3ICYmIGltLnNhdmVIZWlnaHQgPCBoKSByZXR1cm47XG4gICAgdmFyIHBlcmMgPSBNYXRoLm1heChpbS5zYXZlV2lkdGggLyB3LCBpbS5zYXZlSGVpZ2h0IC8gaCk7XG5cbiAgICBpbS5zY2FsZSA9IDEgLyBwZXJjO1xuICAgIGltLnNjYWxlID0gTWF0aC5yb3VuZChpbS5zY2FsZSAqIDEwMCkgLyAxMDA7XG4gICAgaW0uYWx0ZXJDb3JlKCdzY2FsZScsIGltLnNjYWxlKTtcblxuICAgIGltLnN0YWdlLnNldFNjYWxlKGltLnNjYWxlKTtcbiAgICBpbS5zdGFnZS5zZXRYKChpbS5zdGFnZS5nZXRXaWR0aCgpIC0gKGltLnN0YWdlLmdldFdpZHRoKCkgKiBpbS5zdGFnZS5nZXRTY2FsZSgpLngpKSAvIDIpO1xuICAgIGltLnN0YWdlLnNldFkoKGltLnN0YWdlLmdldEhlaWdodCgpIC0gKGltLnN0YWdlLmdldEhlaWdodCgpICogaW0uc3RhZ2UuZ2V0U2NhbGUoKS55KSkgLyAyKTtcblxuICAgIHZhciBwb3MgPSAoaW0uc3RhZ2UuZ2V0RHJhZ0JvdW5kRnVuYygpKSh7eDogaW0uc3RhZ2UuZ2V0WCgpLCB5OiBpbS5zdGFnZS5nZXRZKCl9KTtcbiAgICBpbS5zdGFnZS5zZXRYKHBvcy54KTtcbiAgICBpbS5zdGFnZS5zZXRZKHBvcy55KTtcblxuICAgIGltLmZpcmUoJ3NjYWxlQ2hhbmdlJyk7XG4gICAgaW0uZmlyZSgnc3RhZ2VDaGFuZ2VkJyk7XG4gICAgaW0uYnVpbGRCYWNrZ3JvdW5kKCk7XG59KTtcblxuaW0uZml0ID0gZnVuY3Rpb24gKHdoLCBzY2FsZSkge1xuICAgIGlmIChzY2FsZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHdpZHRoOiBpbS5zYXZlV2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGltLnNhdmVIZWlnaHRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgdmFyIGhlaWdodCA9IHdoLmhlaWdodCxcbiAgICAgICAgd2lkdGggPSB3aC53aWR0aDtcblxuICAgIGlmICh3aWR0aCA+IGltLnNhdmVXaWR0aCkge1xuICAgICAgICBoZWlnaHQgLz0gd2lkdGggLyBpbS5zYXZlV2lkdGg7XG4gICAgICAgIHdpZHRoID0gaW0uc2F2ZVdpZHRoO1xuICAgIH1cbiAgICBpZiAoaGVpZ2h0ID4gaW0uc2F2ZUhlaWdodCkge1xuICAgICAgICB3aWR0aCAvPSBoZWlnaHQgLyBpbS5zYXZlSGVpZ2h0O1xuICAgICAgICBoZWlnaHQgPSBpbS5zYXZlSGVpZ2h0O1xuICAgIH1cbiAgICByZXR1cm4ge3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9O1xufTtcblxuaWYgKHNldHRpbmdzLnNyYykge1xuICAgIGltLnNob3dMb2FkZXIoY2NtaTE4bl9pbWFnZWVkaXRvci5sb2FkaW5nSW1hZ2UpO1xuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKSwgY29udHJvbFNldHNMb2FkZWQgPSBmYWxzZTtcbiAgICBpbS5iaW5kKCdDb250cm9sU2V0c0xvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29udHJvbFNldHNMb2FkZWQgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgaW0uYmluZCgnbG9hZCcsIGZ1bmN0aW9uIGltYWdlTG9hZGVkKCkge1xuICAgICAgICBpZiAoIWltLnN0cmljdFNpemUpIHtcbiAgICAgICAgICAgIGltLnNhdmVXaWR0aCA9IGltZy53aWR0aDtcbiAgICAgICAgICAgIGltLnNhdmVIZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgICAgICAgaW0uZmlyZSgnc2F2ZVNpemVDaGFuZ2UnKTtcbiAgICAgICAgICAgIGltLmJ1aWxkQmFja2dyb3VuZCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGltLnNhdmVXaWR0aCA9PSAwIHx8IGltLnNhdmVIZWlnaHQgPT0gMCkge1xuICAgICAgICAgICAgaWYgKGltLnNhdmVXaWR0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGltLnNhdmVIZWlnaHQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpbS5zYXZlV2lkdGggPSBpbWcud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGltLnNhdmVIZWlnaHQgPSBpbWcuaGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgICAgIGltLmZpcmUoJ3NhdmVTaXplQ2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICAgIGltLmJ1aWxkQmFja2dyb3VuZCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltLnNhdmVXaWR0aCA9IE1hdGguZmxvb3IoaW1nLndpZHRoIC8gaW1nLmhlaWdodCAqIGltLnNhdmVIZWlnaHQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGltLmZpcmUoJ3NhdmVTaXplQ2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICAgIGltLmJ1aWxkQmFja2dyb3VuZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW0uc2F2ZUhlaWdodCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgaW0uc2F2ZUhlaWdodCA9IE1hdGguZmxvb3IoaW1nLmhlaWdodCAvIGltZy53aWR0aCAqIGltLnNhdmVXaWR0aCk7XG5cbiAgICAgICAgICAgICAgICBpbS5maXJlKCdzYXZlU2l6ZUNoYW5nZScpO1xuICAgICAgICAgICAgICAgIGltLmJ1aWxkQmFja2dyb3VuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICB2YXIgY2VudGVyID0ge1xuICAgICAgICAgICAgeDogTWF0aC5mbG9vcihpbS5jZW50ZXIueCAtIChpbWcud2lkdGggLyAyKSksXG4gICAgICAgICAgICB5OiBNYXRoLmZsb29yKGltLmNlbnRlci55IC0gKGltZy5oZWlnaHQgLyAyKSlcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGltYWdlID0gbmV3IEtpbmV0aWMuSW1hZ2Uoe1xuICAgICAgICAgICAgaW1hZ2U6IGltZyxcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwXG4gICAgICAgIH0pO1xuICAgICAgICBpbWFnZS5zZXRQb3NpdGlvbihjZW50ZXIpO1xuICAgICAgICBpbS5hZGRFbGVtZW50KGltYWdlLCAnaW1hZ2UnKTtcbiAgICAgICAgXy5kZWZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbS5maXJlKCdpbWFnZWxvYWQnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbiBhY3RpdmF0ZUltYWdlRWxlbWVudCgpIHtcbiAgICAgICAgICAgICAgICBpbS5zdGFnZS5kcmF3KCk7XG4gICAgICAgICAgICAgICAgaW0uc2V0QWN0aXZlRWxlbWVudChpbWFnZSk7XG4gICAgICAgICAgICAgICAgaW0uZmlyZSgnY2hhbmdlQWN0aXZlQWN0aW9uJywgaW0uY29udHJvbFNldE5hbWVzcGFjZXNbMF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29udHJvbFNldHNMb2FkZWQpIHtcbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbS5iaW5kKCdDb250cm9sU2V0c0xvYWRlZCcsIGFjdGl2YXRlKTtcbiAgICAgICAgfVxuICAgIH0sIGltZyk7XG5cbiAgICBpbWcuc3JjID0gc2V0dGluZ3Muc3JjO1xufSBlbHNlIHtcbiAgICBpbS5maXJlKCdpbWFnZWxvYWQnKTtcbn1cblxuaW0uYmluZCgnaW1hZ2Vsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBjcyA9IHNldHRpbmdzLmNvbnRyb2xzZXRzIHx8IHt9LCBmaWx0ZXJzID0gc2V0dGluZ3MuZmlsdGVycyB8fCB7fSwgbmFtZXNwYWNlLCBmaXJzdGNzO1xuICAgIHZhciBydW5uaW5nID0gMDtcbiAgICBsb2coJ0xvYWRpbmcgQ29udHJvbFNldHMnKTtcbiAgICBpbS5zaG93TG9hZGVyKGNjbWkxOG5faW1hZ2VlZGl0b3IubG9hZGluZ0NvbnRyb2xTZXRzKTtcbiAgICBpbS5maXJlKCdMb2FkaW5nQ29udHJvbFNldHMnKTtcbiAgICBmb3IgKG5hbWVzcGFjZSBpbiBjcykge1xuICAgICAgICB2YXIgbXlucyA9IFwiQ29udHJvbFNldF9cIiArIG5hbWVzcGFjZTtcbiAgICAgICAgaW0uY29udHJvbFNldE5hbWVzcGFjZXMucHVzaChteW5zKTtcbiAgICAgICAgJC5hamF4KGNzW25hbWVzcGFjZV1bJ3NyYyddLCB7XG4gICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UsXG4gICAgICAgICAgICBteW5zOiBteW5zLFxuICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJ1bm5pbmcrKztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoanMpIHtcbiAgICAgICAgICAgICAgICBydW5uaW5nLS07XG4gICAgICAgICAgICAgICAgdmFyIG5zbyA9IGltLmFkZENvbnRyb2xTZXQodGhpcy5teW5zLCBqcywgY3NbdGhpcy5uYW1lc3BhY2VdWydlbGVtZW50J10pO1xuICAgICAgICAgICAgICAgIGxvZyhuc28pO1xuICAgICAgICAgICAgICAgIGltLmZpcmUoJ2NvbnRyb2xTZXRMb2FkJywgbnNvKTtcbiAgICAgICAgICAgICAgICBpZiAoMCA9PSBydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGltLnRyaWdnZXIoJ0NvbnRyb2xTZXRzTG9hZGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoeGhyLCBlcnJEZXNjLCBleGNlcHRpb24pIHtcbiAgICAgICAgICAgICAgICBydW5uaW5nLS07XG4gICAgICAgICAgICAgICAgaWYgKDAgPT0gcnVubmluZykge1xuICAgICAgICAgICAgICAgICAgICBpbS50cmlnZ2VyKCdDb250cm9sU2V0c0xvYWRlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5pbS5iaW5kKCdDb250cm9sU2V0c0xvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpbS5maXJlKCdMb2FkaW5nQ29tcG9uZW50cycpO1xuICAgIGltLnNob3dMb2FkZXIoY2NtaTE4bl9pbWFnZWVkaXRvci5sb2FkaW5nQ29tcG9uZW50cyk7XG4gICAgdmFyIGNvbXBvbmVudHMgPSBzZXR0aW5ncy5jb21wb25lbnRzIHx8IHt9LCBuYW1lc3BhY2UsIHJ1bm5pbmcgPSAwO1xuICAgIGxvZygnTG9hZGluZyBDb21wb25lbnRzJyk7XG5cbiAgICBmb3IgKG5hbWVzcGFjZSBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgIHZhciBteW5zID0gXCJDb21wb25lbnRfXCIgKyBuYW1lc3BhY2U7XG4gICAgICAgICQuYWpheChjb21wb25lbnRzW25hbWVzcGFjZV1bJ3NyYyddLCB7XG4gICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UsXG4gICAgICAgICAgICBteW5zOiBteW5zLFxuICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJ1bm5pbmcrKztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoanMpIHtcbiAgICAgICAgICAgICAgICBydW5uaW5nLS07XG4gICAgICAgICAgICAgICAgdmFyIG5zbyA9IGltLmFkZENvbXBvbmVudCh0aGlzLm15bnMsIGpzLCBjb21wb25lbnRzW3RoaXMubmFtZXNwYWNlXVsnZWxlbWVudCddKTtcbiAgICAgICAgICAgICAgICBsb2cobnNvKTtcbiAgICAgICAgICAgICAgICBpbS5maXJlKCdDb21wb25lbnRMb2FkJywgbnNvKTtcbiAgICAgICAgICAgICAgICBpZiAoMCA9PSBydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGltLnRyaWdnZXIoJ0NvbXBvbmVudHNMb2FkZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIGVyckRlc2MsIGV4Y2VwdGlvbikge1xuICAgICAgICAgICAgICAgIHJ1bm5pbmctLTtcbiAgICAgICAgICAgICAgICBpZiAoMCA9PSBydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGltLnRyaWdnZXIoJ0NvbXBvbmVudHNMb2FkZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoMCA9PSBydW5uaW5nKSB7XG4gICAgICAgIGltLnRyaWdnZXIoJ0NvbXBvbmVudHNMb2FkZWQnKTtcbiAgICB9XG59KTtcblxuaW0uYmluZCgnQ29tcG9uZW50c0xvYWRlZCcsIGZ1bmN0aW9uICgpIHsgLy8gZG8gdGhpcyB3aGVuIHRoZSBjb250cm9sIHNldHMgZmluaXNoIGxvYWRpbmcuXG4gICAgbG9nKCdMb2FkaW5nIEZpbHRlcnMnKTtcbiAgICBpbS5zaG93TG9hZGVyKGNjbWkxOG5faW1hZ2VlZGl0b3IubG9hZGluZ0ZpbHRlcnMpO1xuICAgIHZhciBmaWx0ZXJzID0gc2V0dGluZ3MuZmlsdGVycyB8fCB7fSwgbmFtZXNwYWNlLCBmaXJzdGYsIGFjdGl2ZSA9IDA7XG4gICAgaW0uZmlyZSgnTG9hZGluZ0ZpbHRlcnMnKTtcbiAgICBmb3IgKG5hbWVzcGFjZSBpbiBmaWx0ZXJzKSB7XG4gICAgICAgIGlmIChmaWx0ZXJzLmhhc093blByb3BlcnR5KG5hbWVzcGFjZSkpIHtcbiAgICAgICAgICAgIChmdW5jdGlvbihuYW1lc3BhY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBfLmNsb25lKGZpbHRlcnNbbmFtZXNwYWNlXSksXG4gICAgICAgICAgICAgICAgICAgIG15bnMgPSBcIkZpbHRlcl9cIiArIG5hbWVzcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHNldHRpbmdzLm5hbWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWZpcnN0Zikge1xuICAgICAgICAgICAgICAgICAgICBmaXJzdGYgPSBteW5zO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGFjdGl2ZSsrO1xuICAgICAgICAgICAgICAgICQuYWpheChmaWx0ZXJzW25hbWVzcGFjZV0uc3JjLCB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UsXG4gICAgICAgICAgICAgICAgICAgIG15bnM6IG15bnMsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5zbyA9IGltLmFkZEZpbHRlcih0aGlzLm15bnMsIGpzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5zby5uYW1lID0gdGhpcy5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnNvLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbS5maXJlKCdmaWx0ZXJMb2FkJywgbnNvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZS0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IGFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltLnRyaWdnZXIoJ0ZpbHRlcnNMb2FkZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIGVyckRlc2MsIGV4Y2VwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlLS07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW0udHJpZ2dlcignRmlsdGVyc0xvYWRlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KG5hbWVzcGFjZSkpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5pbS5iaW5kKCdDaGFuZ2VBY3RpdmVBY3Rpb24nLCBmdW5jdGlvbiAoZSwgbnMpIHtcbiAgICBpZiAobnMgPT09IGltLmFjdGl2ZUNvbnRyb2xTZXQpIHJldHVybjtcbiAgICBmb3IgKHZhciBvbnMgaW4gaW0uY29udHJvbFNldHMpIHtcbiAgICAgICAgZ2V0RWxlbShpbS5jb250cm9sU2V0c1tvbnNdKTtcbiAgICAgICAgaWYgKG9ucyAhPT0gbnMpIGdldEVsZW0oaW0uY29udHJvbFNldHNbb25zXSkuc2xpZGVVcCgpO1xuICAgIH1cbiAgICBpbS5hY3RpdmVDb250cm9sU2V0ID0gbnM7XG4gICAgaW0uYWx0ZXJDb3JlKCdhY3RpdmVDb250cm9sU2V0JywgbnMpO1xuICAgIGlmICghbnMpIHtcbiAgICAgICAgJCgnZGl2LmNvbnRyb2wtc2V0cycsIGltLmNvbnRyb2xDb250ZXh0KS5maW5kKCdoNC5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGNzID0gJChpbS5jb250cm9sU2V0c1tuc10pLFxuICAgICAgICBoZWlnaHQgPSBjcy5zaG93KCkuaGVpZ2h0KCk7XG4gICAgaWYgKGNzLmxlbmd0aCA9PSAwKSByZXR1cm47XG4gICAgY3MuaGlkZSgpLmhlaWdodChoZWlnaHQpLnNsaWRlRG93bihmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykuaGVpZ2h0KCcnKVxuICAgIH0pO1xufSk7XG5cbmltLmJpbmQoJ0NoYW5nZUFjdGl2ZUNvbXBvbmVudCcsIGZ1bmN0aW9uIChlLCBucykge1xuICAgIGlmIChucyA9PT0gaW0uYWN0aXZlQ29tcG9uZW50KSByZXR1cm47XG4gICAgZm9yICh2YXIgb25zIGluIGltLmNvbXBvbmVudHMpIHtcbiAgICAgICAgaWYgKG9ucyAhPT0gbnMpIGdldEVsZW0oaW0uY29tcG9uZW50c1tvbnNdKS5zbGlkZVVwKCk7XG4gICAgfVxuICAgIGltLmFjdGl2ZUNvbXBvbmVudCA9IG5zO1xuICAgIGltLmFsdGVyQ29yZSgnYWN0aXZlQ29tcG9uZW50JywgbnMpO1xuICAgIGlmICghbnMpIHJldHVybjtcbiAgICB2YXIgY3MgPSAkKGltLmNvbXBvbmVudHNbbnNdKSxcbiAgICAgICAgaGVpZ2h0ID0gY3Muc2hvdygpLmhlaWdodCgpO1xuICAgIGlmIChjcy5sZW5ndGggPT0gMCkgcmV0dXJuO1xuICAgIGNzLmhpZGUoKS5oZWlnaHQoaGVpZ2h0KS5zbGlkZURvd24oZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLmhlaWdodCgnJylcbiAgICB9KTtcbn0pO1xuXG5pbS5iaW5kKCdDaGFuZ2VOYXZUYWInLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgIGltLnRyaWdnZXIoJ0NoYW5nZUFjdGl2ZUFjdGlvbicsIGRhdGEpO1xuICAgIGltLnRyaWdnZXIoJ0NoYW5nZUFjdGl2ZUNvbXBvbmVudCcsIGRhdGEpO1xuICAgIHZhciBwYXJlbnQgPSBnZXRFbGVtKCdkaXYuZWRpdG9yY29udHJvbHMnKTtcbiAgICBzd2l0Y2ggKGRhdGEpIHtcbiAgICAgICAgY2FzZSAnYWRkJzpcbiAgICAgICAgICAgIHBhcmVudC5jaGlsZHJlbignZGl2LmNvbnRyb2wtc2V0cycpLmhpZGUoKTtcbiAgICAgICAgICAgIHBhcmVudC5jaGlsZHJlbignZGl2LmNvbXBvbmVudHMnKS5zaG93KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZWRpdCc6XG4gICAgICAgICAgICBwYXJlbnQuY2hpbGRyZW4oJ2Rpdi5jb21wb25lbnRzJykuaGlkZSgpO1xuICAgICAgICAgICAgcGFyZW50LmNoaWxkcmVuKCdkaXYuY29udHJvbC1zZXRzJykuc2hvdygpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufSk7XG5cblxuaW0uYmluZCgnRmlsdGVyc0xvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpbS5oaWRlTG9hZGVyKCk7XG59KTtcblxuaW0uc2xpZGVPdXQgPSAkKFwiPGRpdi8+XCIpLmFkZENsYXNzKCdzbGlkZU91dCcpLmNzcyh7XG4gIHdpZHRoOjAsXG4gIGZsb2F0OidyaWdodCcsXG4gIGhlaWdodDonMTAwJScsXG4gICdvdmVyZmxvdy14JzonaGlkZGVuJyxcbiAgcmlnaHQ6aW0uY29udHJvbENvbnRleHQud2lkdGgoKS0xLFxuICBwb3NpdGlvbjonYWJzb2x1dGUnLFxuICBiYWNrZ3JvdW5kOid3aGl0ZScsXG4gICdib3gtc2hhZG93JzonYmxhY2sgLTIwcHggMCAyMHB4IC0yNXB4J1xufSk7XG5cbmltLnNsaWRlT3V0Q29udGVudHMgPSAkKCc8ZGl2Lz4nKS5hcHBlbmRUbyhpbS5zbGlkZU91dCkud2lkdGgoMzAwKTtcbmltLnNob3dTbGlkZU91dCA9IGZ1bmN0aW9uKGNvbnRlbnRzLGNhbGxiYWNrKSB7XG4gIGltLmhpZGVTbGlkZU91dChmdW5jdGlvbigpe1xuICAgIGltLnNsaWRlT3V0LmVtcHR5KCk7XG4gICAgaW0uc2xpZGVPdXRDb250ZW50cyA9IGNvbnRlbnRzLndpZHRoKDMwMCk7XG4gICAgaW0uc2xpZGVPdXQuYXBwZW5kKGltLnNsaWRlT3V0Q29udGVudHMpXG4gICAgaW0uc2xpZGVPdXQuYWRkQ2xhc3MoJ2FjdGl2ZScpLmFkZENsYXNzKCdzbGlkaW5nJyk7XG4gICAgaW0uc2xpZGVPdXQuc3RvcCgxKS5zbGlkZU91dCgzMDAsIGZ1bmN0aW9uKCl7XG4gICAgICBpbS5zbGlkZU91dC5yZW1vdmVDbGFzcygnc2xpZGluZycpO1xuICAgICAgKCh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpICYmIGNhbGxiYWNrKCkpO1xuICAgIH0pO1xuICB9KTtcbn07XG5pbS5oaWRlU2xpZGVPdXQgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICBpbS5zbGlkZU91dC5hZGRDbGFzcygnc2xpZGluZycpO1xuICBpbS5zbGlkZU91dC5zbGlkZUluKDMwMCxmdW5jdGlvbigpe1xuICAgIGltLnNsaWRlT3V0LmNzcygnYm9yZGVyLXJpZ2h0JywnMCcpO1xuICAgIGltLnNsaWRlT3V0LnJlbW92ZUNsYXNzKCdhY3RpdmUnKS5yZW1vdmVDbGFzcygnc2xpZGluZycpO1xuICAgICgodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSAmJiBjYWxsYmFjaygpKTtcbiAgfSk7XG59O1xuaW0uY29udHJvbENvbnRleHQuYWZ0ZXIoaW0uc2xpZGVPdXQpO1xuXG4gICAgLy8gRW5kIHRoZSBJbWFnZUVkaXRvciBvYmplY3QuXG5cbiAgICBpbS5zZXRBY3RpdmVFbGVtZW50KGltLnN0YWdlKTtcblxuICAgIHdpbmRvdy5jNV9pbWFnZV9lZGl0b3IgPSBpbTsgLy8gU2FmZSBrZWVwaW5nXG4gICAgd2luZG93LmltID0gaW07XG4gICAgcmV0dXJuIGltO1xufTtcblxuJC5mbi5JbWFnZUVkaXRvciA9IGZ1bmN0aW9uIChzZXR0aW5ncykge1xuICAgIChzZXR0aW5ncyA9PT0gdW5kZWZpbmVkICYmIChzZXR0aW5ncyA9IHt9KSk7XG4gICAgc2V0dGluZ3MuaW1hZ2Vsb2FkID0gJC5mbi5kaWFsb2cuaGlkZUxvYWRlcjtcbiAgICB2YXIgc2VsZiA9ICQodGhpcyk7XG4gICAgc2V0dGluZ3MuY29udGFpbmVyID0gc2VsZlswXTtcbiAgICBpZiAoc2VsZi5oZWlnaHQoKSA9PSAwKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5JbWFnZUVkaXRvcihzZXR0aW5ncyk7XG4gICAgICAgIH0sIDUwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZWxmLmNsb3Nlc3QoJy51aS1kaWFsb2cnKS5maW5kKCcudWktcmVzaXphYmxlLWhhbmRsZScpLmhpZGUoKTtcbiAgICBzZWxmLmhlaWdodChcIi09MzBcIik7XG4gICAgJCgnZGl2LmVkaXRvcmNvbnRyb2xzJykuaGVpZ2h0KHNlbGYuaGVpZ2h0KCkgLSA5MCk7XG4gICAgc2VsZi53aWR0aChcIi09MzMwXCIpLnBhcmVudCgpLndpZHRoKFwiLT0zMzBcIikuY2hpbGRyZW4oJ2Rpdi5ib3R0b21CYXInKS53aWR0aChcIi09MzMwXCIpO1xuICAgIChzZXR0aW5ncy53aWR0aCA9PT0gdW5kZWZpbmVkICYmIChzZXR0aW5ncy53aWR0aCA9IHNlbGYud2lkdGgoKSkpO1xuICAgIChzZXR0aW5ncy5oZWlnaHQgPT09IHVuZGVmaW5lZCAmJiAoc2V0dGluZ3MuaGVpZ2h0ID0gc2VsZi5oZWlnaHQoKSkpO1xuICAgICQuZm4uZGlhbG9nLnNob3dMb2FkZXIoKTtcbiAgICB2YXIgaW0gPSBuZXcgSW1hZ2VFZGl0b3Ioc2V0dGluZ3MpO1xuXG4gICAgdmFyIGNvbnRleHQgPSBpbS5kb21Db250ZXh0O1xuICAgICQoJ2Rpdi5jb250cm9sLXNldHMgPiBkaXYuY29udHJvbHNldCcsIGNvbnRleHQpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY29udGFpbmVyID0gJCh0aGlzKSxcbiAgICAgICAgICAgIHR5cGUgPSBjb250YWluZXIuZGF0YSgnbmFtZXNwYWNlJyk7XG5cbiAgICAgICAgY29udGFpbmVyLmZpbmQoJ2g0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFjb250YWluZXIuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgaW0uZmlyZSgnQ2hhbmdlQWN0aXZlQWN0aW9uJywgJ0NvbnRyb2xTZXRfJyArIHR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpbS5iaW5kKCdDaGFuZ2VBY3RpdmVBY3Rpb24nLCBmdW5jdGlvbihlLCBkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSA9PT0gJ0NvbnRyb2xTZXRfJyArIHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0LmZpbmQoJ2Rpdi5jb250cm9sc2V0LmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKS5jaGlsZHJlbignLmNvbnRyb2wnKS5zbGlkZVVwKDI1MCk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIHZhciBjb250cm9sID0gY29udGFpbmVyLmNoaWxkcmVuKCcuY29udHJvbCcpLmhlaWdodCgnYXV0bycpO1xuICAgICAgICAgICAgICAgIGNvbnRyb2wuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJCgnZGl2LmNvbnRyb2xzID4gZGl2LmNvbnRyb2xzY29udGFpbmVyJywgY29udGV4dCkuY2hpbGRyZW4oJ2Rpdi5zYXZlJykuY2hpbGRyZW4oJ2J1dHRvbi5zYXZlJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgIGltLnNhdmUoKTtcbiAgICB9KS5lbmQoKS5jaGlsZHJlbignYnV0dG9uLmNhbmNlbCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNvbmZpcm0oY2NtaTE4bl9pbWFnZWVkaXRvci5hcmVZb3VTdXJlKSlcbiAgICAgICAgICAgICQuZm4uZGlhbG9nLmNsb3NlVG9wKCk7XG4gICAgfSk7XG5cbiAgICBpbS5vbignQ2hhbmdlQWN0aXZlQWN0aW9uJywgZnVuY3Rpb24gKGUsIGRhdGEpIHtcbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICAkKCdoNC5hY3RpdmUnLCBjb250ZXh0KS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGltLm9uKCdDaGFuZ2VBY3RpdmVDb21wb25lbnQnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgICAgICQoJ2Rpdi5jb250cm9sc2V0LmFjdGl2ZScsIGNvbnRleHQpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaW0uYmluZCgnaW1hZ2Vsb2FkJywgJC5mbi5kaWFsb2cuaGlkZUxvYWRlcik7XG4gICAgcmV0dXJuIGltO1xufTtcbiQuZm4uc2xpZGVPdXQgPSBmdW5jdGlvbiAodGltZSwgY2FsbGJhY2spIHtcbiAgICB2YXIgbWUgPSAkKHRoaXMpLFxuICAgICAgICBzdGFydFdpZHRoID0gbWUud2lkdGgoKSxcbiAgICAgICAgdG90YWxXaWR0aCA9IDI1NTtcbiAgICBtZS5jc3MoJ292ZXJmbG93LXknLCAnYXV0bycpO1xuICAgIGlmIChzdGFydFdpZHRoID09IHRvdGFsV2lkdGgpIHtcbiAgICAgICAgbWUuYW5pbWF0ZSh7d2lkdGg6IHRvdGFsV2lkdGh9LCAwLCBjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBtZS53aWR0aChzdGFydFdpZHRoKS5hbmltYXRlKHt3aWR0aDogdG90YWxXaWR0aH0sIHRpbWUgfHwgMzAwLCBjYWxsYmFjayB8fCBmdW5jdGlvbiAoKSB7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXM7XG59O1xuJC5mbi5zbGlkZUluID0gZnVuY3Rpb24gKHRpbWUsIGNhbGxiYWNrKSB7XG4gICAgdmFyIG1lID0gJCh0aGlzKTtcbiAgICBtZS5jc3MoJ292ZXJmbG93LXknLCAnaGlkZGVuJyk7XG4gICAgaWYgKG1lLndpZHRoKCkgPT09IDApIHtcbiAgICAgICAgbWUuYW5pbWF0ZSh7d2lkdGg6IDB9LCAwLCBjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIG1lLmFuaW1hdGUoe3dpZHRoOiAwfSwgdGltZSB8fCAzMDAsIGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbn07XG5cbkltYWdlRWRpdG9yLnByb3RvdHlwZSA9IEltYWdlRWRpdG9yLmZuID0ge1xuICBmaWx0ZXI6IHtcbiAgICBncmF5c2NhbGU6IEtpbmV0aWMuRmlsdGVycy5HcmF5c2NhbGUsXG4gICAgc2VwaWE6IGZ1bmN0aW9uIChpbWFnZURhdGEpIHtcbiAgICAgIHZhciBpO1xuICAgICAgdmFyIGRhdGEgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICAgIGRhdGFbaV0gICAgID0gKGRhdGFbaV0gKiAwLjM5MyArIGRhdGFbaSArIDFdICogMC43NjkgKyBkYXRhW2kgKyAyXSAqIDAuMTg5KTtcbiAgICAgICAgZGF0YVtpICsgMV0gPSAoZGF0YVtpXSAqIDAuMzQ5ICsgZGF0YVtpICsgMV0gKiAwLjY4NiArIGRhdGFbaSArIDJdICogMC4xNjgpO1xuICAgICAgICBkYXRhW2kgKyAyXSA9IChkYXRhW2ldICogMC4yNzIgKyBkYXRhW2kgKyAxXSAqIDAuNTM0ICsgZGF0YVtpICsgMl0gKiAwLjEzMSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBicmlnaHRuZXNzOiBmdW5jdGlvbiAoaW1hZ2VEYXRhLG9iKSB7XG4gICAgICB2YXIgYWRqdXN0bWVudCA9IG9iLmxldmVsO1xuICAgICAgdmFyIGQgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgIGZvciAodmFyIGk9MDsgaTxkLmxlbmd0aDsgaSs9NCkge1xuICAgICAgICBkW2ldICs9IGFkanVzdG1lbnQ7XG4gICAgICAgIGRbaSsxXSArPSBhZGp1c3RtZW50O1xuICAgICAgICBkW2krMl0gKz0gYWRqdXN0bWVudDtcbiAgICAgIH1cbiAgICB9LFxuICAgIGludmVydDogZnVuY3Rpb24gKGltYWdlRGF0YSxvYikge1xuICAgICAgdmFyIGQgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgIGZvciAodmFyIGk9MDsgaTxkLmxlbmd0aDsgaSs9NCkge1xuICAgICAgICBkW2ldID0gMjU1IC0gZFtpXTtcbiAgICAgICAgZFtpKzFdID0gMjU1IC0gZFtpKzFdO1xuICAgICAgICBkW2krMl0gPSAyNTUgLSBkW2krMl07XG4gICAgICB9XG4gICAgfSxcbiAgICByZXN0b3JlOiBmdW5jdGlvbiAoaW1hZ2VEYXRhLG9iKSB7XG4gICAgICB2YXIgYWRqdXN0bWVudCA9IG9iLmxldmVsO1xuICAgICAgICB2YXIgZCA9IGltYWdlRGF0YS5kYXRhO1xuICAgICAgICB2YXIgZyA9IG9iLmltYWdlRGF0YS5kYXRhO1xuICAgICAgZm9yICh2YXIgaT0wOyBpPGQubGVuZ3RoOyBpKz00KSB7XG4gICAgICAgIGRbaV0gPSBnW2ldO1xuICAgICAgICBkW2krMV0gPSBnW2krMV07XG4gICAgICAgIGRbaSsyXSA9IGdbaSsyXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi4vY29uY3JldGUvanMvYnVpbGQvY29yZS9pbWFnZS1lZGl0b3IvaW1hZ2UtZWRpdG9yLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");
}]);