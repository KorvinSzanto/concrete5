var Kinetic={};!function(){Kinetic={version:"4.7.2",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var t=navigator.userAgent.toLowerCase(),e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(),Filters:{},Node:function(t){this._init(t)},Shape:function(t){this.__init(t)},Container:function(t){this.__init(t)},Stage:function(t){this.___init(t)},Layer:function(t){this.___init(t)},Group:function(t){this.___init(t)},isDragging:function(){var t=Kinetic.DD;return!!t&&t.isDragging},isDragReady:function(){var t=Kinetic.DD;return!!t&&!!t.node},_addId:function(t,e){void 0!==e&&(this.ids[e]=t)},_removeId:function(t){void 0!==t&&delete this.ids[t]},_addName:function(t,e){void 0!==e&&(void 0===this.names[e]&&(this.names[e]=[]),this.names[e].push(t))},_removeName:function(t,e){if(void 0!==t){var i=this.names[t];if(void 0!==i){for(var n=0;n<i.length;n++){var a=i[n];a._id===e&&i.splice(n,1)}0===i.length&&delete this.names[t]}}}}}(),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.returnExports=e()}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var t=[].slice.call(arguments),e=t.length,i=0;for(this.length=e;i<e;i++)this[i]=t[i];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(t){for(var e=0;e<this.length;e++)t(this[e],e)},Kinetic.Collection.prototype.toArray=function(){var t,e=[],i=this.length;for(t=0;t<i;t++)e.push(this[t]);return e},Kinetic.Collection.toCollection=function(t){var e,i=new Kinetic.Collection,n=t.length;for(e=0;e<n;e++)i.push(t[e]);return i},Kinetic.Collection.mapMethods=function(t){var e,i=t.length;for(e=0;e<i;e++)!function(e){var i=t[e];Kinetic.Collection.prototype[i]=function(){var t,e=this.length;for(args=[].slice.call(arguments),t=0;t<e;t++)this[t][i].apply(this[t],args)}}(e)},Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,a=this.m[1]*e+this.m[3]*i,r=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=a,this.m[2]=r,this.m[3]=s},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(t,e){var i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,a=this.m[2]+this.m[0]*t,r=this.m[3]+this.m[1]*t;this.m[0]=i,this.m[1]=n,this.m[2]=a,this.m[3]=r},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],r=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=r,this.m[5]=s},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,a=this.m[0]*t,r=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=r,this.m[5]=s},getMatrix:function(){return this.m},setAbsolutePosition:function(t,e){var i=this.m[0],n=this.m[1],a=this.m[2],r=this.m[3],s=this.m[4],o=this.m[5],h=(i*(e-o)-n*(t-s))/(i*r-n*a),c=(t-s-a*h)/i;this.translate(c,h)}};var t="canvas",e="2d",i="[object Array]",n="[object Number]",a="[object String]",r=Math.PI/180,s=180/Math.PI,o="#",h="",c="0",l="Kinetic error: ",d="rgb(",u={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},f=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isObject:function(t){return!!t&&t.constructor==Object},_isArray:function(t){return Object.prototype.toString.call(t)==i},_isNumber:function(t){return Object.prototype.toString.call(t)==n},_isString:function(t){return Object.prototype.toString.call(t)==a},_hasMethods:function(t){var e,i=[];for(e in t)this._isFunction(t[e])&&i.push(e);return i.length>0},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_simplifyArray:function(t){var e,i,n=[],a=t.length,r=Kinetic.Util;for(e=0;e<a;e++)i=t[e],r._isNumber(i)?i=Math.round(1e3*i)/1e3:r._isString(i)||(i=i.toString()),n.push(i);return n},_getXY:function(t){if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t)){if(1===t.length){var e=t[0];if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e))return{x:e[0],y:e[1]};if(this._isObject(e))return e}else if(t.length>=2)return{x:t[0],y:t[1]}}else if(this._isObject(t))return t;return null},_getSize:function(t){if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t))if(1===t.length){var e=t[0];if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e)){if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e}else{if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t;return null},_getPoints:function(t){var e,i,n=[];if(void 0===t)return[];if(i=t.length,this._isArray(t[0])){for(e=0;e<i;e++)n.push({x:t[e][0],y:t[e][1]});return n}if(this._isObject(t[0]))return t;for(e=0;e<i;e+=2)n.push({x:t[e],y:t[e+1]});return n},_getImage:function(i,n){var a,r,s;i?this._isElement(i)?n(i):this._isString(i)?(a=new Image,a.onload=function(){n(a)},a.src=i):i.data?(r=document.createElement(t),r.width=i.width,r.height=i.height,_context=r.getContext(e),_context.putImageData(i,0,0),s=r.toDataURL(),a=new Image,a.onload=function(){n(a)},a.src=s):n(null):n(null)},_rgbToHex:function(t,e,i){return((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},_hexToRgb:function(t){t=t.replace(o,h);var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor:function(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t=c+t;return o+t},get:function(t,e){return void 0===t?e:t},getRGB:function(t){var e;return t in u?(e=u[t],{r:e[0],g:e[1],b:e[2]}):t[0]===o?this._hexToRgb(t.substring(1)):t.substr(0,4)===d?(e=f.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},_merge:function(t,e){var i=this._clone(e);for(var n in t)this._isObject(t[n])?i[n]=this._merge(t[n],i[n]):i[n]=t[n];return i},_clone:function(t){var e={};for(var i in t)this._isObject(t[i])?e[i]=this._clone(t[i]):e[i]=t[i];return e},_degToRad:function(t){return t*r},_radToDeg:function(t){return t*s},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},error:function(t){throw new Error(l+t)},warn:function(t){window.console&&console.warn},extend:function(t,e){for(var i in e.prototype)i in t.prototype||(t.prototype[i]=e.prototype[i])},addMethods:function(t,e){var i;for(i in e)t.prototype[i]=e[i]},_getControlPoints:function(t,e,i,n){var a=t.x,r=t.y,s=e.x,o=e.y,h=i.x,c=i.y,l=Math.sqrt(Math.pow(s-a,2)+Math.pow(o-r,2)),d=Math.sqrt(Math.pow(h-s,2)+Math.pow(c-o,2)),u=n*l/(l+d),f=n*d/(l+d),g=s-u*(h-a),p=o-u*(c-r),v=s+f*(h-a),_=o+f*(c-r);return[{x:g,y:p},{x:v,y:_}]},_expandPoints:function(t,e){var i,n,a=t.length,r=[];for(i=1;i<a-1;i++)n=Kinetic.Util._getControlPoints(t[i-1],t[i],t[i+1],e),r.push(n[0]),r.push(t[i]),r.push(n[1]);return r},_removeLastLetter:function(t){return t.substring(0,t.length-1)}}}(),function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,a=i/n;Kinetic.Canvas=function(t){this.init(t)},Kinetic.Canvas.prototype={init:function(t){t=t||{};var e=t.pixelRatio||Kinetic.pixelRatio||a;this.pixelRatio=e,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(t){this.pixelRatio=t,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px"},setHeight:function(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},toDataURL:function(t,e){try{return this._canvas.toDataURL(t,e)}catch(i){try{return this._canvas.toDataURL()}catch(n){return Kinetic.Util.warn("Unable to get data URL. "+n.message),""}}}},Kinetic.SceneCanvas=function(t){t=t||{};var e=t.width||0,i=t.height||0;Kinetic.Canvas.call(this,t),this.context=new Kinetic.SceneContext(this),this.setSize(e,i)},Kinetic.SceneCanvas.prototype={setWidth:function(t){var e=this.pixelRatio,i=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,t),i.scale(e,e)},setHeight:function(t){var e=this.pixelRatio,i=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,t),i.scale(e,e)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(t){t=t||{};var e=t.width||0,i=t.height||0;Kinetic.Canvas.call(this,t),this.context=new Kinetic.HitContext(this),this.setSize(e,i)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var t=",",e="(",i=")",n="([",a="])",r=";",s="()",o="=",h=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(t){this.init(t)},Kinetic.Context.prototype={init:function(t){this.canvas=t,this._context=t._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(t){t.getFillEnabled()&&this._fill(t)},strokeShape:function(t){t.getStrokeEnabled()&&this._stroke(t)},fillStrokeShape:function(t){var e=t.getFillEnabled();e&&this._fill(t),t.getStrokeEnabled()&&this._stroke(t)},getTrace:function(h){var c,l,d,u,f=this.traceArr,g=f.length,p="";for(c=0;c<g;c++)l=f[c],d=l.method,d?(u=l.args,p+=d,p+=h?s:Kinetic.Util._isArray(u[0])?n+u.join(t)+a:e+u.join(t)+i):(p+=l.property,h||(p+=o+l.val)),p+=r;return p},clearTrace:function(){this.traceArr=[]},_trace:function(t){var e,i=this.traceArr;i.push(t),e=i.length,e>=Kinetic.traceArrMax&&i.shift()},reset:function(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)},getCanvas:function(){return this.canvas},clear:function(){var t,e,i=[].slice.call(arguments),n=this.getCanvas();i.length?(t=Kinetic.Util._getXY(i),e=Kinetic.Util._getSize(i),this.clearRect(t.x||0,t.y||0,e.width,e.height)):this.clearRect(0,0,n.getWidth(),n.getHeight())},_applyLineCap:function(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)},_applyOpacity:function(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)},_applyLineJoin:function(t){var e=t.getLineJoin();e&&this.setAttr("lineJoin",e)},_applyAncestorTransforms:function(t){var e=t.getAbsoluteTransform().getMatrix();this.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_clip:function(t){var e=t.getClipX()||0,i=t.getClipY()||0,n=t.getClipWidth(),a=t.getClipHeight();this.save(),this._applyAncestorTransforms(t),this.beginPath(),this.rect(e,i,n,a),this.clip(),this.reset(),t._drawChildren(this.getCanvas()),this.restore()},setAttr:function(t,e){this._context[t]=e},arc:function(){var t=arguments;this._context.arc(t[0],t[1],t[2],t[3],t[4],t[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var t=arguments;this._context.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5])},clearRect:function(){var t=arguments;this._context.clearRect(t[0],t[1],t[2],t[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createLinearGradient:function(){var t=arguments;return this._context.createLinearGradient(t[0],t[1],t[2],t[3])},createPattern:function(){var t=arguments;return this._context.createPattern(t[0],t[1])},createRadialGradient:function(){var t=arguments;return this._context.createRadialGradient(t[0],t[1],t[2],t[3],t[4],t[5])},drawImage:function(){var t=arguments,e=this._context;3===t.length?e.drawImage(t[0],t[1],t[2]):5===t.length?e.drawImage(t[0],t[1],t[2],t[3],t[4]):9===t.length&&e.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},fill:function(){this._context.fill()},fillText:function(){var t=arguments;this._context.fillText(t[0],t[1],t[2])},getImageData:function(){var t=arguments;return this._context.getImageData(t[0],t[1],t[2],t[3])},lineTo:function(){var t=arguments;this._context.lineTo(t[0],t[1])},moveTo:function(){var t=arguments;this._context.moveTo(t[0],t[1])},rect:function(){var t=arguments;this._context.rect(t[0],t[1],t[2],t[3])},putImageData:function(){var t=arguments;this._context.putImageData(t[0],t[1],t[2])},quadraticCurveTo:function(){var t=arguments;this._context.quadraticCurveTo(t[0],t[1],t[2],t[3])},restore:function(){this._context.restore()},rotate:function(){var t=arguments;this._context.rotate(t[0])},save:function(){this._context.save()},scale:function(){var t=arguments;this._context.scale(t[0],t[1])},setLineDash:function(){var t=arguments,e=this._context;this._context.setLineDash?e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])},setTransform:function(){var t=arguments;this._context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},stroke:function(){this._context.stroke()},strokeText:function(){var t=arguments;this._context.strokeText(t[0],t[1],t[2])},transform:function(){var t=arguments;this._context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},translate:function(){var t=arguments;this._context.translate(t[0],t[1])},_enableTrace:function(){var t,e,i=this,n=h.length,a=Kinetic.Util._simplifyArray,r=this.setAttr;for(t=0;t<n;t++)!function(t){var n,r=i[t];i[t]=function(){return e=a(Array.prototype.slice.call(arguments,0)),n=r.apply(i,arguments),i._trace({method:t,args:e}),n}}(h[t]);i.setAttr=function(){r.apply(i,arguments),i._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(t){Kinetic.Context.call(this,t)},Kinetic.SceneContext.prototype={_fillColor:function(t){var e=t.getFill();this.setAttr("fillStyle",e),t._fillFunc(this)},_fillPattern:function(t){var e=t.getFillPatternImage(),i=t.getFillPatternX(),n=t.getFillPatternY(),a=t.getFillPatternScale(),r=t.getFillPatternRotation(),s=t.getFillPatternOffset(),o=t.getFillPatternRepeat();(i||n)&&this.translate(i||0,n||0),r&&this.rotate(r),a&&this.scale(a.x,a.y),s&&this.translate(-1*s.x,-1*s.y),this.setAttr("fillStyle",this.createPattern(e,o||"repeat")),this.fill()},_fillLinearGradient:function(t){var e=t.getFillLinearGradientStartPoint(),i=t.getFillLinearGradientEndPoint(),n=t.getFillLinearGradientColorStops(),a=this.createLinearGradient(e.x,e.y,i.x,i.y);if(n){for(var r=0;r<n.length;r+=2)a.addColorStop(n[r],n[r+1]);this.setAttr("fillStyle",a),this.fill()}},_fillRadialGradient:function(t){for(var e=t.getFillRadialGradientStartPoint(),i=t.getFillRadialGradientEndPoint(),n=t.getFillRadialGradientStartRadius(),a=t.getFillRadialGradientEndRadius(),r=t.getFillRadialGradientColorStops(),s=this.createRadialGradient(e.x,e.y,n,i.x,i.y,a),o=0;o<r.length;o+=2)s.addColorStop(r[o],r[o+1]);this.setAttr("fillStyle",s),this.fill()},_fill:function(t){var e=t.getFill(),i=t.getFillPatternImage(),n=t.getFillLinearGradientColorStops(),a=t.getFillRadialGradientColorStops(),r=t.getFillPriority();e&&"color"===r?this._fillColor(t):i&&"pattern"===r?this._fillPattern(t):n&&"linear-gradient"===r?this._fillLinearGradient(t):a&&"radial-gradient"===r?this._fillRadialGradient(t):e?this._fillColor(t):i?this._fillPattern(t):n?this._fillLinearGradient(t):a&&this._fillRadialGradient(t)},_stroke:function(t){var e=t.getStroke(),i=t.getStrokeWidth(),n=t.getDashArray(),a=t.getStrokeScaleEnabled();t.hasStroke()&&(a||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(t),n&&t.getDashArrayEnabled()&&this.setLineDash(n),this.setAttr("lineWidth",i||2),this.setAttr("strokeStyle",e||"black"),t._strokeFunc(this),a||this.restore())},_applyShadow:function(t){var e=Kinetic.Util,i=t.getAbsoluteOpacity(),n=e.get(t.getShadowColor(),"black"),a=e.get(t.getShadowBlur(),5),r=e.get(t.getShadowOpacity(),0),s=e.get(t.getShadowOffset(),{x:0,y:0});r&&this.setAttr("globalAlpha",r*i),this.setAttr("shadowColor",n),this.setAttr("shadowBlur",a),this.setAttr("shadowOffsetX",s.x),this.setAttr("shadowOffsetY",s.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(t){Kinetic.Context.call(this,t)},Kinetic.HitContext.prototype={_fill:function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},_stroke:function(t){var e=t.getStroke(),i=t.getStrokeWidth();(e||i)&&(this._applyLineCap(t),this.setAttr("lineWidth",i||2),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var t="add",e="b",i="Deg",n="g",a="get",r="#",s="r",o="RGB",h="set",c="B",l="G",d="Height",u="R",f="Width",g="X",p="Y";Kinetic.Factory={addGetterSetter:function(t,e,i){this.addGetter(t,e,i),this.addSetter(t,e)},addPointGetterSetter:function(t,e,i){this.addPointGetter(t,e,i),this.addPointSetter(t,e),this.addGetter(t,e+g,i),this.addGetter(t,e+p,i),this.addSetter(t,e+g),this.addSetter(t,e+p)},addBoxGetterSetter:function(t,e,i){this.addBoxGetter(t,e,i),this.addBoxSetter(t,e),this.addGetter(t,e+g,i),this.addGetter(t,e+p,i),this.addGetter(t,e+f,i),this.addGetter(t,e+d,i),this.addSetter(t,e+g),this.addSetter(t,e+p),this.addSetter(t,e+f),this.addSetter(t,e+d)},addPointsGetterSetter:function(t,e){this.addPointsGetter(t,e),this.addPointsSetter(t,e),this.addPointAdder(t,e)},addRotationGetterSetter:function(t,e,i){this.addRotationGetter(t,e,i),this.addRotationSetter(t,e)},addColorGetterSetter:function(t,i){this.addGetter(t,i),this.addSetter(t,i),this.addColorRGBGetter(t,i),this.addColorComponentGetter(t,i,s),this.addColorComponentGetter(t,i,n),this.addColorComponentGetter(t,i,e),this.addColorRGBSetter(t,i),this.addColorComponentSetter(t,i,s),this.addColorComponentSetter(t,i,n),this.addColorComponentSetter(t,i,e)},addColorRGBGetter:function(t,e){var i=a+Kinetic.Util._capitalize(e)+o;t.prototype[i]=function(){return Kinetic.Util.getRGB(this.attrs[e])}},addColorComponentGetter:function(t,e,i){var n=a+Kinetic.Util._capitalize(e),r=n+Kinetic.Util._capitalize(i);t.prototype[r]=function(){return this[n+o]()[i]}},addPointsGetter:function(t,e){var i=a+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=this.attrs[e];return void 0===t?[]:t}},addGetter:function(t,e,i){var n=a+Kinetic.Util._capitalize(e);t.prototype[n]=function(){var t=this.attrs[e];return void 0===t?i:t}},addPointGetter:function(t,e){var i=a+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=this;return{x:t[i+g](),y:t[i+p]()}}},addBoxGetter:function(t,e){var i=a+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=this;return{x:t[i+g](),y:t[i+p](),width:t[i+f](),height:t[i+d]()}}},addRotationGetter:function(t,e,n){var r=a+Kinetic.Util._capitalize(e);t.prototype[r]=function(){var t=this.attrs[e];return void 0===t&&(t=n),t},t.prototype[r+i]=function(){var t=this.attrs[e];return void 0===t&&(t=n),Kinetic.Util._radToDeg(t)}},addColorRGBSetter:function(t,e){var i=h+Kinetic.Util._capitalize(e)+o;t.prototype[i]=function(t){var i=t&&void 0!==t.r?0|t.r:this.getAttr(e+u),n=t&&void 0!==t.g?0|t.g:this.getAttr(e+l),a=t&&void 0!==t.b?0|t.b:this.getAttr(e+c);this._setAttr(e,r+Kinetic.Util._rgbToHex(i,n,a))}},addColorComponentSetter:function(t,e,i){var n=h+Kinetic.Util._capitalize(e),a=n+Kinetic.Util._capitalize(i);t.prototype[a]=function(t){var e={};e[i]=t,this[n+o](e)}},addPointsSetter:function(t,e){var i=h+Kinetic.Util._capitalize(e);t.prototype[i]=function(t){var e=Kinetic.Util._getPoints(t);this._setAttr("points",e)}},addSetter:function(t,e){var i=h+Kinetic.Util._capitalize(e);t.prototype[i]=function(t){this._setAttr(e,t)}},addPointSetter:function(t,e){var i=h+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t=Kinetic.Util._getXY([].slice.call(arguments)),n=this.attrs[e],a=0,r=0;t&&(a=t.x,r=t.y,this._fireBeforeChangeEvent(e,n,t),void 0!==a&&this[i+g](a),void 0!==r&&this[i+p](r),this._fireChangeEvent(e,n,t))}},addBoxSetter:function(t,e){var i=h+Kinetic.Util._capitalize(e);t.prototype[i]=function(){var t,n,a,r,s=[].slice.call(arguments),o=Kinetic.Util._getXY(s),h=Kinetic.Util._getSize(s),c=Kinetic.Util._merge(o,h),l=this.attrs[e];c&&(t=c.x,n=c.y,a=c.width,r=c.height,this._fireBeforeChangeEvent(e,l,c),void 0!==t&&this[i+g](t),void 0!==n&&this[i+p](n),void 0!==a&&this[i+f](a),void 0!==r&&this[i+d](r),this._fireChangeEvent(e,l,c))}},addRotationSetter:function(t,e){var n=h+Kinetic.Util._capitalize(e);t.prototype[n]=function(t){this._setAttr(e,t)},t.prototype[n+i]=function(t){this._setAttr(e,Kinetic.Util._degToRad(t))}},addPointAdder:function(e,i){var n=t+Kinetic.Util._removeLastLetter(Kinetic.Util._capitalize(i));e.prototype[n]=function(){var t=Kinetic.Util._getXY([].slice.call(arguments)),e=this.attrs[i];t&&(this._fireBeforeChangeEvent(i,e,t),this.attrs[i].push(t),this._fireChangeEvent(i,e,t))}}}}(),function(){var t="absoluteOpacity",e="absoluteTransform",i="before",n="Change",a="children",r=".",s="",o="get",h="id",c="kinetic",l="listening",d="mouseenter",u="mouseleave",f="name",g="set",p="Shape",v=" ",_="stage",K="transform",m="Stage",y="visible",S=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic"].join(v);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(i){var n=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this.cache={},this.setAttrs(i),this.on(S,function(){this._clearCache(K),n._clearSelfAndChildrenCache(e)}),this.on("visibleChange.kinetic",function(){n._clearSelfAndChildrenCache(y)}),this.on("listeningChange.kinetic",function(){n._clearSelfAndChildrenCache(l)}),this.on("opacityChange.kinetic",function(){n._clearSelfAndChildrenCache(t)})},clearCache:function(){this.cache={}},_clearCache:function(t){delete this.cache[t]},_getCache:function(t,e){var i=this.cache[t];return void 0===i&&(this.cache[t]=e.call(this)),this.cache[t]},_clearSelfAndChildrenCache:function(t){this._clearCache(t),this.children&&this.getChildren().each(function(e){e._clearSelfAndChildrenCache(t)})},on:function(t,e){var i,n,a,o,h,c=t.split(v),l=c.length;for(i=0;i<l;i++)n=c[i],a=n.split(r),o=a[0],h=a[1]||s,this.eventListeners[o]||(this.eventListeners[o]=[]),this.eventListeners[o].push({name:h,handler:e});return this},off:function(t){var e,i,n,a,s,o,h=t.split(v),c=h.length;for(e=0;e<c;e++)if(n=h[e],a=n.split(r),s=a[0],o=a[1],s)this.eventListeners[s]&&this._off(s,o);else for(i in this.eventListeners)this._off(i,o);return this},remove:function(){var i=this.getParent();return i&&i.children&&(i.children.splice(this.index,1),i._setChildrenIndices(),delete this.parent),this._clearSelfAndChildrenCache(_),this._clearSelfAndChildrenCache(e),this._clearSelfAndChildrenCache(y),this._clearSelfAndChildrenCache(l),this._clearSelfAndChildrenCache(t),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(t){var e=o+Kinetic.Util._capitalize(t);return Kinetic.Util._isFunction(this[e])?this[e]():this.attrs[t]},getAncestors:function(){for(var t=this.getParent(),e=new Kinetic.Collection;t;)e.push(t),t=t.getParent();return e},setAttr:function(){var t=Array.prototype.slice.call(arguments),e=t[0],i=g+Kinetic.Util._capitalize(e),n=this[i];return t.shift(),Kinetic.Util._isFunction(n)?n.apply(this,t):this.attrs[e]=t[0],this},getAttrs:function(){return this.attrs||{}},setAttrs:function(t){var e,i;if(t)for(e in t)e===a||(i=g+Kinetic.Util._capitalize(e),Kinetic.Util._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]));return this},isListening:function(){return this._getCache(l,this._isListening)},_isListening:function(){var t=this.getListening(),e=this.getParent();return!(t&&e&&!e.isListening())&&t},isVisible:function(){return this._getCache(y,this._isVisible)},_isVisible:function(){var t=this.getVisible(),e=this.getParent();return!(t&&e&&!e.isVisible())&&t},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function t(h){for(e=[],i=h.length,n=0;n<i;n++)a=h[n],o++,a.nodeType!==p&&(e=e.concat(a.getChildren().toArray())),a._id===s._id&&(n=i);e.length>0&&e[0].getLevel()<=r&&t(e)}var e,i,n,a,r=this.getLevel(),s=this,o=0;return s.nodeType!==m&&t(s.getStage().getChildren()),o},getLevel:function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},setPosition:function(){var t=Kinetic.Util._getXY([].slice.call(arguments));return this.setX(t.x),this.setY(t.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var t=this.getAbsoluteTransform().getMatrix(),e=new Kinetic.Transform,i=this.getOffset();return e.m=t.slice(),e.translate(i.x,i.y),e.getTranslation()},setAbsolutePosition:function(){var t,e=Kinetic.Util._getXY([].slice.call(arguments)),i=this._clearTransform();return this.attrs.x=i.x,this.attrs.y=i.y,delete i.x,delete i.y,t=this.getAbsoluteTransform(),t.invert(),t.translate(e.x,e.y),e={x:this.attrs.x+t.getTranslation().x,y:this.attrs.y+t.getTranslation().y},this.setPosition(e.x,e.y),this._setTransform(i),this},_setTransform:function(t){var i;for(i in t)this.attrs[i]=t[i];this._clearCache(K),this._clearSelfAndChildrenCache(e)},_clearTransform:function(){var t={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(K),this._clearSelfAndChildrenCache(e),t},move:function(){var t=Kinetic.Util._getXY([].slice.call(arguments)),e=this.getX(),i=this.getY();return void 0!==t.x&&(e+=t.x),void 0!==t.y&&(i+=t.y),this.setPosition(e,i),this},_eachAncestorReverse:function(t,e){var i,n,a=[],r=this.getParent();for(e&&a.unshift(this);r;)a.unshift(r),r=r.parent;for(i=a.length,n=0;n<i;n++)t(a[n])},rotate:function(t){return this.setRotation(this.getRotation()+t),this},rotateDeg:function(t){return this.setRotation(this.getRotation()+Kinetic.Util._degToRad(t)),this},moveToTop:function(){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var t=this.index,e=this.parent.getChildren().length;return t<e-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)},moveDown:function(){var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)},moveToBottom:function(){var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)},setZIndex:function(t){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(t,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var t=this.getOpacity();return this.getParent()&&(t*=this.getParent().getAbsoluteOpacity()),t},moveTo:function(t){return Kinetic.Node.prototype.remove.call(this),t.add(this),this},toObject:function(){var t,e,i=Kinetic.Util,n={},a=this.getAttrs();n.attrs={};for(t in a)e=a[t],i._isFunction(e)||i._isElement(e)||i._isObject(e)&&i._hasMethods(e)||(n.attrs[t]=e);return n.className=this.getClassName(),n},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this._getCache(_,this._getStage)},_getStage:function(){var t=this.getParent();return t?t.getStage():void 0},fire:function(t,e,i){return i?this._fireAndBubble(t,e||{}):this._fire(t,e||{}),this},getAbsoluteTransform:function(){return this._getCache(e,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var t,e=new Kinetic.Transform;return this._eachAncestorReverse(function(i){t=i.getTransform(),e.multiply(t)},!0),e},_getTransform:function(){var t=new Kinetic.Transform,e=this.getX(),i=this.getY(),n=this.getRotation(),a=this.getScaleX(),r=this.getScaleY(),s=this.getSkewX(),o=this.getSkewY(),h=this.getOffsetX(),c=this.getOffsetY();return 0===e&&0===i||t.translate(e,i),0!==n&&t.rotate(n),0===s&&0===o||t.skew(s,o),1===a&&1===r||t.scale(a,r),0===h&&0===c||t.translate(-1*h,-1*c),t},clone:function(t){var e,i,n,a,r,s=this.getClassName(),o=new Kinetic[s](this.attrs);for(e in this.eventListeners)for(i=this.eventListeners[e],n=i.length,a=0;a<n;a++)r=i[a],r.name.indexOf(c)<0&&(o.eventListeners[e]||(o.eventListeners[e]=[]),o.eventListeners[e].push(r));return o.setAttrs(t),o},toDataURL:function(t){t=t||{};var e=t.mimeType||null,i=t.quality||null,n=this.getStage(),a=t.x||0,r=t.y||0,s=new Kinetic.SceneCanvas({width:t.width||n.getWidth(),height:t.height||n.getHeight(),pixelRatio:1}),o=s.getContext();return o.save(),(a||r)&&o.translate(-1*a,-1*r),this.drawScene(s),o.restore(),s.toDataURL(e,i)},toImage:function(t){Kinetic.Util._getImage(this.toDataURL(t),function(e){t.callback(e)})},setSize:function(){var t=Kinetic.Util._getSize(Array.prototype.slice.call(arguments));return this.setWidth(t.width),this.setHeight(t.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(t){return this.nodeType===t?[this]:[]},_off:function(t,e){var i,n,a=this.eventListeners[t];for(i=0;i<a.length;i++)if(n=a[i].name,!("kinetic"===n&&"kinetic"!==e||e&&n!==e)){if(a.splice(i,1),0===a.length){delete this.eventListeners[t];break}i--}},_fireBeforeChangeEvent:function(t,e,a){this._fire(i+Kinetic.Util._capitalize(t)+n,{oldVal:e,newVal:a})},_fireChangeEvent:function(t,e,i){this._fire(t+n,{oldVal:e,newVal:i})},setId:function(t){var e=this.getId();return Kinetic._removeId(e),Kinetic._addId(this,t),this._setAttr(h,t),this},setName:function(t){var e=this.getName();return Kinetic._removeName(e,this._id),Kinetic._addName(this,t),this._setAttr(f,t),this},_setAttr:function(t,e){var i;void 0!==e&&(i=this.attrs[t],this._fireBeforeChangeEvent(t,i,e),this.attrs[t]=e,this._fireChangeEvent(t,i,e))},_fireAndBubble:function(t,e,i){var n=!0;e&&this.nodeType===p&&(e.targetNode=this),t===d&&i&&this._id===i._id?n=!1:t===u&&i&&this._id===i._id&&(n=!1),
n&&(this._fire(t,e),e&&!e.cancelBubble&&this.parent&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i.parent):this._fireAndBubble.call(this.parent,t,e)))},_fire:function(t,e){var i,n,a=this.eventListeners[t];if(a)for(i=a.length,n=0;n<i;n++)a[n].handler.call(this,e)},draw:function(){return this.drawScene(),this.drawHit(),this},shouldDrawHit:function(){return this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},isDraggable:function(){return!1},getTransform:function(){return this._getCache(K,this._getTransform)}}),Kinetic.Node.create=function(t,e){return this._createNode(JSON.parse(t),e)},Kinetic.Node._createNode=function(t,e){var i,n,a,r=Kinetic.Node.prototype.getClassName.call(t),s=t.children;if(e&&(t.attrs.container=e),i=new Kinetic[r](t.attrs),s)for(n=s.length,a=0;a<n;a++)i.add(this._createNode(s[a]));return i},Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addRotationGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"scale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"skew",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"offset",0),Kinetic.Factory.addSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening",!0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible",!0),Kinetic.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){function t(t){window.setTimeout(t,1e3/60)}var e=500;Kinetic.Animation=function(t,e){this.func=t,this.setLayers(e),this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={setLayers:function(t){var e=[];e=t?t.length>0?t:[t]:[],this.layers=e},getLayers:function(){return this.layers},addLayer:function(t){var e,i,n=this.layers;if(n){for(e=n.length,i=0;i<e;i++)if(n[i]._id===t._id)return!1}else this.layers=[];return this.layers.push(t),!0},isRunning:function(){for(var t=Kinetic.Animation,e=t.animations,i=0;i<e.length;i++)if(e[i].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(t){this.animations.push(t),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(t){for(var e=t.id,i=this.animations,n=i.length,a=0;a<n;a++)if(i[a].id===e){this.animations.splice(a,1);break}},Kinetic.Animation._runFrames=function(){var t,e,i,n,a,r,s,o,h={},c=this.animations;for(n=0;n<c.length;n++){for(t=c[n],e=t.layers,i=t.func,t._updateFrameObject((new Date).getTime()),r=e.length,a=0;a<r;a++)s=e[a],void 0!==s._id&&(h[s._id]=s);i&&i.call(t,t.frame)}for(o in h)h[o].draw()},Kinetic.Animation._animationLoop=function(){var t=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){t._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var t=this;this.animRunning||(this.animRunning=!0,t._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||t}(),Kinetic.Animation.requestAnimFrame=function(e){var i=Kinetic.DD&&Kinetic.DD.isDragging?t:RAF;i(e)};var i=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(t){i.call(this,t)},Kinetic.Layer.prototype.batchDraw=function(){var t=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){t.lastBatchDrawTime&&(new Date).getTime()-t.lastBatchDrawTime>e&&t.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(t){t.batchDraw()})}}(),function(){var t={node:1,duration:1,easing:1,onFinish:1,yoyo:1},e=1,i=2,n=3,a=0;Kinetic.Tween=function(e){var i,n=this,s=e.node,o=s._id,h=e.duration||1,c=e.easing||Kinetic.Easings.Linear,l=!!e.yoyo;this.node=s,this._id=a++,this.anim=new Kinetic.Animation(function(){n.tween.onEnterFrame()},s.getLayer()||s.getLayers()),this.tween=new r(i,function(t){n._tweenFunc(t)},c,0,1,1e3*h,l),this._addListeners(),Kinetic.Tween.attrs[o]||(Kinetic.Tween.attrs[o]={}),Kinetic.Tween.attrs[o][this._id]||(Kinetic.Tween.attrs[o][this._id]={}),Kinetic.Tween.tweens[o]||(Kinetic.Tween.tweens[o]={});for(i in e)void 0===t[i]&&this._addAttr(i,e[i]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(t,e){var i,n,a,r,s,o,h,c=this.node,l=c._id;if(a=Kinetic.Tween.tweens[l][t],a&&delete Kinetic.Tween.attrs[l][a][t],i=c.getAttr(t),Kinetic.Util._isArray(e))for(e=Kinetic.Util._getPoints(e),n=[],s=e.length,r=0;r<s;r++)o=i[r],h=e[r],n.push({x:h.x-o.x,y:h.y-o.y});else n=e-i;Kinetic.Tween.attrs[l][this._id][t]={start:i,diff:n},Kinetic.Tween.tweens[l][t]=this._id},_tweenFunc:function(t){var e,i,n,a,r,s,o,h,c,l=this.node,d=Kinetic.Tween.attrs[l._id][this._id];for(e in d){if(i=d[e],n=i.start,a=i.diff,Kinetic.Util._isArray(n))for(r=[],o=n.length,s=0;s<o;s++)h=n[s],c=a[s],r.push({x:h.x+c.x*t,y:h.y+c.y*t});else r=n+a*t;l.setAttr(e,r)}},_addListeners:function(){var t=this;this.tween.onPlay=function(){t.anim.start()},this.tween.onReverse=function(){t.anim.start()},this.tween.onPause=function(){t.anim.stop()},this.tween.onFinish=function(){t.onFinish&&t.onFinish()},this.tween.onReset=function(){t.onReset&&t.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var t=this.node;return this.tween.reset(),(t.getLayer()||t.getLayers()).draw(),this},seek:function(t){var e=this.node;return this.tween.seek(1e3*t),(e.getLayer()||e.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var t=this.node;return this.tween.finish(),(t.getLayer()||t.getLayers()).draw(),this},destroy:function(){var t,e=this.node._id,i=this._id,n=Kinetic.Tween.tweens[e];this.pause();for(t in n)delete Kinetic.Tween.tweens[e][t];delete Kinetic.Tween.attrs[e][i]}};var r=function(t,e,i,n,a,r,s){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=r,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=a-this.begin,this.pause()};r.prototype={fire:function(t){var e=this[t];e&&e()},setTime:function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())},getTime:function(){return this._time},setPosition:function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t},getPosition:function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)},play:function(){this.state=i,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=n,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var t=this.getTimer()-this._startTime;this.state===i?this.setTime(t):this.state===n&&this.setTime(this.duration-t)},pause:function(){this.state=e,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(t,e,i,n,a,r){var s=1.70158;return i*(t/=n)*t*((s+1)*t-s)+e},BackEaseOut:function(t,e,i,n,a,r){var s=1.70158;return i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},BackEaseInOut:function(t,e,i,n,a,r){var s=1.70158;return(t/=n/2)<1?i/2*(t*t*(((s*=1.525)+1)*t-s))+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},ElasticEaseIn:function(t,e,i,n,a,r){var s=0;return 0===t?e:1==(t/=n)?e+i:(r||(r=.3*n),!a||a<Math.abs(i)?(a=i,s=r/4):s=r/(2*Math.PI)*Math.asin(i/a),-(a*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*(2*Math.PI)/r))+e)},ElasticEaseOut:function(t,e,i,n,a,r){var s=0;return 0===t?e:1==(t/=n)?e+i:(r||(r=.3*n),!a||a<Math.abs(i)?(a=i,s=r/4):s=r/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*t)*Math.sin((t*n-s)*(2*Math.PI)/r)+i+e)},ElasticEaseInOut:function(t,e,i,n,a,r){var s=0;return 0===t?e:2==(t/=n/2)?e+i:(r||(r=n*(.3*1.5)),!a||a<Math.abs(i)?(a=i,s=r/4):s=r/(2*Math.PI)*Math.asin(i/a),t<1?-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*(2*Math.PI)/r))+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*n-s)*(2*Math.PI)/r)*.5+i+e)},BounceEaseOut:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BounceEaseIn:function(t,e,i,n){return i-Kinetic.Easings.BounceEaseOut(n-t,0,i,n)+e},BounceEaseInOut:function(t,e,i,n){return t<n/2?.5*Kinetic.Easings.BounceEaseIn(2*t,0,i,n)+e:.5*Kinetic.Easings.BounceEaseOut(2*t-n,0,i,n)+.5*i+e},EaseIn:function(t,e,i,n){return i*(t/=n)*t+e},EaseOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},EaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},StrongEaseIn:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},StrongEaseOut:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},StrongEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},Linear:function(t,e,i,n){return i*t/n+e}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(t){var e=Kinetic.DD,i=e.node;i&&(i._setDragPosition(t),e.isDragging||(e.isDragging=!0,i.fire("dragstart",t,!0)),i.fire("dragmove",t,!0))},_endDragBefore:function(t){var e,i,n=Kinetic.DD,a=n.node;a&&(e=a.nodeType,i=a.getLayer(),n.anim.stop(),n.isDragging&&(n.isDragging=!1,Kinetic.listenClickTap=!1,t&&(t.dragEndNode=a)),delete n.node,(i||a).draw())},_endDragAfter:function(t){t=t||{};var e=t.dragEndNode;t&&e&&e.fire("dragend",t,!0)}},Kinetic.Node.prototype.startDrag=function(){var t=Kinetic.DD,e=this.getStage(),i=this.getLayer(),n=e.getPointerPosition(),a=this.getAbsolutePosition();n&&(t.node&&t.node.stopDrag(),t.node=this,t.offset.x=n.x-a.x,t.offset.y=n.y-a.y,t.anim.setLayers(i||this.getLayers()),t.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(t){var e=Kinetic.DD,i=this.getStage().getPointerPosition(),n=this.getDragBoundFunc(),a={x:i.x-e.offset.x,y:i.y-e.offset.y};void 0!==n&&(a=n.call(this,a,t)),this.setAbsolutePosition(a)},Kinetic.Node.prototype.stopDrag=function(){var t=Kinetic.DD,e={};t._endDragBefore(e),t._endDragAfter(e)},Kinetic.Node.prototype.setDraggable=function(t){this._setAttr("draggable",t),this._dragChange()};var t=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var e=Kinetic.DD;e.node&&e.node._id===this._id&&this.stopDrag(),t.call(this)},Kinetic.Node.prototype.isDragging=function(){var t=Kinetic.DD;return t.node&&t.node._id===this._id&&t.isDragging},Kinetic.Node.prototype._listenDrag=function(){var t=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(e){Kinetic.DD.node||t.startDrag(e)}):this.on("mousedown.kinetic touchstart.kinetic",function(e){Kinetic.DD.node||t.startDrag(e)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage(),e=Kinetic.DD;t&&e.node&&e.node._id===this._id&&e.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var e=document.getElementsByTagName("html")[0];e.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),e.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),e.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),e.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(t){this.children=new Kinetic.Collection,Kinetic.Node.call(this,t)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var t,e=this.children;e.length>0;)t=e[0],t.hasChildren()&&t.removeChildren(),t.remove();return this},destroyChildren:function(){for(var t=this.children;t.length>0;)t[0].destroy();return this},add:function(t){var e=this.children;return this._validateAdd(t),t.index=e.length,t.parent=this,e.push(t),this._fire("add",{child:t}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(t){var e,i,n,a,r,s,o,h=[],c=t.replace(/ /g,"").split(","),l=c.length;for(e=0;e<l;e++)if(n=c[e],"#"===n.charAt(0))r=this._getNodeById(n.slice(1)),r&&h.push(r);else if("."===n.charAt(0))a=this._getNodesByName(n.slice(1)),h=h.concat(a);else for(s=this.getChildren(),o=s.length,i=0;i<o;i++)h=h.concat(s[i]._get(n));return Kinetic.Collection.toCollection(h)},_getNodeById:function(t){var e=Kinetic.ids[t];return void 0!==e&&this.isAncestorOf(e)?e:null},_getNodesByName:function(t){var e=Kinetic.names[t]||[];return this._getDescendants(e)},_get:function(t){for(var e=Kinetic.Node.prototype._get.call(this,t),i=this.getChildren(),n=i.length,a=0;a<n;a++)e=e.concat(i[a]._get(t));return e},toObject:function(){var t=Kinetic.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),i=e.length,n=0;n<i;n++){var a=e[n];t.children.push(a.toObject())}return t},_getDescendants:function(t){for(var e=[],i=t.length,n=0;n<i;n++){var a=t[n];this.isAncestorOf(a)&&e.push(a)}return e},isAncestorOf:function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},clone:function(t){var e=Kinetic.Node.prototype.clone.call(this,t);return this.getChildren().each(function(t){e.add(t.clone())}),e},getAllIntersections:function(){for(var t=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),e=[],i=this.find("Shape"),n=i.length,a=0;a<n;a++){var r=i[a];r.isVisible()&&r.intersects(t)&&e.push(r)}return e},_setChildrenIndices:function(){this.children.each(function(t,e){t.index=e})},drawScene:function(t){var e=this.getLayer(),i=this.getClipWidth()&&this.getClipHeight();return!t&&e&&(t=e.getCanvas()),this.isVisible()&&(i?t.getContext()._clip(this):this._drawChildren(t)),this},_drawChildren:function(t){this.children.each(function(e){e.drawScene(t)})},drawHit:function(){var t,e=this.getClipWidth()&&this.getClipHeight()&&"Stage"!==this.nodeType,i=0,n=0,a=[];if(this.shouldDrawHit()){for(e&&(t=this.getLayer().hitCanvas,t.getContext()._clip(this)),a=this.children,n=a.length,i=0;i<n;i++)a[i].drawHit();e&&t.getContext()._context.restore()}return this}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addBoxGetterSetter(Kinetic.Container,"clip")}(),function(){function t(t){t.fill()}function e(t){t.stroke()}function i(t){t.fill()}function n(t){t.stroke()}function a(){this._clearCache(r)}var r="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(r){this.nodeType="Shape",this._fillFunc=t,this._strokeFunc=e,this._fillFuncHit=i,this._strokeFuncHit=n;for(var s,o=Kinetic.shapes;;)if(s=Kinetic.Util.getRandomColor(),s&&!(s in o))break;this.colorKey=s,o[s]=this,Kinetic.Node.call(this,r),this._setDrawFuncs(),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic",a)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(r,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!(!this.getStroke()&&!this.getStrokeWidth())},_get:function(t){return this.className===t||this.nodeType===t?[this]:[]},intersects:function(){var t,e=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),i=this.getStage(),n=i.bufferHitCanvas;return n.getContext().clear(),this.drawScene(n),t=n.context.getImageData(0|e.x,0|e.y,1,1).data,t[3]>0},enableFill:function(){return this._setAttr("fillEnabled",!0),this},disableFill:function(){return this._setAttr("fillEnabled",!1),this},enableStroke:function(){return this._setAttr("strokeEnabled",!0),this},disableStroke:function(){return this._setAttr("strokeEnabled",!1),this},enableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!0),this},disableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!1),this},enableShadow:function(){return this._setAttr("shadowEnabled",!0),this},disableShadow:function(){return this._setAttr("shadowEnabled",!1),this},enableDashArray:function(){return this._setAttr("dashArrayEnabled",!0),this},disableDashArray:function(){return this._setAttr("dashArrayEnabled",!1),this},destroy:function(){return Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey],this},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(t){var e,i,n,a=t||this.getLayer().getCanvas(),r=a.getContext(),s=this.getDrawFunc(),o=this.hasShadow();return s&&this.isVisible()&&(this._useBufferCanvas()?(e=this.getStage(),i=e.bufferCanvas,n=i.getContext(),n.clear(),n.save(),n._applyLineJoin(this),n._applyAncestorTransforms(this),s.call(this,n),n.restore(),r.save(),o&&(r.save(),r._applyShadow(this),r.drawImage(i._canvas,0,0),r.restore()),r._applyOpacity(this),r.drawImage(i._canvas,0,0),r.restore()):(r.save(),r._applyLineJoin(this),r._applyAncestorTransforms(this),o&&(r.save(),r._applyShadow(this),s.call(this,r),r.restore()),r._applyOpacity(this),s.call(this,r),r.restore())),this},drawHit:function(){var t=this.getAttrs(),e=t.drawHitFunc||t.drawFunc,i=this.getLayer().hitCanvas,n=i.getContext();return e&&this.shouldDrawHit()&&(n.save(),n._applyLineJoin(this),n._applyAncestorTransforms(this),e.call(this,n),n.restore()),this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternScale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"shadowOffset",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function t(t,e){t.content.addEventListener(e,function(i){t[R+e](i)},!1)}var e="Stage",i="string",n="px",a="mouseout",r="mouseleave",s="mouseover",o="mouseenter",h="mousemove",c="mousedown",l="mouseup",d="click",u="dblclick",f="touchstart",g="touchend",p="tap",v="dbltap",_="touchmove",K="contentMouseout",m="contentMouseover",y="contentMousemove",S="contentMousedown",x="contentMouseup",C="contentClick",w="contentDblclick",b="contentTouchstart",P="contentTouchend",T="contentDbltap",F="contentTouchmove",A="div",k="relative",D="inline-block",L="kineticjs-content",G=" ",R="_",I="container",M="",U=[c,h,l,a,f,_,g,s],N=U.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(t){this.nodeType=e,Kinetic.Container.call(this,t),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.stages.push(this)},_validateAdd:function(t){"Layer"!==t.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(t){return typeof t===i&&(t=document.getElementById(t)),this._setAttr(I,t),this},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(t){return Kinetic.Node.prototype.setHeight.call(this,t),this._resizeDOM(),this},setWidth:function(t){return Kinetic.Node.prototype.setWidth.call(this,t),this._resizeDOM(),this},clear:function(){var t,e=this.children,i=e.length;for(t=0;t<i;t++)e[t].clear();return this},destroy:function(){var t=this.content;Kinetic.Container.prototype.destroy.call(this),t&&Kinetic.Util._isInDocument(t)&&this.getContainer().removeChild(t)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(t){function e(a){var r=h[a],c=r.toDataURL(),l=new Image;l.onload=function(){o.drawImage(l,0,0),a<h.length-1?e(a+1):t.callback(s.toDataURL(i,n))},l.src=c}t=t||{};var i=t.mimeType||null,n=t.quality||null,a=t.x||0,r=t.y||0,s=new Kinetic.SceneCanvas({width:t.width||this.getWidth(),height:t.height||this.getHeight(),pixelRatio:1}),o=s.getContext()._context,h=this.children;(a||r)&&o.translate(-1*a,-1*r),e(0)},toImage:function(t){var e=t.callback;t.callback=function(t){Kinetic.Util._getImage(t,function(t){e(t)})},this.toDataURL(t)},getIntersection:function(){var t,e,i=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),n=this.getChildren(),a=n.length,r=a-1;for(t=r;t>=0;t--)if(e=n[t].getIntersection(i))return e;return null},_resizeDOM:function(){if(this.content){var t,e,i=this.getWidth(),a=this.getHeight(),r=this.getChildren(),s=r.length;for(this.content.style.width=i+n,this.content.style.height=a+n,this.bufferCanvas.setSize(i,a),this.bufferHitCanvas.setSize(i,a),t=0;t<s;t++)e=r[t],e.getCanvas().setSize(i,a),e.hitCanvas.setSize(i,a),e.draw()}},add:function(t){return Kinetic.Container.prototype.add.call(this,t),t.canvas.setSize(this.attrs.width,this.attrs.height),t.hitCanvas.setSize(this.attrs.width,this.attrs.height),t.draw(),this.content.appendChild(t.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(t){t||(t=window.event),this._setMousePosition(t),this._setTouchPosition(t)},_bindContentEvents:function(){var e;for(e=0;e<N;e++)t(this,U[e])},_mouseover:function(t){this._fire(m,t)},_mouseout:function(t){this._setPointerPosition(t);var e=this.targetShape;e&&!Kinetic.isDragging()&&(e._fireAndBubble(a,t),e._fireAndBubble(r,t),this.targetShape=null),this.mousePos=void 0,this._fire(K,t)},_mousemove:function(t){this._setPointerPosition(t);var e=Kinetic.DD,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:void 0;n?Kinetic.isDragging()||255!==i.pixel[3]||this.targetShape&&this.targetShape._id===n._id?n._fireAndBubble(h,t):(this.targetShape&&(this.targetShape._fireAndBubble(a,t,n),this.targetShape._fireAndBubble(r,t,n)),n._fireAndBubble(s,t,this.targetShape),n._fireAndBubble(o,t,this.targetShape),this.targetShape=n):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(a,t),this.targetShape._fireAndBubble(r,t),this.targetShape=null),this._fire(y,t),e&&e._drag(t),t.preventDefault&&t.preventDefault()},_mousedown:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:void 0;Kinetic.listenClickTap=!0,i&&(this.clickStartShape=i,i._fireAndBubble(c,t)),this._fire(S),t.preventDefault&&t.preventDefault()},_mouseup:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:void 0,n=!1;Kinetic.inDblClickWindow?(n=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),i&&(i._fireAndBubble(l,t),Kinetic.listenClickTap&&i._id===this.clickStartShape._id&&(i._fireAndBubble(d,t),n&&i._fireAndBubble(u,t))),this._fire(x),Kinetic.listenClickTap&&(this._fire(C,t),n&&this._fire(w,t)),Kinetic.listenClickTap=!1,t.preventDefault&&t.preventDefault()},_touchstart:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:void 0;Kinetic.listenClickTap=!0,i&&(this.tapStartShape=i,i._fireAndBubble(f,t),i.isListening()&&t.preventDefault&&t.preventDefault()),this._fire(b,t)},_touchend:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:void 0,n=!1;Kinetic.inDblClickWindow?(n=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),i&&(i._fireAndBubble(g,t),Kinetic.listenClickTap&&i._id===this.tapStartShape._id&&(i._fireAndBubble(p,t),n&&i._fireAndBubble(v,t)),i.isListening()&&t.preventDefault&&t.preventDefault()),Kinetic.listenClickTap&&(this._fire(P,t),n&&this._fire(T,t)),Kinetic.listenClickTap=!1},_touchmove:function(t){this._setPointerPosition(t);var e=Kinetic.DD,i=this.getIntersection(this.getPointerPosition()),n=i&&i.shape?i.shape:void 0;n&&(n._fireAndBubble(_,t),n.isListening()&&t.preventDefault&&t.preventDefault()),this._fire(F,t),e&&e._drag(t)},_setMousePosition:function(t){var e=this._getContentPosition(),i=t.offsetX,n=t.clientX,a=0,r=0;void 0!==i?(a=i,r=t.offsetY):"mozilla"===Kinetic.UA.browser?(a=t.layerX,r=t.layerY):void 0!==n&&e&&(a=n-e.left,r=t.clientY-e.top),this.mousePos={x:a,y:r}},_setTouchPosition:function(t){var e,i,n,a=this._getContentPosition();void 0!==t.touches&&1===t.touches.length&&(e=t.touches[0],i=e.clientX-a.left,n=e.clientY-a.top,this.touchPos={x:i,y:n})},_getContentPosition:function(){var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left}},_buildDOM:function(){var t=this.getContainer();t.innerHTML=M,this.content=document.createElement(A),this.content.style.position=k,this.content.style.display=D,this.content.className=L,t.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(t,e){var i,n,a=t.split(G),r=a.length;for(i=0;i<r;i++)n=a[i],this.content.addEventListener(n,e,!1)}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container")}(),function(){var t="#",e="beforeDraw",i="draw";Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(t){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,t)},_validateAdd:function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(){var e,i,n,a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments));if(this.isVisible()&&this.isListening()){if(e=this.hitCanvas.context._context.getImageData(0|a.x,0|a.y,1,1).data,255===e[3])return i=Kinetic.Util._rgbToHex(e[0],e[1],e[2]),n=Kinetic.shapes[t+i],{shape:n,pixel:e};if(e[0]>0||e[1]>0||e[2]>0||e[3]>0)return{pixel:e}}return null},drawScene:function(t){return t=t||this.getCanvas(),this._fire(e,{node:this}),this.getClearBeforeDraw()&&t.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,t),this._fire(i,{node:this}),this},drawHit:function(){var t=this.getLayer();return t&&t.getClearBeforeDraw()&&t.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){var t=this.getContext(),e=this.getHitCanvas().getContext();return t.clear.apply(t,arguments),e.clear.apply(e,arguments),this},setVisible:function(t){return Kinetic.Node.prototype.setVisible.call(this,t),t?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(t){Kinetic.Node.prototype.setZIndex.call(this,t);var e=this.getStage();return e&&(e.content.removeChild(this.getCanvas()._canvas),t<e.getChildren().length-1?e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[t+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var t=this.getStage();t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var t=this.getStage();t&&(t.content.removeChild(this.getCanvas()._canvas),this.index<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){
var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var t=this.getStage(),e=this.getCanvas(),i=e._canvas;return Kinetic.Node.prototype.remove.call(this),t&&i&&Kinetic.Util._isInDocument(i)&&t.content.removeChild(i),this},getStage:function(){return this.parent}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(t){this.nodeType="Group",Kinetic.Container.call(this,t)},_validateAdd:function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(t){this.___init(t)},Kinetic.Rect.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Rect"},drawFunc:function(t){var e=this.getCornerRadius(),i=this.getWidth(),n=this.getHeight();t.beginPath(),e?(t.moveTo(e,0),t.lineTo(i-e,0),t.arc(i-e,e,e,3*Math.PI/2,0,!1),t.lineTo(i,n-e),t.arc(i-e,n-e,e,0,Math.PI/2,!1),t.lineTo(e,n),t.arc(e,n-e,e,Math.PI/2,Math.PI,!1),t.lineTo(0,e),t.arc(e,e,e,Math.PI,3*Math.PI/2,!1)):t.rect(0,0,i,n),t.closePath(),t.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){var t=2*Math.PI-1e-4,e="Circle";Kinetic.Circle=function(t){this.___init(t)},Kinetic.Circle.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e},drawFunc:function(e){e.beginPath(),e.arc(0,0,this.getRadius(),0,t,!1),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this.setRadius(t/2)},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this.setRadius(t/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){var t=2*Math.PI-1e-4,e="Ellipse";Kinetic.Ellipse=function(t){this.___init(t)},Kinetic.Ellipse.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e},drawFunc:function(e){var i=this.getRadius();e.beginPath(),e.save(),i.x!==i.y&&e.scale(1,i.y/i.x),e.arc(0,0,i.x,0,t,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this.setRadius({x:t/2})},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this.setRadius({y:t/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addPointGetterSetter(Kinetic.Ellipse,"radius",0)}(),function(){Kinetic.Wedge=function(t){this.___init(t)},Kinetic.Wedge.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Wedge"},drawFunc:function(t){t.beginPath(),t.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){var t="Image",e="set";Kinetic.Image=function(t){this.___init(t)},Kinetic.Image.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},drawFunc:function(t){var e,i,n,a=this.getWidth(),r=this.getHeight();this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1),this.filterCanvas?(n=this.filterCanvas._canvas,i=[n,0,0,a,r]):(n=this.getImage(),n&&(e=this.getCrop(),e?(e.x=e.x||0,e.y=e.y||0,e.width=e.width||n.width-e.x,e.height=e.height||n.height-e.y,i=[n,e.x,e.y,e.width,e.height,0,0,a,r]):i=[n,0,0,a,r])),t.beginPath(),t.rect(0,0,a,r),t.closePath(),t.fillStrokeShape(this),n&&t.drawImage.apply(t,i)},drawHitFunc:function(t){var e=this.getWidth(),i=this.getHeight(),n=this.imageHitRegion;n?(t.drawImage(n,0,0,e,i),t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.strokeShape(this)):(t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this))},applyFilter:function(){var t,e,i,n=this.getImage(),a=(this.getWidth(),this.getHeight(),this.getFilter()),r=this.getCrop()||{};r.x=r.x||0,r.y=r.y||0,r.width=r.width||n.width-r.x,r.height=r.height||n.height-r.y,this.filterCanvas&&this.filterCanvas.getWidth()===r.width&&this.filterCanvas.getHeight()===r.height?(t=this.filterCanvas,t.getContext().clear()):t=this.filterCanvas=new Kinetic.SceneCanvas({width:r.width,height:r.height,pixelRatio:1}),e=t.getContext();try{e.drawImage(n,r.x,r.y,r.width,r.height,0,0,r.width,r.height),i=e.getImageData(0,0,r.width,r.height),a.call(this,i),e.putImageData(i,0,0)}catch(s){this.clearFilter(),Kinetic.Util.warn("Unable to apply filter. "+s.message)}},clearFilter:function(){this.filterCanvas=null,this._applyFilter=!1},createImageHitRegion:function(t){var e,i,n,a,r,s=this,o=this.getWidth(),h=this.getHeight(),c=new Kinetic.SceneCanvas({width:o,height:h}),l=c.getContext()._context,d=this.getImage();l.drawImage(d,0,0);try{for(e=l.getImageData(0,0,o,h),i=e.data,r=i.length,n=Kinetic.Util._hexToRgb(this.colorKey),a=0;a<r;a+=4)i[a+3]>0&&(i[a]=n.r,i[a+1]=n.g,i[a+2]=n.b);Kinetic.Util._getImage(e,function(e){s.imageHitRegion=e,t&&t()})}catch(u){Kinetic.Util.warn("Unable to create image hit region. "+u.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var t=this.getImage();return this.attrs.width||(t?t.width:0)},getHeight:function(){var t=this.getImage();return this.attrs.height||(t?t.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addFilterGetterSetter=function(t,e,i){this.addGetter(t,e,i),this.addFilterSetter(t,e)},Kinetic.Factory.addFilterSetter=function(t,i){var n=e+Kinetic.Util._capitalize(i);t.prototype[n]=function(t){this._setAttr(i,t),this._applyFilter=!0}},Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addBoxGetterSetter(Kinetic.Image,"crop"),Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filter")}(),function(){Kinetic.Polygon=function(t){this.___init(t)},Kinetic.Polygon.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Polygon"},drawFunc:function(t){var e=this.getPoints(),i=e.length;t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<i;n++)t.lineTo(e[n].x,e[n].y);t.closePath(),t.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Polygon,"points")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="auto",n="Calibri",a="canvas",r="center",s="Change.kinetic",o="2d",h="-",c="",l="left",d="text",u="Text",f="middle",g="normal",p="px ",v=" ",_="right",K="word",m="char",y="none",S=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],x=S.length,C=document.createElement(a).getContext(o);Kinetic.Text=function(t){this.___init(t)},Kinetic.Text.prototype={___init:function(n){var a=this;void 0===n.width&&(n.width=i),void 0===n.height&&(n.height=i),Kinetic.Shape.call(this,n),this._fillFunc=t,this._strokeFunc=e,this.className=u;for(var r=0;r<x;r++)this.on(S[r]+s,a._setTextData);this._setTextData()},drawFunc:function(t){var e=this.getPadding(),i=(this.getFontStyle(),this.getFontSize(),this.getFontFamily(),this.getTextHeight()),n=this.getLineHeight()*i,a=this.textArr,s=a.length,o=this.getWidth();t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",f),t.setAttr("textAlign",l),t.save(),t.translate(e,0),t.translate(0,e+i/2);for(var h=0;h<s;h++){var c=a[h],d=c.text,u=c.width;t.save(),this.getAlign()===_?t.translate(o-u-2*e,0):this.getAlign()===r&&t.translate((o-u-2*e)/2,0),this.partialText=d,t.fillStrokeShape(this),t.restore(),t.translate(0,n)}t.restore()},drawHitFunc:function(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)},setText:function(t){var e=Kinetic.Util._isString(t)?t:t.toString();this._setAttr(d,e)},getWidth:function(){return this.attrs.width===i?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===i?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(t){var e,i=C,n=this.getFontSize();return i.save(),i.font=this._getContextFont(),e=i.measureText(t),i.restore(),{width:e.width,height:parseInt(n,10)}},_getContextFont:function(){return this.getFontStyle()+v+this.getFontSize()+p+this.getFontFamily()},_addTextLine:function(t,e,i){return this.textArr.push({text:t,width:e})},_getTextWidth:function(t){return C.measureText(t).width},_setTextData:function(){var t=this.getText().split("\n"),e=+this.getFontSize(),n=0,a=this.getLineHeight()*e,r=this.attrs.width,s=this.attrs.height,o=r!==i,c=s!==i,l=this.getPadding(),d=r-2*l,u=s-2*l,f=0,g=this.getWrap(),_=g!==y,K=g!==m&&_;this.textArr=[],C.save(),C.font=this.getFontStyle()+v+e+p+this.getFontFamily();for(var S=0,x=t.length;S<x;++S){var w=t[S],b=this._getTextWidth(w);if(o&&b>d)for(;w.length>0;){for(var P=0,T=w.length,F="",A=0;P<T;){var k=P+T>>>1,D=w.slice(0,k+1),L=this._getTextWidth(D);L<=d?(P=k+1,F=D,A=L):T=k}if(!F)break;if(K){var G=Math.max(F.lastIndexOf(v),F.lastIndexOf(h))+1;G>0&&(P=G,F=F.slice(0,P),A=this._getTextWidth(F))}if(this._addTextLine(F,A),f+=a,!_||c&&f+a>u)break;if(w=w.slice(P),w.length>0&&(b=this._getTextWidth(w),b<=d)){this._addTextLine(w,b),f+=a;break}}else this._addTextLine(w,b),f+=a,n=Math.max(n,b);if(c&&f+a>u)break}C.restore(),this.textHeight=e,this.textWidth=n}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily",n),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",g),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",l),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",K),Kinetic.Factory.addGetter(Kinetic.Text,d,c),Kinetic.Factory.addSetter(Kinetic.Text,"width"),Kinetic.Factory.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(t){this.___init(t)},Kinetic.Line.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Line"},drawFunc:function(t){var e,i,n=this.getPoints(),a=n.length;for(t.beginPath(),t.moveTo(n[0].x,n[0].y),e=1;e<a;e++)i=n[e],t.lineTo(i.x,i.y);t.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Line,"points")}(),function(){Kinetic.Spline=function(t){this.___init(t)},Kinetic.Spline.prototype={___init:function(t){var e=this;Kinetic.Shape.call(this,t),this.className="Spline",this.on("pointsChange.kinetic tensionChange.kinetic",function(){e._setAllPoints()}),this._setAllPoints()},drawFunc:function(t){var e,i,n,a,r=this.getPoints(),s=r.length,o=this.getTension();if(t.beginPath(),t.moveTo(r[0].x,r[0].y),0!==o&&s>2){for(e=this.allPoints,i=e.length,n=2,t.quadraticCurveTo(e[0].x,e[0].y,e[1].x,e[1].y);n<i-1;)t.bezierCurveTo(e[n].x,e[n++].y,e[n].x,e[n++].y,e[n].x,e[n++].y);t.quadraticCurveTo(e[i-1].x,e[i-1].y,r[s-1].x,r[s-1].y)}else for(n=1;n<s;n++)a=r[n],t.lineTo(a.x,a.y);t.strokeShape(this)},_setAllPoints:function(){this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},Kinetic.Util.extend(Kinetic.Spline,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Spline,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Spline,"points")}(),function(){Kinetic.Blob=function(t){this.___init(t)},Kinetic.Blob.prototype={___init:function(t){var e=this;Kinetic.Shape.call(this,t),this.className="Blob",this.on("pointsChange.kinetic tensionChange.kinetic",function(){e._setAllPoints()}),this._setAllPoints()},drawFunc:function(t){var e,i,n,a,r=this.getPoints(),s=r.length,o=this.getTension();if(t.beginPath(),t.moveTo(r[0].x,r[0].y),0!==o&&s>2)for(e=this.allPoints,i=e.length,n=0;n<i-1;)t.bezierCurveTo(e[n].x,e[n++].y,e[n].x,e[n++].y,e[n].x,e[n++].y);else for(n=1;n<s;n++)a=r[n],t.lineTo(a.x,a.y);t.closePath(),t.fillStrokeShape(this)},_setAllPoints:function(){var t=this.getPoints(),e=t.length,i=this.getTension(),n=Kinetic.Util,a=n._getControlPoints(t[e-1],t[0],t[1],i),r=n._getControlPoints(t[e-2],t[e-1],t[0],i);this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension()),this.allPoints.unshift(a[1]),this.allPoints.push(r[0]),this.allPoints.push(t[e-1]),this.allPoints.push(r[1]),this.allPoints.push(a[0]),this.allPoints.push(t[0])}},Kinetic.Util.extend(Kinetic.Blob,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Blob,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Blob,"points")}(),function(){Kinetic.Sprite=function(t){this.___init(t)},Kinetic.Sprite.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Sprite",this.anim=new Kinetic.Animation;var e=this;this.on("animationChange.kinetic",function(){e.setIndex(0)})},drawFunc:function(t){var e=this.getAnimation(),i=this.getIndex(),n=this.getAnimations()[e][i],a=this.getImage();a&&t.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},drawHitFunc:function(t){var e=this.getAnimation(),i=this.getIndex(),n=this.getAnimations()[e][i];t.beginPath(),t.rect(0,0,n.width,n.height),t.closePath(),t.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var t=this,e=this.getLayer();this.anim.setLayers(e),this.interval=setInterval(function(){var e=t.getIndex();t._updateIndex(),t.afterFrameFunc&&e===t.afterFrameIndex&&(t.afterFrameFunc(),delete t.afterFrameFunc,delete t.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(t,e){this.afterFrameIndex=t,this.afterFrameFunc=e},_updateIndex:function(){var t=this.getIndex(),e=this.getAnimation(),i=this.getAnimations(),n=i[e],a=n.length;t<a-1?this.setIndex(t+1):this.setIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(t){this.___init(t)},Kinetic.Path.prototype={___init:function(t){this.dataArray=[];var e=this;Kinetic.Shape.call(this,t),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){e.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(t){var e=this.dataArray,i=!1;t.beginPath();for(var n=0;n<e.length;n++){var a=e[n].command,r=e[n].points;switch(a){case"L":t.lineTo(r[0],r[1]);break;case"M":t.moveTo(r[0],r[1]);break;case"C":t.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);break;case"Q":t.quadraticCurveTo(r[0],r[1],r[2],r[3]);break;case"A":var s=r[0],o=r[1],h=r[2],c=r[3],l=r[4],d=r[5],u=r[6],f=r[7],g=h>c?h:c,p=h>c?1:h/c,v=h>c?c/h:1;t.translate(s,o),t.rotate(u),t.scale(p,v),t.arc(0,0,g,l,l+d,1-f),t.scale(1/p,1/v),t.rotate(-u),t.translate(-s,-o);break;case"z":t.closePath(),i=!0}}i?t.fillStrokeShape(this):t.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},Kinetic.Path.getPointOnLine=function(t,e,i,n,a,r,s){void 0===r&&(r=e),void 0===s&&(s=i);var o=(a-i)/(n-e+1e-8),h=Math.sqrt(t*t/(1+o*o));n<e&&(h*=-1);var c,l=o*h;if(n===e)c={x:r,y:s+l};else if((s-i)/(r-e+1e-8)===o)c={x:r+h,y:s+l};else{var d,u,f=this.getLineLength(e,i,n,a);if(f<1e-8)return;var g=(r-e)*(n-e)+(s-i)*(a-i);g/=f*f,d=e+g*(n-e),u=i+g*(a-i);var p=this.getLineLength(r,s,d,u),v=Math.sqrt(t*t-p*p);h=Math.sqrt(v*v/(1+o*o)),n<e&&(h*=-1),l=o*h,c={x:d+h,y:u+l}}return c},Kinetic.Path.getPointOnCubicBezier=function(t,e,i,n,a,r,s,o,h){function c(t){return t*t*t}function l(t){return 3*t*t*(1-t)}function d(t){return 3*t*(1-t)*(1-t)}function u(t){return(1-t)*(1-t)*(1-t)}var f=o*c(t)+r*l(t)+n*d(t)+e*u(t),g=h*c(t)+s*l(t)+a*d(t)+i*u(t);return{x:f,y:g}},Kinetic.Path.getPointOnQuadraticBezier=function(t,e,i,n,a,r,s){function o(t){return t*t}function h(t){return 2*t*(1-t)}function c(t){return(1-t)*(1-t)}var l=r*o(t)+n*h(t)+e*c(t),d=s*o(t)+a*h(t)+i*c(t);return{x:l,y:d}},Kinetic.Path.getPointOnEllipticalArc=function(t,e,i,n,a,r){var s=Math.cos(r),o=Math.sin(r),h={x:i*Math.cos(a),y:n*Math.sin(a)};return{x:t+(h.x*s-h.y*o),y:e+(h.x*o+h.y*s)}},Kinetic.Path.parsePathData=function(t){if(!t)return[];var e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<i.length;n++)e=e.replace(new RegExp(i[n],"g"),"|"+i[n]);var a=e.split("|"),r=[],s=0,o=0;for(n=1;n<a.length;n++){var h=a[n],c=h.charAt(0);h=h.slice(1),h=h.replace(new RegExp(",-","g"),"-"),h=h.replace(new RegExp("-","g"),",-"),h=h.replace(new RegExp("e,-","g"),"e-");var l=h.split(",");l.length>0&&""===l[0]&&l.shift();for(var d=0;d<l.length;d++)l[d]=parseFloat(l[d]);for(;l.length>0&&!isNaN(l[0]);){var u,f,g,p,v,_,K,m,y,S,x=null,C=[],w=s,b=o;switch(c){case"l":s+=l.shift(),o+=l.shift(),x="L",C.push(s,o);break;case"L":s=l.shift(),o=l.shift(),C.push(s,o);break;case"m":s+=l.shift(),o+=l.shift(),x="M",C.push(s,o),c="l";break;case"M":s=l.shift(),o=l.shift(),x="M",C.push(s,o),c="L";break;case"h":s+=l.shift(),x="L",C.push(s,o);break;case"H":s=l.shift(),x="L",C.push(s,o);break;case"v":o+=l.shift(),x="L",C.push(s,o);break;case"V":o=l.shift(),x="L",C.push(s,o);break;case"C":C.push(l.shift(),l.shift(),l.shift(),l.shift()),s=l.shift(),o=l.shift(),C.push(s,o);break;case"c":C.push(s+l.shift(),o+l.shift(),s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),x="C",C.push(s,o);break;case"S":f=s,g=o,u=r[r.length-1],"C"===u.command&&(f=s+(s-u.points[2]),g=o+(o-u.points[3])),C.push(f,g,l.shift(),l.shift()),s=l.shift(),o=l.shift(),x="C",C.push(s,o);break;case"s":f=s,g=o,u=r[r.length-1],"C"===u.command&&(f=s+(s-u.points[2]),g=o+(o-u.points[3])),C.push(f,g,s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),x="C",C.push(s,o);break;case"Q":C.push(l.shift(),l.shift()),s=l.shift(),o=l.shift(),C.push(s,o);break;case"q":C.push(s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),x="Q",C.push(s,o);break;case"T":f=s,g=o,u=r[r.length-1],"Q"===u.command&&(f=s+(s-u.points[0]),g=o+(o-u.points[1])),s=l.shift(),o=l.shift(),x="Q",C.push(f,g,s,o);break;case"t":f=s,g=o,u=r[r.length-1],"Q"===u.command&&(f=s+(s-u.points[0]),g=o+(o-u.points[1])),s+=l.shift(),o+=l.shift(),x="Q",C.push(f,g,s,o);break;case"A":p=l.shift(),v=l.shift(),_=l.shift(),K=l.shift(),m=l.shift(),y=s,S=o,s=l.shift(),o=l.shift(),x="A",C=this.convertEndpointToCenterParameterization(y,S,s,o,K,m,p,v,_);break;case"a":p=l.shift(),v=l.shift(),_=l.shift(),K=l.shift(),m=l.shift(),y=s,S=o,s+=l.shift(),o+=l.shift(),x="A",C=this.convertEndpointToCenterParameterization(y,S,s,o,K,m,p,v,_)}r.push({command:x||c,points:C,start:{x:w,y:b},pathLength:this.calcLength(w,b,x||c,C)})}"z"!==c&&"Z"!==c||r.push({command:"z",points:[],start:void 0,pathLength:0})}return r},Kinetic.Path.calcLength=function(e,i,n,a){var r,s,o,h=Kinetic.Path;switch(n){case"L":return h.getLineLength(e,i,a[0],a[1]);case"C":for(r=0,s=h.getPointOnCubicBezier(0,e,i,a[0],a[1],a[2],a[3],a[4],a[5]),t=.01;t<=1;t+=.01)o=h.getPointOnCubicBezier(t,e,i,a[0],a[1],a[2],a[3],a[4],a[5]),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return r;case"Q":for(r=0,s=h.getPointOnQuadraticBezier(0,e,i,a[0],a[1],a[2],a[3]),t=.01;t<=1;t+=.01)o=h.getPointOnQuadraticBezier(t,e,i,a[0],a[1],a[2],a[3]),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return r;case"A":r=0;var c=a[4],l=a[5],d=a[4]+l,u=Math.PI/180;if(Math.abs(c-d)<u&&(u=Math.abs(c-d)),s=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],c,0),l<0)for(t=c-u;t>d;t-=u)o=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],t,0),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;else for(t=c+u;t<d;t+=u)o=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],t,0),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return o=h.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],d,0),r+=h.getLineLength(s.x,s.y,o.x,o.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(t,e,i,n,a,r,s,o,h){var c=h*(Math.PI/180),l=Math.cos(c)*(t-i)/2+Math.sin(c)*(e-n)/2,d=-1*Math.sin(c)*(t-i)/2+Math.cos(c)*(e-n)/2,u=l*l/(s*s)+d*d/(o*o);u>1&&(s*=Math.sqrt(u),o*=Math.sqrt(u));var f=Math.sqrt((s*s*(o*o)-s*s*(d*d)-o*o*(l*l))/(s*s*(d*d)+o*o*(l*l)));a==r&&(f*=-1),isNaN(f)&&(f=0);var g=f*s*d/o,p=f*-o*l/s,v=(t+i)/2+Math.cos(c)*g-Math.sin(c)*p,_=(e+n)/2+Math.sin(c)*g+Math.cos(c)*p,K=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},m=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(K(t)*K(e))},y=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(m(t,e))},S=y([1,0],[(l-g)/s,(d-p)/o]),x=[(l-g)/s,(d-p)/o],C=[(-1*l-g)/s,(-1*d-p)/o],w=y(x,C);return m(x,C)<=-1&&(w=Math.PI),m(x,C)>=1&&(w=0),0===r&&w>0&&(w-=2*Math.PI),1==r&&w<0&&(w+=2*Math.PI),[v,_,s,o,S,w,c,r]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="",n="Calibri",a="normal";Kinetic.TextPath=function(t){this.___init(t)},Kinetic.TextPath.prototype={___init:function(i){var n=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,i),this._fillFunc=t,this._strokeFunc=e,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){n.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",n._setTextData),n._setTextData()},drawFunc:function(t){this.charArr;t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline","middle"),t.setAttr("textAlign","left"),t.save();for(var e=this.glyphInfo,i=0;i<e.length;i++){t.save();var n=e[i].p0;e[i].p1,parseFloat(this.attrs.fontSize);t.translate(n.x,n.y),t.rotate(e[i].rotation),this.partialText=e[i].text,t.fillStrokeShape(this),t.restore()}t.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(t){Kinetic.Text.prototype.setText.call(this,t)},_getTextSize:function(t){var e=this.dummyCanvas,i=e.getContext("2d");i.save(),i.font=this._getContextFont();var n=i.measureText(t);return i.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var t=this,e=this._getTextSize(this.attrs.text);this.textWidth=e.width,this.textHeight=e.height,this.glyphInfo=[];for(var i,n,a,r=this.attrs.text.split(""),s=-1,o=0,h=function(){o=0;for(var e=t.dataArray,n=s+1;n<e.length;n++){if(e[n].pathLength>0)return s=n,e[n];"M"==e[n].command&&(i={x:e[n].points[0],y:e[n].points[1]})}return{}},c=function(e,r){var s=t._getTextSize(e).width,c=0,l=0;for(n=void 0;Math.abs(s-c)/s>.01&&l<25;){l++;for(var d=c;void 0===a;)a=h(),a&&d+a.pathLength<s&&(d+=a.pathLength,a=void 0);if(a==={}||void 0===i)return;var u=!1;switch(a.command){case"L":Kinetic.Path.getLineLength(i.x,i.y,a.points[0],a.points[1])>s?n=Kinetic.Path.getPointOnLine(s,i.x,i.y,a.points[0],a.points[1],i.x,i.y):a=void 0;break;case"A":var f=a.points[4],g=a.points[5],p=a.points[4]+g;0===o?o=f+1e-8:s>c?o+=Math.PI/180*g/Math.abs(g):o-=Math.PI/360*g/Math.abs(g),(g<0&&o<p||g>=0&&o>p)&&(o=p,u=!0),n=Kinetic.Path.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],o,a.points[6]);break;case"C":0===o?o=s>a.pathLength?1e-8:s/a.pathLength:s>c?o+=(s-c)/a.pathLength:o-=(c-s)/a.pathLength,o>1&&(o=1,u=!0),n=Kinetic.Path.getPointOnCubicBezier(o,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case"Q":0===o?o=s/a.pathLength:s>c?o+=(s-c)/a.pathLength:o-=(c-s)/a.pathLength,o>1&&(o=1,u=!0),n=Kinetic.Path.getPointOnQuadraticBezier(o,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3])}void 0!==n&&(c=Kinetic.Path.getLineLength(i.x,i.y,n.x,n.y)),u&&(u=!1,a=void 0)}},l=0;l<r.length&&(c(r[l]),void 0!==i&&void 0!==n);l++){var d=Kinetic.Path.getLineLength(i.x,i.y,n.x,n.y),u=0,f=Kinetic.Path.getPointOnLine(u+d/2,i.x,i.y,n.x,n.y),g=Math.atan2(n.y-i.y,n.x-i.x);this.glyphInfo.push({transposeX:f.x,transposeY:f.y,text:r[l],rotation:g,p0:i,p1:n}),i=n}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily",n),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",a),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",i)}(),function(){Kinetic.RegularPolygon=function(t){this.___init(t)},Kinetic.RegularPolygon.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="RegularPolygon"},drawFunc:function(t){var e,i,n,a=this.attrs.sides,r=this.attrs.radius;for(t.beginPath(),t.moveTo(0,0-r),e=1;e<a;e++)i=r*Math.sin(2*e*Math.PI/a),n=-1*r*Math.cos(2*e*Math.PI/a),t.lineTo(i,n);t.closePath(),t.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(t){this.___init(t)},Kinetic.Star.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Star"},drawFunc:function(t){var e=t._context,i=this.attrs.innerRadius,n=this.attrs.outerRadius,a=this.attrs.numPoints;e.beginPath(),e.moveTo(0,0-this.attrs.outerRadius);for(var r=1;r<2*a;r++){var s=r%2===0?n:i,o=s*Math.sin(r*Math.PI/a),h=-1*s*Math.cos(r*Math.PI/a);e.lineTo(o,h)}e.closePath(),t.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var t=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],e="Change.kinetic",i="none",n="up",a="right",r="down",s="left",o="Label",h=t.length;Kinetic.Label=function(t){this.____init(t)},Kinetic.Label.prototype={____init:function(t){var e=this;this.className=o,Kinetic.Group.call(this,t),this.on("add.kinetic",function(t){e._addListeners(t.child),e._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(i){var n,a=this,r=function(){a._sync()};for(n=0;n<h;n++)i.on(t[n]+e,r)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var t,e,i,o,h,c,l=this.getText(),d=this.getTag();if(l&&d){switch(t=l.getWidth(),e=l.getHeight(),i=d.getPointerDirection(),o=d.getPointerWidth(),pointerHeight=d.getPointerHeight(),h=0,c=0,i){case n:h=t/2,c=-1*pointerHeight;break;case a:h=t+o,c=e/2;break;case r:h=t/2,c=e+pointerHeight;break;case s:h=-1*o,c=e/2}d.setAttrs({x:-1*h,y:-1*c,width:t,height:e}),l.setAttrs({x:-1*h,y:-1*c})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Tag=function(t){this.___init(t)},Kinetic.Tag.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className="Tag"},drawFunc:function(t){var e=this.getWidth(),i=this.getHeight(),o=this.getPointerDirection(),h=this.getPointerWidth(),c=this.getPointerHeight();this.getCornerRadius();t.beginPath(),t.moveTo(0,0),o===n&&(t.lineTo((e-h)/2,0),t.lineTo(e/2,-1*c),t.lineTo((e+h)/2,0)),t.lineTo(e,0),o===a&&(t.lineTo(e,(i-c)/2),t.lineTo(e+h,i/2),t.lineTo(e,(i+c)/2)),t.lineTo(e,i),o===r&&(t.lineTo((e+h)/2,i),t.lineTo(e/2,i+c),t.lineTo((e-h)/2,i)),t.lineTo(0,i),o===s&&(t.lineTo(0,(i+c)/2),t.lineTo(-1*h,i/2),t.lineTo(0,(i-c)/2)),t.closePath(),t.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",i),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0)}(),function(){Kinetic.Filters.Grayscale=function(t){for(var e=t.data,i=0;i<e.length;i+=4){var n=.34*e[i]+.5*e[i+1]+.16*e[i+2];e[i]=n,e[i+1]=n,e[i+2]=n}}}(),function(){Kinetic.Filters.Brighten=function(t){for(var e=this.getFilterBrightness(),i=t.data,n=0;n<i.length;n+=4)i[n]+=e,i[n+1]+=e,i[n+2]+=e},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterBrightness",0)}(),function(){Kinetic.Filters.Invert=function(t){for(var e=t.data,i=0;i<e.length;i+=4)e[i]=255-e[i],e[i+1]=255-e[i+1],e[i+2]=255-e[i+2]}}(),function(){function t(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function e(e,a){var r,s,o,h,c,l,d,u,f,g,p,v,_,K,m,y,S,x,C,w,b,P,T,F,A=e.data,k=e.width,D=e.height,L=a+a+1,G=k-1,R=D-1,I=a+1,M=I*(I+1)/2,U=new t,N=null,B=U,E=null,H=null,O=i[a],z=n[a];for(o=1;o<L;o++)B=B.next=new t,o==I&&(N=B);for(B.next=U,d=l=0,s=0;s<D;s++){for(y=S=x=C=u=f=g=p=0,v=I*(w=A[l]),_=I*(b=A[l+1]),K=I*(P=A[l+2]),m=I*(T=A[l+3]),u+=M*w,f+=M*b,g+=M*P,p+=M*T,B=U,o=0;o<I;o++)B.r=w,B.g=b,B.b=P,B.a=T,B=B.next;for(o=1;o<I;o++)h=l+((G<o?G:o)<<2),u+=(B.r=w=A[h])*(F=I-o),f+=(B.g=b=A[h+1])*F,g+=(B.b=P=A[h+2])*F,p+=(B.a=T=A[h+3])*F,y+=w,S+=b,x+=P,C+=T,B=B.next;for(E=U,H=N,r=0;r<k;r++)A[l+3]=T=p*O>>z,0!==T?(T=255/T,A[l]=(u*O>>z)*T,A[l+1]=(f*O>>z)*T,A[l+2]=(g*O>>z)*T):A[l]=A[l+1]=A[l+2]=0,u-=v,f-=_,g-=K,p-=m,v-=E.r,_-=E.g,K-=E.b,m-=E.a,h=d+((h=r+a+1)<G?h:G)<<2,y+=E.r=A[h],S+=E.g=A[h+1],x+=E.b=A[h+2],C+=E.a=A[h+3],u+=y,f+=S,g+=x,p+=C,E=E.next,v+=w=H.r,_+=b=H.g,K+=P=H.b,m+=T=H.a,y-=w,S-=b,x-=P,C-=T,H=H.next,l+=4;d+=k}for(r=0;r<k;r++){for(S=x=C=y=f=g=p=u=0,l=r<<2,v=I*(w=A[l]),_=I*(b=A[l+1]),K=I*(P=A[l+2]),m=I*(T=A[l+3]),u+=M*w,f+=M*b,g+=M*P,p+=M*T,B=U,o=0;o<I;o++)B.r=w,B.g=b,B.b=P,B.a=T,B=B.next;for(c=k,o=1;o<=a;o++)l=c+r<<2,u+=(B.r=w=A[l])*(F=I-o),f+=(B.g=b=A[l+1])*F,g+=(B.b=P=A[l+2])*F,p+=(B.a=T=A[l+3])*F,y+=w,S+=b,x+=P,C+=T,B=B.next,o<R&&(c+=k);for(l=r,E=U,H=N,s=0;s<D;s++)h=l<<2,A[h+3]=T=p*O>>z,T>0?(T=255/T,A[h]=(u*O>>z)*T,A[h+1]=(f*O>>z)*T,A[h+2]=(g*O>>z)*T):A[h]=A[h+1]=A[h+2]=0,u-=v,f-=_,g-=K,p-=m,v-=E.r,_-=E.g,K-=E.b,m-=E.a,h=r+((h=s+I)<R?h:R)*k<<2,u+=y+=E.r=A[h],f+=S+=E.g=A[h+1],g+=x+=E.b=A[h+2],p+=C+=E.a=A[h+3],E=E.next,v+=w=H.r,_+=b=H.g,K+=P=H.b,m+=T=H.a,y-=w,S-=b,x-=P,C-=T,H=H.next,l+=k}}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];
Kinetic.Filters.Blur=function(t){var i=0|this.getFilterRadius();i>0&&e(t,i)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterRadius",0)}(),function(){function t(t,e,i){var n=4*(i*t.width+e),a=[];return a.push(t.data[n++],t.data[n++],t.data[n++],t.data[n++]),a}function e(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function i(t){for(var e=[0,0,0],i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function n(n,a){var r=t(n,0,0),s=t(n,n.width-1,0),o=t(n,0,n.height-1),h=t(n,n.width-1,n.height-1),c=a||10;if(e(r,s)<c&&e(s,h)<c&&e(h,o)<c&&e(o,r)<c){for(var l=i([s,r,h,o]),d=[],u=0;u<n.width*n.height;u++){var f=e(l,[n.data[4*u],n.data[4*u+1],n.data[4*u+2]]);d[u]=f<c?0:255}return d}}function a(t,e){for(var i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}function r(t,e,i){for(var n=[1,1,1,1,0,1,1,1,1],a=Math.round(Math.sqrt(n.length)),r=Math.floor(a/2),s=[],o=0;o<i;o++)for(var h=0;h<e;h++){for(var c=o*e+h,l=0,d=0;d<a;d++)for(var u=0;u<a;u++){var f=o+d-r,g=h+u-r;if(f>=0&&f<i&&g>=0&&g<e){var p=f*e+g,v=n[d*a+u];l+=t[p]*v}}s[c]=2040===l?255:0}return s}function s(t,e,i){for(var n=[1,1,1,1,1,1,1,1,1],a=Math.round(Math.sqrt(n.length)),r=Math.floor(a/2),s=[],o=0;o<i;o++)for(var h=0;h<e;h++){for(var c=o*e+h,l=0,d=0;d<a;d++)for(var u=0;u<a;u++){var f=o+d-r,g=h+u-r;if(f>=0&&f<i&&g>=0&&g<e){var p=f*e+g,v=n[d*a+u];l+=t[p]*v}}s[c]=l>=1020?255:0}return s}function o(t,e,i){for(var n=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],a=Math.round(Math.sqrt(n.length)),r=Math.floor(a/2),s=[],o=0;o<i;o++)for(var h=0;h<e;h++){for(var c=o*e+h,l=0,d=0;d<a;d++)for(var u=0;u<a;u++){var f=o+d-r,g=h+u-r;if(f>=0&&f<i&&g>=0&&g<e){var p=f*e+g,v=n[d*a+u];l+=t[p]*v}}s[c]=l}return s}Kinetic.Filters.Mask=function(t){var e=this.getFilterThreshold(),i=n(t,e);return i&&(i=r(i,t.width,t.height),i=s(i,t.width,t.height),i=o(i,t.width,t.height),a(t,i)),t},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterThreshold",0)}(),function(){var t=function(t,e,i){t/=255,e/=255,i/=255;var n=Math.max(t,e,i),a=Math.min(t,e,i),r=n-a,s=r/2,o=r/(1-Math.abs(2*s-1)),h=0;return n==t?h=(e-i)/r%6:n==e?h=(i-t)/r+2:n==i&&(h=(t-e)/r+4),[(60*h+360)%360,o,s]},e=function(t,e,i,n){t/=255,e/=255,i/=255;var a=Math.max(t,e,i),r=Math.min(t,e,i),s=a-r,o=s/2,h=(s/(1-Math.abs(2*o-1)),0);a==t?h=(e-i)/s%6:a==e?h=(i-t)/s+2:a==i&&(h=(t-e)/s+4),h*=60,h%=360,h+=n,h%=360,h/=60;var c=0,l=0,d=0,u=s*(1-Math.abs(h%2-1)),f=o-s/2;return 0<=h&&h<1?(c=s,l=u):1<=h&&h<2?(l=s,c=u):2<=h&&h<3?(l=s,d=u):3<=h&&h<4?(d=s,l=u):4<=h&&h<5?(d=s,c=u):5<=h&&h<6&&(c=s,d=u),c+=f,l+=f,d+=f,c=255*c,l=255*l,d=255*d,[c,l,d]},i=function(t,i){for(var n,a=t.data,r=0;r<a.length;r+=4)n=e(a[r+0],a[r+1],a[r+2],i),a[r+0]=n[0],a[r+1]=n[1],a[r+2]=n[2]};Kinetic.Filters.ShiftHue=function(t){i(t,this.getFilterHueShiftDeg()%360)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterHueShiftDeg",0),Kinetic.Filters.Colorize=function(e){for(var n=e.data,a=this.getFilterColorizeColor(),r=t(a[0],a[1],a[2]),s=r[0],o=0;o<n.length;o+=4)n[o+1]=0,n[o+2]=0;i(e,s)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterColorizeColor",[255,0,0])}(),function(){var t=function(t,e){var i=t.data,n=t.width,a=t.height,r=n*a,s=[];s.length=n*a*4;var o,h,c,l,d,u,f,g,p,v,_,K=e.length,m=e[0].length,y=Math.floor(e.length/2),S=Math.floor(e[0].length/2);for(u=0;u<a;u+=1)for(d=0;d<n;d+=1){for(o=0,h=0,c=0,l=0,v=0;v<K;v+=1)for(_=0;_<m;_+=1)f=(d+v-y)%n,f=f>0?f:-f,g=(u+v-S)%a,g=g>0?g:-g,p=4*(g*n+f),o+=e[_][v]*i[p+0],h+=e[_][v]*i[p+1],c+=e[_][v]*i[p+2];p=4*(u*n+d),s[p+0]=o,s[p+1]=h,s[p+2]=c}var x=4*r;for(p=0;p<x;p+=4)i[p+0]=s[p+0],i[p+1]=s[p+1],i[p+2]=s[p+2]},e=function(t,e,i){var n=t-e;return Math.pow(Math.E,-n*n/(2*i*i))},i=function(t,i,n){t%2===0&&(t+=1);var a,r,s,o=[];for(a=0;a<t;a+=1){for(s=[],r=0;r<t;r+=1)s.push(i*e(a,t/2,n)*e(r,t/2,n));o.push(s)}return o},n=function(t,e){var n=i(t,e,1),a=Math.floor(t/2);return n[a][a]+=1-e,n},a=function(t,e){var n=i(t,-e,1),a=Math.floor(t/2);return n[a][a]+=1+e,n};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterAmount",50),Kinetic.Filters.UnsharpMask=function(e){t(e,a(5,this.getFilterAmount()/100))},Kinetic.Filters.SoftBlur=function(e){t(e,n(5,this.getFilterAmount()/100))},Kinetic.Filters.Edge=function(e){var i=this.getFilterAmount()/100;0!==i&&t(e,[[0,-1*i,0],[-1*i,1-i+4*i,-1*i],[0,-1*i,0]])},Kinetic.Filters.Emboss=function(e){var i=this.getFilterAmount()/100;0!==i&&t(e,[[-1*i,-.5*i,0],[-.5*i,1+.5*i,.5*i],[0,.5*i,1*i]])}}();