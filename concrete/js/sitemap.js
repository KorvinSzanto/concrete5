!function(e,t,a){"use strict";function i(e,a){var i=this;return a=a||{},a=t.extend({displayNodePagination:!1,cParentID:0,siteTreeID:0,cookieId:"ConcreteSitemap",includeSystemPages:!1,displaySingleLevel:!1,persist:!0,minExpandLevel:!1,dataSource:CCM_TOOLS_PATH+"/dashboard/sitemap_data",ajaxData:{},selectMode:!1,onClickNode:!1,onSelectNode:!1,init:!1},a),i.options=a,i.$element=e,i.setupTree(),i.setupTreeEvents(),Concrete.event.publish("ConcreteSitemap",this),i.$element}i.prototype={getTree:function(){var e=this;return e.$element.fancytree("getTree")},setupTree:function(){var e,a=this,i=!0,o=1,n=!1,c=!1;"single"==a.options.selectMode?(n=!0,c={checkbox:"fancytree-radio"}):"multiple"==a.options.selectMode?(o=2,n=!0):"hierarchical-multiple"==a.options.selectMode&&(o=3,n=!0),n&&(i=!1),a.options.minExpandLevel!==!1?e=a.options.minExpandLevel:a.options.displaySingleLevel?(e=1==a.options.cParentID?2:3,i=!1):e=a.options.selectMode?2:1,a.options.persist||(i=!1);var s=t.extend({displayNodePagination:a.options.displayNodePagination?1:0,cParentID:a.options.cParentID,siteTreeID:a.options.siteTreeID,displaySingleLevel:a.options.displaySingleLevel?1:0,includeSystemPages:a.options.includeSystemPages?1:0},a.options.ajaxData),l=["glyph","dnd"];i&&l.push("persist"),t(a.$element).addClass("ccm-tree-sitemap"),t(a.$element).fancytree({extensions:l,glyph:{map:{doc:"fa fa-file-o",docOpen:"fa fa-file-o",checkbox:"fa fa-square-o",checkboxSelected:"fa fa-check-square-o",checkboxUnknown:"fa fa-share-square",dragHelper:"fa fa-share",dropMarker:"fa fa-angle-right",error:"fa fa-warning",expanderClosed:"fa fa-plus-square-o",expanderLazy:"fa fa-plus-square-o",expanderOpen:"fa fa-minus-square-o",loading:"fa fa-spin fa-refresh"}},persist:{cookieDelimiter:"~",cookiePrefix:a.options.cookieId,cookie:{path:CCM_REL+"/"}},autoFocus:!1,classNames:c,source:{url:a.options.dataSource,data:s},init:function(){a.options.init&&a.options.init.call(),a.options.displayNodePagination&&a.setupNodePagination(a.$element,a.options.cParentID)},selectMode:o,checkbox:n,minExpandLevel:e,clickFolderMode:2,lazyLoad:function(e,t){return!a.options.displaySingleLevel&&void(t.result=a.getLoadNodePromise(t.node))},click:function(e,i){var o=i.node;if("title"==i.targetType&&o.data.cID){if(a.options.selectMode)return!1;if(a.options.onClickNode)return a.options.onClickNode.call(a,o);var n=new ConcretePageMenu(t(o.li),{menuOptions:a.options,data:o.data,sitemap:a,onHide:function(e){e.$launcher.each(function(){t(this).unbind("mousemove.concreteMenu")})}});n.show(e)}else if(o.data.href)window.location.href=o.data.href;else if(a.options.displaySingleLevel)return a.displaySingleLevel(o),!1},select:function(e,t,i){a.options.onSelectNode&&a.options.onSelectNode.call(a,t.node,t.node.isSelected())},dnd:{preventRecursiveMoves:!0,focusOnClick:!0,preventVoidMoves:!0,dragStart:function(e,t){return!a.options.selectMode&&!!e.data.cID},dragStop:function(e,t){return!0},dragEnter:function(e,t){return!(!e.parent.data.cID&&"1"!==e.data.cID)&&(1==e.data.cID?"over":e.data.cID!=t.otherNode.data.cID&&(!(!t.otherNode.data.cID&&"after"==t.hitMode)&&!e.isDescendantOf(t.otherNode)))},dragDrop:function(e,t){e.parent.data.cID==t.otherNode.parent.data.cID&&"over"!=t.hitMode?(t.otherNode.moveTo(e,t.hitMode),a.rescanDisplayOrder(t.otherNode.parent)):a.selectMoveCopyTarget(t.otherNode,e,t.hitMode)}}})},setupTreeEvents:function(){var e=this;return!e.options.selectMode&&!e.options.onClickNode&&(ConcreteEvent.unsubscribe("SitemapDeleteRequestComplete.sitemap"),ConcreteEvent.subscribe("SitemapDeleteRequestComplete.sitemap",function(t){var a=e.$element.fancytree("getActiveNode"),i=a.parent;e.reloadNode(i)}),ConcreteEvent.unsubscribe("SitemapAddPageRequestComplete.sitemap"),ConcreteEvent.subscribe("SitemapAddPageRequestComplete.sitemap",function(t,a){var i=e.getTree().getNodeByKey(a.cParentID);i&&e.reloadNode(i),jQuery.fn.dialog.closeAll()}),void ConcreteEvent.subscribe("SitemapUpdatePageRequestComplete.sitemap",function(t,a){try{var i=e.getTree().getNodeByKey(a.cID),o=i.parent;o&&e.reloadNode(o)}catch(t){}}))},rescanDisplayOrder:function(e){var a,i=e.getChildren(),o=[];for(e.setStatus("loading"),a=0;a<i.length;a++){var n=i[a];o.push({name:"cID[]",value:n.data.cID})}t.concreteAjax({dataType:"json",type:"POST",data:o,url:CCM_TOOLS_PATH+"/dashboard/sitemap_update",success:function(t){e.setStatus("ok"),ConcreteAlert.notify({message:t.message})}})},selectMoveCopyTarget:function(e,a,i){var o=this,n=ccmi18n_sitemap.moveCopyPage;if(!i)var i="";var c=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request?origCID="+e.data.cID+"&destCID="+a.data.cID+"&dragMode="+i,s=350,l=350;t.fn.dialog.open({title:n,href:c,width:l,modal:!1,height:s}),ConcreteEvent.unsubscribe("SitemapDragRequestComplete.sitemap"),ConcreteEvent.subscribe("SitemapDragRequestComplete.sitemap",function(t,n){var c=a.parent;"over"==i&&(c=a),"MOVE"==n.task&&e.remove(),c.removeChildren(),o.reloadNode(c,function(){a.bExpanded||a.expand(!0)})})},setupNodePagination:function(e){var a=e.find("div.ccm-pagination-wrapper"),i=this;e.children(".ccm-pagination-bound").remove(),a.length&&(a.find("a").unbind("click").on("click",function(){var e=t(this).attr("href"),a=i.$element.fancytree("getRootNode");return jQuery.fn.dialog.showLoader(),t.ajax({dataType:"json",url:e,success:function(e){jQuery.fn.dialog.hideLoader(),a.removeChildren(),a.addChildren(e),i.setupNodePagination(i.$element)}}),!1}),a.addClass("ccm-pagination-bound").appendTo(e))},displaySingleLevel:function(e){var a=this,i=a.options;1==e.data.cID?2:3;(a.options.onDisplaySingleLevel||t.noop).call(this,e);var o=a.$element.fancytree("getRootNode"),n=t.extend({dataType:"json",displayNodePagination:i.displayNodePagination?1:0,siteTreeID:i.siteTreeID,cParentID:e.data.cID,displaySingleLevel:!0,includeSystemPages:i.includeSystemPages?1:0},i.ajaxData);return jQuery.fn.dialog.showLoader(),t.ajax({dataType:"json",url:i.dataSource,data:n,success:function(t){jQuery.fn.dialog.hideLoader(),o.removeChildren(),o.addChildren(t),a.setupNodePagination(a.$element,e.data.key)}})},getLoadNodePromise:function(e){var a=this,i=a.options,o=t.extend({cParentID:e.data.cID,siteTreeID:i.siteTreeID,includeSystemPages:i.includeSystemPages?1:0,displayNodePagination:i.displayNodePagination?1:0},i.ajaxData),n={dataType:"json",url:i.dataSource,data:o};return t.ajax(n)},reloadNode:function(e,t){this.getLoadNodePromise(e).done(function(a){e.removeChildren(),e.addChildren(a),e.setExpanded(!0,{noAnimation:!0}),t&&t()})}},i.exitEditMode=function(e){t.get(CCM_TOOLS_PATH+"/dashboard/sitemap_check_in?cID="+e+"&ccm_token="+CCM_SECURITY_TOKEN)},i.refreshCopyOperations=function(){ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_copy_all",[],ccmi18n_sitemap.copyProgressTitle,function(){t(".ui-dialog-content").dialog("close"),window.location.reload()})},i.submitDragRequest=function(){var e=t("#origCID").val(),a=(t("#destParentID").val(),t("#destCID").val()),i=t("#dragMode").val(),o=t("#destSibling").val(),n=t("input[name=ctask]:checked").val(),c=t("input[name=copyAll]:checked").val(),s=t("input[name=saveOldPagePath]:checked").val(),l={origCID:e,destCID:a,ctask:n,ccm_token:CCM_SECURITY_TOKEN,copyAll:c,destSibling:o,dragMode:i,saveOldPagePath:s};if(1==c){var d=ccmi18n_sitemap.copyProgressTitle;ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_copy_all",[{name:"origCID",value:e},{name:"destCID",value:a}],d,function(){t(".ui-dialog-content").dialog("close"),ConcreteEvent.publish("SitemapDragRequestComplete",{task:n})})}else jQuery.fn.dialog.showLoader(),t.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request",l,function(e){ccm_parseJSON(e,function(){jQuery.fn.dialog.closeAll(),jQuery.fn.dialog.hideLoader(),ConcreteAlert.notify({message:e.message}),ConcreteEvent.publish("SitemapDragRequestComplete",{task:n}),jQuery.fn.dialog.closeTop(),jQuery.fn.dialog.closeTop()})})},t.fn.concreteSitemap=function(e){return t.each(t(this),function(a,o){new i(t(this),e)})},e.ConcreteSitemap=i}(this,$,_),!function(e,t,a){"use strict";function i(e,i){var o=this,i=i||{};i=t.extend({sitemap:!1,data:{},menuOptions:{}},i),ConcreteMenu.call(o,e,i),0!=i.sitemap&&(o.$menu=t(a.template(ConcretePageAjaxSearchMenu.get(),{item:i.data})))}i.prototype=Object.create(ConcreteMenu.prototype),i.prototype.setupMenuOptions=function(e){var t=this,a=ConcreteMenu.prototype,i=e.attr("data-search-page-menu");t.options.container;a.setupMenuOptions(e),t.options.sitemap&&0!=t.options.sitemap.options.displaySingleLevel||e.find("[data-sitemap-mode=explore]").remove(),e.find("a[data-action=delete-forever]").on("click",function(){return ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_delete_forever",[{name:"cID",value:i}],ccmi18n_sitemap.deletePages,function(){if(t.options.sitemap){var e=t.options.sitemap.getTree(),a=e.getNodeByKey(i);a.remove()}ConcreteAlert.notify({message:ccmi18n_sitemap.deletePageSuccessMsg})}),!1}),e.find("a[data-action=empty-trash]").on("click",function(){return ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_delete_forever",[{name:"cID",value:i}],ccmi18n_sitemap.deletePages,function(){if(t.options.sitemap){var e=t.options.sitemap.getTree(),a=e.getNodeByKey(i);a.removeChildren()}}),!1})},t.fn.concretePageMenu=function(e){return t.each(t(this),function(a,o){new i(t(this),e)})},e.ConcretePageMenu=i}(this,$,_),!function(e,t){"use strict";function a(e,a){var o=this;a=t.extend({mode:"menu",searchMethod:"get"},a),o.options=a,o._templateSearchResultsMenu=_.template(i.get()),ConcreteAjaxSearch.call(o,e,a),o.setupEvents()}a.prototype=Object.create(ConcreteAjaxSearch.prototype),a.prototype.setupEvents=function(){var e=this;ConcreteEvent.subscribe("SitemapDeleteRequestComplete",function(t){e.refreshResults()}),ConcreteEvent.fire("ConcreteSitemapPageSearch",e)},a.prototype.updateResults=function(e){var a=this,i=a.$element;ConcreteAjaxSearch.prototype.updateResults.call(a,e),"choose"==a.options.mode&&(i.find(".ccm-search-results-checkbox").parent().remove(),i.find("select[data-bulk-action]").parent().remove(),i.unbind(".concretePageSearchHoverPage"),i.on("mouseover.concretePageSearchHoverPage","tr[data-launch-search-menu]",function(){t(this).addClass("ccm-search-select-hover")}),i.on("mouseout.concretePageSearchHoverPage","tr[data-launch-search-menu]",function(){t(this).removeClass("ccm-search-select-hover")}),i.unbind(".concretePageSearchChoosePage").on("click.concretePageSearchChoosePage","tr[data-launch-search-menu]",function(){return ConcreteEvent.publish("SitemapSelectPage",{instance:a,cID:t(this).attr("data-page-id"),title:t(this).attr("data-page-name")}),!1}))},a.prototype.handleSelectedBulkAction=function(e,a,i,o){if("movecopy"==e||"Move/Copy"==e){var n,c=[];t.each(o,function(e,a){c.push(t(a).val())}),ConcreteEvent.unsubscribe("SitemapSelectPage.search");var s=function(e,a){Concrete.event.unsubscribe(e),n=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request?origCID="+c.join(",")+"&destCID="+a.cID,t.fn.dialog.open({width:350,height:350,href:n,title:ccmi18n_sitemap.moveCopyPage,onDirectClose:function(){ConcreteEvent.subscribe("SitemapSelectPage.search",s)}})};ConcreteEvent.subscribe("SitemapSelectPage.search",s)}ConcreteAjaxSearch.prototype.handleSelectedBulkAction.call(this,e,a,i,o)},ConcreteAjaxSearch.prototype.createMenu=function(e){var a=this;e.concretePageMenu({container:a,menu:t("[data-search-menu="+e.attr("data-launch-search-menu")+"]")})},a.launchDialog=function(e){var a=t(window).width()-53;t.fn.dialog.open({width:a,height:"100%",href:CCM_TOOLS_PATH+"/sitemap_search_selector",modal:!0,title:ccmi18n_sitemap.pageLocationTitle,onClose:function(){ConcreteEvent.fire("PageSelectorClose")},onOpen:function(){ConcreteEvent.unsubscribe("SitemapSelectPage"),ConcreteEvent.subscribe("SitemapSelectPage",function(t,a){jQuery.fn.dialog.closeTop(),e(a)})}})},a.getPageDetails=function(e,a){t.ajax({type:"post",dataType:"json",url:CCM_DISPATCHER_FILENAME+"/ccm/system/page/get_json",data:{cID:e},error:function(e){ConcreteAlert.dialog("Error",e.responseText)},success:function(e){a(e)}})};var i={get:function(){return'<div class="popover fade" data-search-page-menu="<%=item.cID%>" data-search-menu="<%=item.cID%>"><div class="arrow"></div><div class="popover-inner"><ul class="dropdown-menu"><% if (item.isTrash) { %><li><a data-action="empty-trash" href="javascript:void(0)">'+ccmi18n_sitemap.emptyTrash+'</a></li><% } else if (item.isInTrash) { %><li><a data-action="delete-forever" href="javascript:void(0)">'+ccmi18n_sitemap.deletePageForever+"</a></li><% } else if (item.cAlias == 'LINK' || item.cAlias == 'POINTER') { %><li><a href=\"<%=item.link%>\">"+ccmi18n_sitemap.visitExternalLink+'</a></li><% if (item.cAlias == \'LINK\' && item.canEditPageProperties) { %><li><a class="dialog-launch" dialog-width="350" dialog-height="260" dialog-title="'+ccmi18n_sitemap.editExternalLink+'" dialog-modal="false" dialog-append-buttons="true" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/edit_external?cID=<%=item.cID%>">'+ccmi18n_sitemap.editExternalLink+'</a></li><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="90%" dialog-height="70%" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageAttributesTitle+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/attributes?cID=<%=item.cID%>">'+ccmi18n_sitemap.pageAttributes+'</a></li><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="500" dialog-height="630" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.setPagePermissions+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/panels/details/page/permissions?cID=<%=item.cID%>">'+ccmi18n_sitemap.setPagePermissions+'</a></li><% } %><% if (item.canDeletePage) { %><li><a class="dialog-launch" dialog-width="360" dialog-height="150" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.deleteExternalLink+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/delete_alias?cID=<%=item.cID%>">'+ccmi18n_sitemap.deleteExternalLink+'</a></li><% } %><% } else { %><li><a href="<%=item.link%>">'+ccmi18n_sitemap.visitPage+'</a></li><% if (item.canEditPageProperties || item.canEditPageSpeedSettings || item.canEditPagePermissions || item.canEditPageDesign || item.canViewPageVersions || item.canDeletePage) { %><li class="divider"></li><% } %><% if (item.canEditPageProperties) { %><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="640" dialog-height="360" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.seo+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/seo?cID=<%=item.cID%>">'+ccmi18n_sitemap.seo+'</a></li><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="500" dialog-height="500" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageLocationTitle+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/location?cID=<%=item.cID%>">'+ccmi18n_sitemap.pageLocation+'</a></li><li class="divider"></li><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="90%" dialog-height="70%" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageAttributesTitle+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/attributes?cID=<%=item.cID%>">'+ccmi18n_sitemap.pageAttributes+'</a></li><% } %><% if (item.canEditPageSpeedSettings) { %><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="550" dialog-height="280" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.speedSettingsTitle+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/panels/details/page/caching?cID=<%=item.cID%>">'+ccmi18n_sitemap.speedSettings+'</a></li><% } %><% if (item.canEditPagePermissions) { %><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="500" dialog-height="630" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.setPagePermissions+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/panels/details/page/permissions?cID=<%=item.cID%>">'+ccmi18n_sitemap.setPagePermissions+'</a></li><% } %><% if (item.canEditPageDesign || item.canEditPageType) { %><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="350" dialog-height="500" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageDesign+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/design?cID=<%=item.cID%>">'+ccmi18n_sitemap.pageDesign+'</a></li><% } %><% if (item.canViewPageVersions) { %><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="640" dialog-height="340" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageVersions+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/panels/page/versions?cID=<%=item.cID%>">'+ccmi18n_sitemap.pageVersions+'</a></li><% } %><% if (item.canDeletePage) { %><li><a class="dialog-launch" dialog-on-close="ConcreteSitemap.exitEditMode(<%=item.cID%>)" dialog-width="360" dialog-height="250" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.deletePage+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/delete_from_sitemap?cID=<%=item.cID%>">'+ccmi18n_sitemap.deletePage+'</a></li><% } %><li class="divider" data-sitemap-mode="explore"></li><li data-sitemap-mode="explore"><a class="dialog-launch" dialog-width="90%" dialog-height="70%" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.moveCopyPage+'" href="'+CCM_TOOLS_PATH+'/sitemap_search_selector?sitemap_select_mode=move_copy_delete&cID=<%=item.cID%>">'+ccmi18n_sitemap.moveCopyPage+'</a></li><li data-sitemap-mode="explore"><a href="'+CCM_DISPATCHER_FILENAME+'/dashboard/sitemap/explore?cNodeID=<%=item.cID%>&task=send_to_top">'+ccmi18n_sitemap.sendToTop+'</a></li><li data-sitemap-mode="explore"><a href="'+CCM_DISPATCHER_FILENAME+'/dashboard/sitemap/explore?cNodeID=<%=item.cID%>&task=send_to_bottom">'+ccmi18n_sitemap.sendToBottom+'</a></li><% if (item.numSubpages > 0) { %><li class="divider"></li><li><a href="'+CCM_DISPATCHER_FILENAME+'/dashboard/sitemap/search/?submitSearch=1&field[]=parent&cParentAll=1&cParentIDSearchField=<%=item.cID%>">'+ccmi18n_sitemap.searchPages+'</a></li><li><a href="'+CCM_DISPATCHER_FILENAME+'/dashboard/sitemap/explore/-/<%=item.cID%>">'+ccmi18n_sitemap.explorePages+'</a></li><% } %><% if (item.canAddExternalLinks || item.canAddSubpages) { %><li class="divider"></li><% if (item.canAddSubpages > 0) { %><li><a class="dialog-launch" dialog-width="350" dialog-modal="false" dialog-height="350" dialog-title="'+ccmi18n_sitemap.addPage+'" dialog-modal="false" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/add?cID=<%=item.cID%>">'+ccmi18n_sitemap.addPage+'</a></li><% } %><% if (item.canAddExternalLinks > 0) { %><li><a class="dialog-launch" dialog-width="350" dialog-modal="false" dialog-height="400" dialog-title="'+ccmi18n_sitemap.addExternalLink+'" dialog-modal="false" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/page/add_external?cID=<%=item.cID%>">'+ccmi18n_sitemap.addExternalLink+"</a></li><% } %><% } %><% } %></ul></div></div>"}};t.fn.concretePageAjaxSearch=function(e){return t.each(t(this),function(i,o){new a(t(this),e)})},e.ConcretePageAjaxSearch=a,e.ConcretePageAjaxSearchMenu=i}(this,$),!function(e,t){"use strict";function a(e,a){var i=this,a=t.extend({chooseText:ccmi18n_sitemap.choosePage,loadingText:ccmi18n_sitemap.loadingText,inputName:"cID",cID:0},a);i.$element=e,i.options=a,i._chooseTemplate=_.template(i.chooseTemplate,{options:i.options}),i._loadingTemplate=_.template(i.loadingTemplate),i._pageLoadedTemplate=_.template(i.pageLoadedTemplate),i._pageMenuTemplate=_.template(ConcretePageAjaxSearchMenu.get()),i.$element.append(i._chooseTemplate),i.$element.on("click","a[data-page-selector-link=choose]",function(e){e.preventDefault(),ConcretePageAjaxSearch.launchDialog(function(e){i.loadPage(e.cID)})}),i.options.cID&&i.loadPage(i.options.cID)}a.prototype={chooseTemplate:'<div class="ccm-item-selector"><input type="hidden" name="<%=options.inputName%>" value="0" /><a href="#" data-page-selector-link="choose"><%=options.chooseText%></a></div>',loadingTemplate:'<div class="ccm-item-selector"><div class="ccm-item-selector-choose"><input type="hidden" name="<%=options.inputName%>" value="<%=cID%>"><i class="fa fa-spin fa-spinner"></i> <%=options.loadingText%></div></div>',pageLoadedTemplate:'<div class="ccm-item-selector"><div class="ccm-item-selector-item-selected"><input type="hidden" name="<%=inputName%>" value="<%=page.cID%>" /><a data-page-selector-action="clear" href="#" class="ccm-item-selector-clear"><i class="fa fa-close"></i></a><div class="ccm-item-selector-item-selected-title"><%=page.name%></div></div></div>',loadPage:function(e){var t=this;t.$element.html(t._loadingTemplate({options:t.options,cID:e})),ConcretePageAjaxSearch.getPageDetails(e,function(e){var a=e.pages[0];t.$element.html(t._pageLoadedTemplate({inputName:t.options.inputName,page:a})),t.$element.on("click","a[data-page-selector-action=clear]",function(e){e.preventDefault(),t.$element.html(t._chooseTemplate)})})}},t.fn.concretePageSelector=function(e){return t.each(t(this),function(i,o){new a(t(this),e)})},e.ConcretePageSelector=a}(this,$),!function(e,t){"use strict";function a(e,a){var i=this,a=t.extend({mode:"single",inputName:"cID",selected:0,startingPoint:1,token:"",filters:{}},a);i.$element=t("<div />",{"class":"ccm-page-sitemap-selector-inner"}),i.$element.appendTo(e),i.options=a,i.$element.concreteSitemap({selectMode:i.options.mode,minExpandLevel:0,dataSource:CCM_DISPATCHER_FILENAME+"/ccm/system/page/select_sitemap",ajaxData:{startingPoint:i.options.startingPoint,ccm_token:i.options.token,selected:i.options.selected,filters:i.options.filters},init:function(){if(a.selected)if("multiple"==a.mode)t.each(a.selected,function(e,t){var a=i.$element.fancytree("getTree").getNodeByKey(String(t));a&&a.setSelected(!0)});else{var e=i.$element.fancytree("getTree"),o=e.getNodeByKey(String(a.selected));o&&o.setSelected(!0)}},onSelectNode:function(e,t){return!e.data.hideCheckbox&&void(t?("single"==i.options.mode&&i.deselectAll(),i.select(e)):i.deselect(e))}})}a.prototype={deselectAll:function(){var e=this,t=e.$element.find("input[data-sitemap-selector-page-id]");t.remove()},deselect:function(e){var t=this,a=t.$element.find("input[data-sitemap-selector-page-id="+e.data.cID+"]");a.remove()},select:function(e){var a=this,i=a.options.inputName;"multiple"==a.options.mode&&(i+="[]");var o=t("<input />",{"data-sitemap-selector-page-id":e.data.cID,type:"hidden",name:i});o.val(e.data.cID),o.appendTo(a.$element)}},t.fn.concretePageSitemapSelector=function(e){return t.each(t(this),function(i,o){new a(t(this),e)})},e.ConcretePageSitemapSelector=a}(this,$);