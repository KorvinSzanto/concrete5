!function(){"use strict";function t(t,n){$.extend(this,t),this.hasContext="context"in t,this.isPlural="originalPlural"in t,this.isTranslated="translations"in t,this.translator=n,!this.translator.approvalSupport||"isApproved"in t||(this.isApproved=!1),this.translator.translations.push(this)}function n(n){this.containerID=n.container,this.height=n.height,this.saveAction=n.saveAction,this.plurals=$.extend(!0,{},n.plurals),this.translations=[],this.approvalSupport=n.approvalSupport!==!1,this.referencePatterns=$.extend(!0,{file:null,file_line:null},n.referencePatterns),this.on={uiLaunched:"onUILaunched"in n?n.onUILaunched:null,beforeActivatingTranslation:"onBeforeActivatingTranslation"in n?n.onBeforeActivatingTranslation:null,currentTranslationChanged:"onCurrentTranslationChanged"in n?n.onCurrentTranslationChanged:null},this.approvalSupport&&(this.canModifyApproved=n.canModifyApproved===!0);for(var a=0,e=n.translations.length;a<e;a++)new t(n.translations[a],this);this.busy=!1}if(!window.ccmTranslator){var a=500,e={AskDiscardDirtyTranslation:"The current item has changed.\nIf you proceed you will lose your changes.\n\nDo you want to proceed anyway?",Approved:"Approved",Comments:"Comments",Context:"Context",ExamplePH:"Example: %s",Filter:"Filter",Original_String:"Original String",Please_fill_in_all_plurals:"Please fill-in all plural forms",Plural_Original_String:"Plural Original String",References:"References",Save_and_Continue:"Save & Continue",Search_for_:"Search for...",Search_in_contexts:"Search in contexts",Search_in_originals:"Search in originals",Search_in_translations:"Search in translations",Show_approved:"Show approved",Show_translated:"Show translated",Show_unapproved:"Show unapproved",Show_untranslated:"Show untranslated",Singular_Original_String:"Singular Original String",Toggle_Dropdown:"Toggle Dropdown",TAB:"[TAB] Forward",TAB_SHIFT:"[SHIFT]+[TAB] Backward",Translate:"Translate",Translation:"Translation",TranslationIsApproved_WillNeedApproval:"This translation is approved: your changes will need approval.",TranslationIsNotApproved:"This translation is not approved.",PluralNames:{zero:"Zero",one:"One",two:"Two",few:"Few",many:"Many",other:"Other"}},i={colFilter:"col-md-12",colOriginal:"col-md-5",colTranslations:"col-md-7"};t.prototype={buildListItem:function(){var t=this;this.li=document.createElement("li"),this.li.ccmTranslation=this,this.li.className="list-group-item clearfix"+(this.isTranslated?" list-group-item-success":"");var n=document.createElement("span");n.textContent=n.innerText=this.original,this.li.appendChild(n),this.liTranslated=document.createElement("span"),this.translationUpdated(!0),this.li.appendChild(this.liTranslated),this.translator.UI.$list[0].appendChild(this.li),this.li.onclick=function(){t.translator.setCurrentTranslation(t)}},translationUpdated:function(t){this.liTranslated.textContent=this.liTranslated.innerText=this.isTranslated?this.translations[0]:"",t!==!0&&(this.isTranslated?$(this.li).addClass("list-group-item-success"):$(this.li).removeClass("list-group-item-success"))},translatedSaved:function(t,n){null===t?(delete this.translations,this.isTranslated=!1,this.translator.approvalSupport&&(this.isApproved=!1)):(this.translations=t,this.isTranslated=!0,!this.translator.approvalSupport||n!==!0&&n!==!1||(this.isApproved=n)),this.translationUpdated()},contextContains:function(t){return this.hasContext!==!1&&this.context.toLowerCase().indexOf(t)>=0},originalContains:function(t){return this.original.toLowerCase().indexOf(t)>=0||this.isPlural===!0&&this.originalPlural.toLowerCase().indexOf(t)>=0},translationContains:function(t){if(this.isTranslated===!1)return!1;for(var n=this.translations.length,a=0;a<n;a++)if(this.translations[a].toLowerCase().indexOf(t)>=0)return!0;return!1},satisfyFilter:function(t){if(t.showTranslated===!1&&this.isTranslated===!0)return!1;if(t.showUntranslated===!1&&this.isTranslated===!1)return!1;if(t.showApproved===!1&&this.isApproved===!0)return!1;if(t.showUnapproved===!1&&this.isApproved===!1)return!1;if(t.text.length>0){var n=!1;if(n=n||t.searchInContexts&&this.contextContains(t.lowerCaseText),n=n||t.searchInOriginals&&this.originalContains(t.lowerCaseText),n=n||t.searchInTranslations&&this.translationContains(t.lowerCaseText),n===!1)return!1}return!0},applyFilter:function(){this.li.style.display=this.satisfyFilter(this.translator.appliedFilter)?"":"none"}};var s=function(){function t(t,n){if(this.UI={},this.translation=t,this.multiline=n,this.element=this.multiline?'textarea rows="8"':'input type="text"',this.UI.$container=this.translation.translator.UI.$translation,this.UI.$container.empty(),this.UI.$container.closest(".panel").css("visibility","visible"),this.buildOriginalUI(),this.buildTranslationUI(),this.translation.translator.approvalSupport&&(this.translation.translator.canModifyApproved?this.UI.$container.append($('<label class="control-label inline" />').text(e.Approved).prepend(this.UI.$approved=$('<input type="checkbox" '+(this.translation.isApproved?' checked="checked"':"")+" />"))):this.UI.$container.append($("<p />").text(this.translation.isApproved?e.TranslationIsApproved_WillNeedApproval:e.TranslationIsNotApproved))),"comments"in this.translation||"context"in this.translation||"references"in this.translation){var a;if(this.UI.$container.append(a=$("<dl />")),"comments"in this.translation&&a.append($("<dt />").text(e.Comments)).append($("<dd />").text(this.translation.comments)),"context"in this.translation&&a.append($("<dt />").text(e.Context)).append($("<dd />").text(this.translation.context)),"references"in this.translation){var i,s=this.translation.translator.referencePatterns;a.append($("<dt />").text(e.References)).append(i=$('<dd style="overflow: hidden; white-space: pre" />')),$.each(this.translation.references,function(t,n){t>0&&i.append("<br />");var a,e;n.length>1&&null!==n[1]?(a=n.join(":"),e=s.file_line):(a=n[0],e=s.file),e?i.append($('<a target="_blank" />').text(a).attr("href",e.replace(/\[\[FILE\]\]/g,n[0]).replace(/\[\[LINE\]\]/g,n[1]))):i.append($("<span />").text(a))}),i.attr("title",i.text())}}var r=$(this.translation.li);r.addClass("list-group-item-info");var l=null,o=r.closest("ul"),p=r.position().top-o.position().top,d=o.scrollTop();if(p<0)l=d+p;else{var h=p+r.outerHeight(),c=o.height();h>c&&(l=d+(h-c))}null!==l&&o.animate({scrollTop:l},50)}function n(n){t.call(this,n,n.original.indexOf("\n")>=0)}function a(n){t.call(this,n,n.original.indexOf("\n")>=0||n.originalPlural.indexOf("\n")>=0)}return t.prototype={getTranslatedState:function(t){var n=this.getTranslatedStrings(t);if(null===n||n===!1)return n;var a={strings:n};return"$approved"in this.UI&&(a.approved=!!this.UI.$approved.is(":checked")),a},isDirty:function(){var t=this.getTranslatedState();if(null===t)return!!this.translation.isTranslated;if(this.translation.isTranslated===!1)return!0;for(var n=!1,a=t.strings.length,e=0;e<a;e++)if(t.strings[e]!==this.translation.translations[e]){n=!0;break}return"approved"in t&&t.approved!==this.translation.isApproved&&(n=!0),n},dispose:function(){$(this.translation.li).removeClass("list-group-item-info"),this.UI.$container.empty().closest(".panel").css("visibility","hidden")}},$.extend(!0,n.prototype,t.prototype,{buildOriginalUI:function(){this.UI.$container.append($('<div class="form-group" />').append($('<label class="control-label" />').text(e.Original_String)).append($("<"+this.element+' class="form-control" readonly="readonly" />').val(this.translation.original)))},buildTranslationUI:function(){this.UI.$container.append($('<div class="form-group" />').append($('<label class="control-label" />').text(e.Translation)).append(this.UI.$translated=$("<"+this.element+' class="form-control" />').val(this.translation.isTranslated?this.translation.translations[0]:""))),this.UI.$translated.focus()},getCurrentTextInput:function(){return this.UI.$translated},getTranslatedStrings:function(t){var n=$.trim(this.UI.$translated.val());return n.length>0?[n]:null}}),$.extend(!0,a.prototype,t.prototype,{buildOriginalUI:function(){this.UI.$container.append($('<div class="form-group" />').append($('<label class="control-label" />').text(e.Singular_Original_String)).append($("<"+this.element+' class="form-control" readonly="readonly" />').val(this.translation.original))).append($('<div class="form-group" />').append($('<label class="control-label" />').text(e.Plural_Original_String)).append($("<"+this.element+' class="form-control" readonly="readonly" />').val(this.translation.originalPlural)))},showTranslationTab:function(t,n){this.UI.$tabHeaders.find("li.active").removeClass("active"),this.UI.$tabBodies.find(".tab-pane.active").removeClass("active"),this.UI.$tabHeaders.find('li[data-key="'+t+'"]').addClass("active");var a=this.UI.$tabBodies.find('.tab-pane[data-key="'+t+'"]').addClass("active");n&&a.find("textarea,input").focus()},buildTranslationUI:function(){var t=this;this.UI.$container.append($('<div class="form-group" />').append($('<label class="control-label" />').text(e.Translation)).append(this.UI.$tabHeaders=$('<ul class="nav nav-tabs" />')).append(this.UI.$tabBodies=$('<div class="tab-content" />')));var n=0;this.UI.$translated={};var a=null;$.each(this.translation.translator.plurals,function(i,s){null===a&&(a=i),t.UI.$tabHeaders.append($('<li data-key="'+i+'"'+(0===n?' class="active"':"")+" />").append($('<a href="#" />').text(e.PluralNames[i]))),t.UI.$tabBodies.append($('<div class="tab-pane'+(0===n?" active":"")+'" data-key="'+i+'" />').append($("<p />").text(e.ExamplePH.replace(/%s/,s))).append(t.UI.$translated[i]=$("<"+t.element+' class="form-control" />').val(t.translation.isTranslated?t.translation.translations[n]:""))),n++}),this.UI.$tabHeaders.find("a").on("click",function(n){n.preventDefault(),t.showTranslationTab($(this).closest("li").attr("data-key"))}),this.UI.$translated[a].focus()},getCurrentTextInput:function(){return this.UI.$tabBodies.find(".tab-pane.active").find("textarea,input")},getTranslatedStrings:function(t){var n=this,a=[],i=!1,s=null;return $.each(this.translation.translator.plurals,function(t){var e=$.trim(n.UI.$translated[t].val());e.length>0?i=!0:null===s&&(s=t),a.push(e)}),i===!1?null:null!==s&&t===!0?(this.showTranslationTab(s,!0),window.alert(e.Please_fill_in_all_plurals),!1):a}}),{Singular:n,Plural:a}}();n.prototype={launch:function(){var t=this;this.UI={},this.UI.$container=$(this.containerID),delete this.containerID;var n=this.height;delete this.height,(!n||n<200)&&(n=200),this.UI.$container.append($('<div class="row" />').append($('<div class="'+i.colFilter+'" />').append($('<div class="panel panel-info" />').append($('<div class="panel-heading" />').append($('<div class="panel-title" />').text(e.Filter))).append($('<div class="panel-body" />').append($('<div class="input-group">').append($('<div class="input-group-btn" />').append(this.UI.$showTranslated=$('<a href="javascript:void(0)" class="btn btn-default" />').text(e.Show_translated)).append(this.UI.$showUntranslated=$('<a href="javascript:void(0)" class="btn btn-default" />').text(e.Show_untranslated))).append(this.UI.$searchText=$('<input type="text" class="form-control" />').attr("placeholder",e.Search_for_)).append($('<div class="input-group-btn" />').append(this.UI.$searchButton=$('<button type="button" class="btn btn-primary"><span class="fa fa-search"></span></button>')).append($('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" />').append($('<span class="caret" />'))).append($('<ul class="dropdown-menu dropdown-menu-right" role="menu" />').append($("<li />").append(this.UI.$searchInOriginals=$('<a href="javascript:void(0)" />').text(" "+e.Search_in_originals).prepend($('<i class="fa" />')))).append($("<li />").append(this.UI.$searchInTranslations=$('<a href="javascript:void(0)" />').text(" "+e.Search_in_translations).prepend($('<i class="fa" />')))).append($("<li />").append(this.UI.$searchInContexts=$('<a href="javascript:void(0)" />').text(" "+e.Search_in_contexts).prepend($('<i class="fa" />')))).append('<li class="divider"></li>').append($("<li />").append(this.UI.$showUnapproved=$('<a href="javascript:void(0)" />').text(" "+e.Show_unapproved).prepend($('<i class="fa" />')))).append($("<li />").append(this.UI.$showApproved=$('<a href="javascript:void(0)" />').text(" "+e.Show_approved).prepend($('<i class="fa" />'))))))))))).append($('<div class="row" />').append($('<div class="'+i.colOriginal+' ccm-translator-col-original" />').append($('<div class="panel panel-primary" />').append($('<div class="panel-heading clearfix" />').append($("<span />").text(e.Original_String)).append($("<span />").text(e.Translation))).append(this.UI.$list=$('<ul class="list-group" />').css("height",n+"px")))).append($('<div class="'+i.colTranslations+' ccm-translator-col-translations" />').append($('<div class="panel panel-primary" />').append($('<div class="panel-heading" />').text(e.Translate)).append(this.UI.$translation=$('<div class="panel-body" />')).append($('<div class="panel-footer" />').append($('<button class="btn btn-primary ccm-translator-savecontinue" />').text(e.Save_and_Continue).on("click",function(){t.saveAndContinue()})).append($('<small class="text-muted" style="margin-left: 20px" />').text(e.TAB)).append($('<small class="text-muted" style="margin-left: 20px" />').text(e.TAB_SHIFT)))))),this.on.uiLaunched&&this.on.uiLaunched(this);var s=this.translations.length;if(s<a){this.UI.$searchButton.remove();var r=null;this.UI.$searchText.on("change keydown keyup keypress",function(){r&&clearTimeout(r),r=setTimeout(function(){r=null,t.filter()},100)})}else this.UI.$searchText.on("keypress",function(n){13===(n.keyCode||n.charCode)&&t.filter()}),this.UI.$searchButton.on("click",function(){t.filter()});for(var l=!1,o=0;o<s;o++)this.translations[o].buildListItem(),this.translations[o].hasContext&&(l=!0);this.appliedFilter={text:"",searchInOriginals:!0,searchInTranslations:!0,searchInContexts:!1,showUnapproved:!0,showApproved:!0,showTranslated:!0,showUntranslated:!0},this.UI.$searchInOriginals.on("click",function(){t.filter({searchInOriginals:!t.appliedFilter.searchInOriginals})}),this.UI.$searchInTranslations.on("click",function(){t.filter({searchInTranslations:!t.appliedFilter.searchInTranslations})}),this.UI.$showTranslated.on("click",function(){t.filter({showTranslated:!t.appliedFilter.showTranslated})}),this.UI.$showUntranslated.on("click",function(){t.filter({showUntranslated:!t.appliedFilter.showUntranslated})}),this.approvalSupport?(this.UI.$showUnapproved.on("click",function(){t.filter({showUnapproved:!t.appliedFilter.showUnapproved})}),this.UI.$showApproved.on("click",function(){t.filter({showApproved:!t.appliedFilter.showApproved})})):(this.UI.$showUnapproved.closest("li").prev().remove(),this.UI.$showUnapproved.remove(),this.UI.$showApproved.remove(),delete this.appliedFilter.showUnapproved,delete this.appliedFilter.showApproved,delete this.UI.$showUnapproved,delete this.UI.$showApproved),l?this.UI.$searchInContexts.on("click",function(){t.filter({searchInContexts:!t.appliedFilter.searchInContexts})}):this.UI.$searchInContexts.remove(),this.viewAppliedFilter(),$(window).on("beforeunload",function(){if(t.currentTranslationView&&t.currentTranslationView.isDirty())return e.AskDiscardDirtyTranslation}),s>0&&this.setCurrentTranslation(this.translations[0]),this.UI.$container.on("keydown",function(n){switch(n.keyCode||n.which){case 9:n.preventDefault(),setTimeout(function(){t.saveAndContinue(!!n.shiftKey)},0)}})},viewAppliedFilter:function(){var t=this.appliedFilter;this.UI.$searchText.text()!==t.text&&this.UI.$searchText.text(t.text),this.UI.$searchInOriginals.find("i").removeClass("fa-check-square-o fa-square-o").addClass(t.searchInOriginals?"fa-check-square-o":"fa-square-o"),this.UI.$searchInTranslations.find("i").removeClass("fa-check-square-o fa-square-o").addClass(t.searchInTranslations?"fa-check-square-o":"fa-square-o"),this.UI.$searchInContexts.find("i").removeClass("fa-check-square-o fa-square-o").addClass(t.searchInContexts?"fa-check-square-o":"fa-square-o"),this.approvalSupport&&(this.UI.$showUnapproved.find("i").removeClass("fa-check-square-o fa-square-o").addClass(t.showUnapproved?"fa-check-square-o":"fa-square-o"),this.UI.$showApproved.find("i").removeClass("fa-check-square-o fa-square-o").addClass(t.showApproved?"fa-check-square-o":"fa-square-o")),this.UI.$showTranslated.removeClass("btn-default btn-primary").addClass(t.showTranslated?"btn-primary":"btn-default"),this.UI.$showUntranslated.removeClass("btn-default btn-primary").addClass(t.showUntranslated?"btn-primary":"btn-default")},filter:function(t){var n=this,a=$.extend(!0,{},this.appliedFilter,t,{text:this.UI.$searchText.val()}),e=!1;if($.each(a,function(t,a){if(a!==n.appliedFilter[t]){switch(t){case"searchInOriginals":case"searchInTranslations":case"searchInContexts":if(""===n.appliedFilter.text)return}return e=!0,!1}}),this.appliedFilter=a,this.viewAppliedFilter(),e){this.appliedFilter.lowerCaseText=this.appliedFilter.text.toLowerCase();for(var i=this.translations.length,s=0;s<i;s++)this.translations[s].applyFilter()}},setCurrentTranslation:function(t){var n=this;if(n.busy)return!1;if(n.currentTranslationView){if(n.currentTranslationView.translation===t)return;if(n.currentTranslationView.isDirty()&&!window.confirm(e.AskDiscardDirtyTranslation))return}var a=function(){n.currentTranslationView&&(n.currentTranslationView.dispose(),n.currentTranslationView=null,n.on.currentTranslationChanged&&n.on.currentTranslationChanged(n)),t&&(n.currentTranslationView=t.isPlural?new s.Plural(t):new s.Singular(t),n.on.currentTranslationChanged&&n.on.currentTranslationChanged(n))};n.on.beforeActivatingTranslation?(n.setBusy(!0),n.on.beforeActivatingTranslation(n,t,function(t){n.setBusy(!1),t!==!1&&a()})):a()},setBusy:function(t){this.busy=!!t;var n=this.UI.$container.find("button.ccm-translator-savecontinue");this.busy?n.css("width",n.outerWidth()+"px").html('<span class="fa fa-spinner fa-spin"></span>'):n.css("width","auto").text(e.Save_and_Continue)},saveAndContinue:function(t){var n=this;if(!this.busy){if(this.currentTranslationView.isDirty()===!1)return void this.gotoNextTranslation(t);var a=this.currentTranslationView.getTranslatedState(!0);if(a!==!1){var e=this.currentTranslationView.translation,i={};i.id=e.id,null===a?i.clear=1:(i.translated=a.strings,"approved"in a&&(i.approved=a.approved?1:0)),this.setBusy(!0),$.isFunction(this.saveAction)?this.saveAction(e,i,function(a){n.setBusy(!1),a?window.alert(a):n.gotoNextTranslation(t)}):$.ajax({type:"POST",url:this.saveAction,data:i,dataType:"json"}).always(function(){n.setBusy(!1)}).fail(function(t){t.responseJSON&&t.responseJSON.errors?window.alert(t.responseJSON.errors.join("\n")):window.alert(t.responseText)}).done(function(i){return i&&i.error?void window.alert(i.errors.join("\n")):(e.translatedSaved(a.strings,a.approved),void n.gotoNextTranslation(t))})}}},gotoNextTranslation:function(t){var n=this.UI.$list.children(":visible");if(0===n.length)return void this.setCurrentTranslation(null);var a=0;if(this.currentTranslationView){var e=$.inArray(this.currentTranslationView.translation.li,n);t?e>=0&&(a=e-1,a<0&&(a=n.length-1)):e>=0&&e<n.length-1&&(a=e+1)}this.setCurrentTranslation(n[a].ccmTranslation)}};var r=function(){function t(){for(;a.length>0;)a.splice(0,1)[0].launch()}var n=!1,a=[];return{setDomReady:function(){n=!0,a.length&&t()},setTranslatorReady:function(e){a.push(e),n&&t()}}}();window.ccmTranslator={setI18NDictionart:function(t){$.extend(!0,e,t)},configureFrontend:function(t){$.isPlainObject(t)&&$.extend(i,t)},initialize:function(t){var a=new n(t);return r.setTranslatorReady(a),a},views:s},$(document).ready(function(){r.setDomReady()})}}();