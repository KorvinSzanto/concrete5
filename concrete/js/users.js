!function(e,t){"use strict";function s(e,s){var o=this,s=t.extend({chooseText:ccmi18n.chooseUser,loadingText:ccmi18n.loadingText,inputName:"uID",uID:0},s);o.$element=e,o.options=s,o._chooseTemplate=_.template(o.chooseTemplate,{options:o.options}),o._loadingTemplate=_.template(o.loadingTemplate),o._userLoadedTemplate=_.template(o.userLoadedTemplate),o.$element.append(o._chooseTemplate),o.$element.on("click","a[data-user-selector-link=choose]",function(e){e.preventDefault(),t.fn.dialog.open({title:ccmi18n.chooseUser,href:CCM_DISPATCHER_FILENAME+"/ccm/system/dialogs/user/search",width:"90%",modal:!0,height:"70%"})}),o.options.uID&&o.loadUser(o.options.uID),ConcreteEvent.unsubscribe("UserSearchDialogSelectUser.core"),ConcreteEvent.unsubscribe("UserSearchDialogAfterSelectUser.core"),ConcreteEvent.subscribe("UserSearchDialogSelectUser.core",function(e,t){o.loadUser(t.uID)}),ConcreteEvent.subscribe("UserSearchDialogAfterSelectUser.core",function(e){jQuery.fn.dialog.closeTop()})}s.prototype={chooseTemplate:'<div class="ccm-item-selector"><input type="hidden" name="<%=options.inputName%>" value="0" /><a href="#" data-user-selector-link="choose"><%=options.chooseText%></a></div>',loadingTemplate:'<div class="ccm-item-selector"><div class="ccm-item-selector-choose"><input type="hidden" name="<%=options.inputName%>" value="<%=uID%>"><i class="fa fa-spin fa-spinner"></i> <%=options.loadingText%></div></div>',userLoadedTemplate:'<div class="ccm-item-selector"><div class="ccm-item-selector-item-selected"><input type="hidden" name="<%=inputName%>" value="<%=user.uID%>" /><div class="ccm-item-selector-item-selected-thumbnail"><%=user.avatar%></div><a data-user-selector-action="clear" href="#" class="ccm-item-selector-clear"><i class="fa fa-close"></i></a><div class="ccm-item-selector-item-selected-title"><%=user.displayName%></div></div></div>',loadUser:function(e){var s=this;s.$element.html(s._loadingTemplate({options:s.options,uID:e})),t.ajax({type:"post",dataType:"json",url:CCM_DISPATCHER_FILENAME+"/ccm/system/user/get_json",data:{uID:e},error:function(e){ConcreteAlert.dialog("Error",e.responseText)},success:function(e){var t=e.users[0];s.$element.html(s._userLoadedTemplate({inputName:s.options.inputName,user:t})),s.$element.on("click","a[data-user-selector-action=clear]",function(e){e.preventDefault(),s.$element.html(s._chooseTemplate)})}})}},t.fn.concreteUserSelector=function(e){return t.each(t(this),function(o,c){new s(t(this),e)})},e.ConcreteUserSelector=s}(this,$);